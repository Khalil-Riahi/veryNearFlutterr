// // // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // // // // // // // //   const MyApp({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7), // Teal accent color from your UI
// // // // // // // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // // // // // // // // // //   // User data
// // // // // // // // // // // // // // // // // // // // //   String _fullName = "Khalil Riahi";
// // // // // // // // // // // // // // // // // // // // //   String _email = "khaliloz9003@gmail.com";
// // // // // // // // // // // // // // // // // // // // //   String _phoneNumber = "96452097";
// // // // // // // // // // // // // // // // // // // // //   File? _profileImage;

// // // // // // // // // // // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // // //         _profileImage = File(image.path);
// // // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // // //         leading: IconButton(
// // // // // // // // // // // // // // // // // // // // //           icon: const Icon(Icons.arrow_back),
// // // // // // // // // // // // // // // // // // // // //           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // // // // // // //             onPressed: () {
// // // // // // // // // // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // // // // //                 _formKey.currentState!.save();
// // // // // // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // // //                   const SnackBar(
// // // // // // // // // // // // // // // // // // // // //                     content: Text("Profile updated successfully"),
// // // // // // // // // // // // // // // // // // // // //                     backgroundColor: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // // // // // // // // // //           padding: const EdgeInsets.all(16.0),
// // // // // // // // // // // // // // // // // // // // //           child: Form(
// // // // // // // // // // // // // // // // // // // // //             key: _formKey,
// // // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // // // //                 // Profile Image
// // // // // // // // // // // // // // // // // // // // //                 Center(
// // // // // // // // // // // // // // // // // // // // //                   child: Stack(
// // // // // // // // // // // // // // // // // // // // //                     children: [
// // // // // // // // // // // // // // // // // // // // //                       Container(
// // // // // // // // // // // // // // // // // // // // //                         width: 120,
// // // // // // // // // // // // // // // // // // // // //                         height: 120,
// // // // // // // // // // // // // // // // // // // // //                         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // //                           color: Colors.grey.shade200,
// // // // // // // // // // // // // // // // // // // // //                           shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // // // //                           image: _profileImage != null
// // // // // // // // // // // // // // // // // // // // //                               ? DecorationImage(
// // // // // // // // // // // // // // // // // // // // //                                   image: FileImage(_profileImage!),
// // // // // // // // // // // // // // // // // // // // //                                   fit: BoxFit.cover,
// // // // // // // // // // // // // // // // // // // // //                                 )
// // // // // // // // // // // // // // // // // // // // //                               : null,
// // // // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // // // //                         child: _profileImage == null
// // // // // // // // // // // // // // // // // // // // //                             ? const Icon(
// // // // // // // // // // // // // // // // // // // // //                                 Icons.person,
// // // // // // // // // // // // // // // // // // // // //                                 size: 60,
// // // // // // // // // // // // // // // // // // // // //                                 color: Colors.grey,
// // // // // // // // // // // // // // // // // // // // //                               )
// // // // // // // // // // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // // //                       Positioned(
// // // // // // // // // // // // // // // // // // // // //                         bottom: 0,
// // // // // // // // // // // // // // // // // // // // //                         right: 0,
// // // // // // // // // // // // // // // // // // // // //                         child: GestureDetector(
// // // // // // // // // // // // // // // // // // // // //                           onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // // //                           child: Container(
// // // // // // // // // // // // // // // // // // // // //                             width: 36,
// // // // // // // // // // // // // // // // // // // // //                             height: 36,
// // // // // // // // // // // // // // // // // // // // //                             decoration: const BoxDecoration(
// // // // // // // // // // // // // // // // // // // // //                               color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // // //                               shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // // //                             child: const Icon(
// // // // // // // // // // // // // // // // // // // // //                               Icons.camera_alt,
// // // // // // // // // // // // // // // // // // // // //                               color: Colors.white,
// // // // // // // // // // // // // // // // // // // // //                               size: 20,
// // // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // // //                     ],
// // // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // // // //                 // Full Name
// // // // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.person_outline,
// // // // // // // // // // // // // // // // // // // // //                   label: "Full Name",
// // // // // // // // // // // // // // // // // // // // //                   initialValue: _fullName,
// // // // // // // // // // // // // // // // // // // // //                   onSaved: (value) => _fullName = value!,
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return "Please enter your name";
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 // Email
// // // // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.email_outlined,
// // // // // // // // // // // // // // // // // // // // //                   label: "Email",
// // // // // // // // // // // // // // // // // // // // //                   initialValue: _email,
// // // // // // // // // // // // // // // // // // // // //                   onSaved: (value) => _email = value!,
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return "Please enter an email";
// // // // // // // // // // // // // // // // // // // // //                     } else if (!RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$').hasMatch(value)) {
// // // // // // // // // // // // // // // // // // // // //                       return "Please enter a valid email";
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 // Phone Number
// // // // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // // // // // // //                   label: "Phone Number",
// // // // // // // // // // // // // // // // // // // // //                   initialValue: _phoneNumber,
// // // // // // // // // // // // // // // // // // // // //                   onSaved: (value) => _phoneNumber = value!,
// // // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // // //                       return "Please enter a phone number";
// // // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // // // //                 // Change Password Button
// // // // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.lock_outline,
// // // // // // // // // // // // // // // // // // // // //                   label: "Change Password",
// // // // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // // // //                     // Implement password change logic
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 // Privacy Settings Button
// // // // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.privacy_tip_outlined,
// // // // // // // // // // // // // // // // // // // // //                   label: "Privacy Settings",
// // // // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // // // //                     // Navigate to privacy settings
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 16),
// // // // // // // // // // // // // // // // // // // // //                 // Delete Account Button
// // // // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // // // //                   icon: Icons.delete_outline,
// // // // // // // // // // // // // // // // // // // // //                   label: "Delete Account",
// // // // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // // // //                     // Show delete account confirmation
// // // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // // //                   isDestructive: true,
// // // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // //   Widget _buildProfileField({
// // // // // // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // //     required String initialValue,
// // // // // // // // // // // // // // // // // // // // //     required Function(String?) onSaved,
// // // // // // // // // // // // // // // // // // // // //     required String? Function(String?) validator,
// // // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // //         color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // // // //         borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // // // // // // // // // //         initialValue: initialValue,
// // // // // // // // // // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // // //           prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // // // // // // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // // // // // // // // // //           labelStyle: TextStyle(color: Colors.grey.shade600),
// // // // // // // // // // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // // // // // // // // // //           contentPadding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // // //         onSaved: onSaved,
// // // // // // // // // // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // // //           color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // // // // // // // // //               icon,
// // // // // // // // // // // // // // // // // // // // //               color: isDestructive ? Colors.red : Colors.grey.shade600,
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black,
// // // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // // // // // // // // //               Icons.arrow_forward_ios,
// // // // // // // // // // // // // // // // // // // // //               size: 16,
// // // // // // // // // // // // // // // // // // // // //               color: Colors.grey.shade400,
// // // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // // // // // // //   const MyApp({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7), // Teal accent color from your UI
// // // // // // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // // // // // // // // //   // User data
// // // // // // // // // // // // // // // // // // // //   String _firstName = "Khalil";
// // // // // // // // // // // // // // // // // // // //   String _lastName = "Riahi";
// // // // // // // // // // // // // // // // // // // //   String _email = "khaliloz9003@gmail.com";
// // // // // // // // // // // // // // // // // // // //   String _phoneNumber = "96452097";
// // // // // // // // // // // // // // // // // // // //   File? _profileImage;

// // // // // // // // // // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // //         _profileImage = File(image.path);
// // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // // //         leading: IconButton(
// // // // // // // // // // // // // // // // // // // //           icon: const Icon(Icons.arrow_back),
// // // // // // // // // // // // // // // // // // // //           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // // // // // //             onPressed: () {
// // // // // // // // // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // // // //                 _formKey.currentState!.save();
// // // // // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // // //                   SnackBar(
// // // // // // // // // // // // // // // // // // // //                     content: const Text("Profile updated successfully"),
// // // // // // // // // // // // // // // // // // // //                     backgroundColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //                     behavior: SnackBarBehavior.floating,
// // // // // // // // // // // // // // // // // // // //                     shape: RoundedRectangleBorder(
// // // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(10),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                     margin: EdgeInsets.only(
// // // // // // // // // // // // // // // // // // // //                       bottom: MediaQuery.of(context).size.height - 100,
// // // // // // // // // // // // // // // // // // // //                       left: 20,
// // // // // // // // // // // // // // // // // // // //                       right: 20,
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // // // // // // // // //           padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 16.0),
// // // // // // // // // // // // // // // // // // // //           child: Form(
// // // // // // // // // // // // // // // // // // // //             key: _formKey,
// // // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // // //                 // Profile Image
// // // // // // // // // // // // // // // // // // // //                 Center(
// // // // // // // // // // // // // // // // // // // //                   child: Stack(
// // // // // // // // // // // // // // // // // // // //                     children: [
// // // // // // // // // // // // // // // // // // // //                       Container(
// // // // // // // // // // // // // // // // // // // //                         width: 140,
// // // // // // // // // // // // // // // // // // // //                         height: 140,
// // // // // // // // // // // // // // // // // // // //                         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //                           color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // // //                           shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // // //                           border: Border.all(
// // // // // // // // // // // // // // // // // // // //                             color: Colors.white,
// // // // // // // // // // // // // // // // // // // //                             width: 4,
// // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // //                           boxShadow: [
// // // // // // // // // // // // // // // // // // // //                             BoxShadow(
// // // // // // // // // // // // // // // // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // // // // // // // // // // // // // // // //                               spreadRadius: 2,
// // // // // // // // // // // // // // // // // // // //                               blurRadius: 8,
// // // // // // // // // // // // // // // // // // // //                               offset: const Offset(0, 2),
// // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // //                           ],
// // // // // // // // // // // // // // // // // // // //                           image: _profileImage != null
// // // // // // // // // // // // // // // // // // // //                               ? DecorationImage(
// // // // // // // // // // // // // // // // // // // //                                   image: FileImage(_profileImage!),
// // // // // // // // // // // // // // // // // // // //                                   fit: BoxFit.cover,
// // // // // // // // // // // // // // // // // // // //                                 )
// // // // // // // // // // // // // // // // // // // //                               : null,
// // // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // // //                         child: _profileImage == null
// // // // // // // // // // // // // // // // // // // //                             ? const Icon(
// // // // // // // // // // // // // // // // // // // //                                 Icons.person,
// // // // // // // // // // // // // // // // // // // //                                 size: 70,
// // // // // // // // // // // // // // // // // // // //                                 color: Colors.grey,
// // // // // // // // // // // // // // // // // // // //                               )
// // // // // // // // // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                       Positioned(
// // // // // // // // // // // // // // // // // // // //                         bottom: 0,
// // // // // // // // // // // // // // // // // // // //                         right: 0,
// // // // // // // // // // // // // // // // // // // //                         child: GestureDetector(
// // // // // // // // // // // // // // // // // // // //                           onTap: _pickImage,
// // // // // // // // // // // // // // // // // // // //                           child: Container(
// // // // // // // // // // // // // // // // // // // //                             width: 44,
// // // // // // // // // // // // // // // // // // // //                             height: 44,
// // // // // // // // // // // // // // // // // // // //                             decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //                               color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //                               shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // // //                               border: Border.all(
// // // // // // // // // // // // // // // // // // // //                                 color: Colors.white,
// // // // // // // // // // // // // // // // // // // //                                 width: 3,
// // // // // // // // // // // // // // // // // // // //                               ),
// // // // // // // // // // // // // // // // // // // //                               boxShadow: [
// // // // // // // // // // // // // // // // // // // //                                 BoxShadow(
// // // // // // // // // // // // // // // // // // // //                                   color: Colors.grey.withOpacity(0.3),
// // // // // // // // // // // // // // // // // // // //                                   spreadRadius: 1,
// // // // // // // // // // // // // // // // // // // //                                   blurRadius: 3,
// // // // // // // // // // // // // // // // // // // //                                   offset: const Offset(0, 1),
// // // // // // // // // // // // // // // // // // // //                                 ),
// // // // // // // // // // // // // // // // // // // //                               ],
// // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // //                             child: const Icon(
// // // // // // // // // // // // // // // // // // // //                               Icons.camera_alt,
// // // // // // // // // // // // // // // // // // // //                               color: Colors.white,
// // // // // // // // // // // // // // // // // // // //                               size: 22,
// // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ],
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 50),

// // // // // // // // // // // // // // // // // // // //                 // Name section label
// // // // // // // // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.only(left: 8.0, bottom: 12.0),
// // // // // // // // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // // // // // // // //                       "Personal Information",
// // // // // // // // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // // // // // // // //                 // First Name & Last Name Row
// // // // // // // // // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // // // // // // // //                         icon: Icons.person_outline,
// // // // // // // // // // // // // // // // // // // //                         label: "First Name",
// // // // // // // // // // // // // // // // // // // //                         initialValue: _firstName,
// // // // // // // // // // // // // // // // // // // //                         onSaved: (value) => _firstName = value!,
// // // // // // // // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // // // // // // // //                           if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // //                             return "Required";
// // // // // // // // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                     const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // // // // // // // //                         icon: null, // No icon for better alignment
// // // // // // // // // // // // // // // // // // // //                         label: "Last Name",
// // // // // // // // // // // // // // // // // // // //                         initialValue: _lastName,
// // // // // // // // // // // // // // // // // // // //                         onSaved: (value) => _lastName = value!,
// // // // // // // // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // // // // // // // //                           if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // //                             return "Required";
// // // // // // // // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // //                 // Contact section label
// // // // // // // // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.only(
// // // // // // // // // // // // // // // // // // // //                         left: 8.0, bottom: 12.0, top: 16.0),
// // // // // // // // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // // // // // // // //                       "Contact Details",
// // // // // // // // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // // // // // // // //                 // Email
// // // // // // // // // // // // // // // // // // // //                 // Email (non-editable)
// // // // // // // // // // // // // // // // // // // // // Email (non-editable)
// // // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // // //                   icon: Icons.email_outlined,
// // // // // // // // // // // // // // // // // // // //                   label: "Email Address",
// // // // // // // // // // // // // // // // // // // //                   initialValue: _email,
// // // // // // // // // // // // // // // // // // // //                   onSaved: (_) {},
// // // // // // // // // // // // // // // // // // // //                   validator: (_) => null,
// // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // // //                   enabled: false, // ✅ disables editing
// // // // // // // // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // //                 // Phone Number
// // // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // // //                   icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // // // // // //                   label: "Phone Number",
// // // // // // // // // // // // // // // // // // // //                   initialValue: _phoneNumber,
// // // // // // // // // // // // // // // // // // // //                   onSaved: (value) => _phoneNumber = value!,
// // // // // // // // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // // // // // // // //                       return "Please enter a phone number";
// // // // // // // // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),

// // // // // // // // // // // // // // // // // // // //                 // Account section label
// // // // // // // // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // // // // // // // //                     padding: const EdgeInsets.only(left: 8.0, bottom: 12.0),
// // // // // // // // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // // // // // // // //                       "Account",
// // // // // // // // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // // // // // // // //                 // Change Password Button
// // // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // // //                   icon: Icons.lock_outline,
// // // // // // // // // // // // // // // // // // // //                   label: "Change Password",
// // // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // // //                     // Implement password change logic
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // // // // // // // //                 // Delete Account Button
// // // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // // //                   icon: Icons.delete_outline,
// // // // // // // // // // // // // // // // // // // //                   label: "Delete Account",
// // // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // // //                     // Show delete account confirmation
// // // // // // // // // // // // // // // // // // // //                     showDialog(
// // // // // // // // // // // // // // // // // // // //                       context: context,
// // // // // // // // // // // // // // // // // // // //                       builder: (context) => AlertDialog(
// // // // // // // // // // // // // // // // // // // //                         title: const Text("Delete Account"),
// // // // // // // // // // // // // // // // // // // //                         content: const Text(
// // // // // // // // // // // // // // // // // // // //                             "Are you sure you want to delete your account? This action cannot be undone."),
// // // // // // // // // // // // // // // // // // // //                         shape: RoundedRectangleBorder(
// // // // // // // // // // // // // // // // // // // //                           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // // //                         actions: [
// // // // // // // // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // // // // // // // //                             onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // // //                             child: const Text(
// // // // // // // // // // // // // // // // // // // //                               "Cancel",
// // // // // // // // // // // // // // // // // // // //                               style: TextStyle(color: Colors.grey),
// // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // // // // // // // //                             onPressed: () {
// // // // // // // // // // // // // // // // // // // //                               // Delete account logic
// // // // // // // // // // // // // // // // // // // //                               Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // // // //                             },
// // // // // // // // // // // // // // // // // // // //                             child: const Text(
// // // // // // // // // // // // // // // // // // // //                               "Delete",
// // // // // // // // // // // // // // // // // // // //                               style: TextStyle(color: Colors.red),
// // // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // // //                         ],
// // // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // // //                     );
// // // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // // //                   isDestructive: true,
// // // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   // Widget _buildProfileField({
// // // // // // // // // // // // // // // // // // // //   //   IconData? icon,
// // // // // // // // // // // // // // // // // // // //   //   required String label,
// // // // // // // // // // // // // // // // // // // //   //   required String initialValue,
// // // // // // // // // // // // // // // // // // // //   //   required Function(String?) onSaved,
// // // // // // // // // // // // // // // // // // // //   //   required String? Function(String?) validator,
// // // // // // // // // // // // // // // // // // // //   //   TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // //   //   bool enabled = true, // <-- Add this line
// // // // // // // // // // // // // // // // // // // //   // }) {
// // // // // // // // // // // // // // // // // // // //   //   return Container(
// // // // // // // // // // // // // // // // // // // //   //     decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //   //       color: Colors.grey.shade50,
// // // // // // // // // // // // // // // // // // // //   //       borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // // //   //       border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // // // //   //       boxShadow: [
// // // // // // // // // // // // // // // // // // // //   //         BoxShadow(
// // // // // // // // // // // // // // // // // // // //   //           color: Colors.grey.withOpacity(0.05),
// // // // // // // // // // // // // // // // // // // //   //           spreadRadius: 1,
// // // // // // // // // // // // // // // // // // // //   //           blurRadius: 3,
// // // // // // // // // // // // // // // // // // // //   //           offset: const Offset(0, 1),
// // // // // // // // // // // // // // // // // // // //   //         ),
// // // // // // // // // // // // // // // // // // // //   //       ],
// // // // // // // // // // // // // // // // // // // //   //     ),
// // // // // // // // // // // // // // // // // // // //   //     child: TextFormField(
// // // // // // // // // // // // // // // // // // // //   //       initialValue: initialValue,
// // // // // // // // // // // // // // // // // // // //   //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // //   //         prefixIcon: icon != null
// // // // // // // // // // // // // // // // // // // //   //             ? Icon(icon, color: Colors.grey.shade600, size: 22)
// // // // // // // // // // // // // // // // // // // //   //             : null,
// // // // // // // // // // // // // // // // // // // //   //         labelText: label,
// // // // // // // // // // // // // // // // // // // //   //         labelStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //   //           color: Colors.grey.shade600,
// // // // // // // // // // // // // // // // // // // //   //           fontSize: 15,
// // // // // // // // // // // // // // // // // // // //   //         ),
// // // // // // // // // // // // // // // // // // // //   //         floatingLabelStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //   //           color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //   //           fontWeight: FontWeight.w500,
// // // // // // // // // // // // // // // // // // // //   //         ),
// // // // // // // // // // // // // // // // // // // //   //         border: InputBorder.none,
// // // // // // // // // // // // // // // // // // // //   //         contentPadding: EdgeInsets.symmetric(
// // // // // // // // // // // // // // // // // // // //   //           vertical: 16,
// // // // // // // // // // // // // // // // // // // //   //           horizontal: icon == null ? 16 : 0,
// // // // // // // // // // // // // // // // // // // //   //         ),
// // // // // // // // // // // // // // // // // // // //   //         errorStyle: const TextStyle(
// // // // // // // // // // // // // // // // // // // //   //           color: Colors.redAccent,
// // // // // // // // // // // // // // // // // // // //   //           fontSize: 12,
// // // // // // // // // // // // // // // // // // // //   //         ),
// // // // // // // // // // // // // // // // // // // //   //       ),
// // // // // // // // // // // // // // // // // // // //   //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // //   //       onSaved: onSaved,
// // // // // // // // // // // // // // // // // // // //   //       validator: validator,
// // // // // // // // // // // // // // // // // // // //   //       style: const TextStyle(
// // // // // // // // // // // // // // // // // // // //   //         fontSize: 16,
// // // // // // // // // // // // // // // // // // // //   //       ),
// // // // // // // // // // // // // // // // // // // //   //     ),
// // // // // // // // // // // // // // // // // // // //   //   );
// // // // // // // // // // // // // // // // // // // //   // }

// // // // // // // // // // // // // // // // // // // //   Widget _buildProfileField({
// // // // // // // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // //     required String initialValue,
// // // // // // // // // // // // // // // // // // // //     required Function(String?) onSaved,
// // // // // // // // // // // // // // // // // // // //     required String? Function(String?) validator,
// // // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // // //         borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // // // //         boxShadow: [
// // // // // // // // // // // // // // // // // // // //           BoxShadow(
// // // // // // // // // // // // // // // // // // // //             color: Colors.grey.withOpacity(0.05),
// // // // // // // // // // // // // // // // // // // //             spreadRadius: 1,
// // // // // // // // // // // // // // // // // // // //             blurRadius: 3,
// // // // // // // // // // // // // // // // // // // //             offset: const Offset(0, 1),
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // // // // // // // // //         initialValue: initialValue,
// // // // // // // // // // // // // // // // // // // //         enabled: enabled, // ✅ disables editing
// // // // // // // // // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // // //           prefixIcon: icon != null
// // // // // // // // // // // // // // // // // // // //               ? Icon(icon, color: Colors.grey.shade600, size: 22)
// // // // // // // // // // // // // // // // // // // //               : null,
// // // // // // // // // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // // // // // // // // //           labelStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //             color: Colors.grey.shade600,
// // // // // // // // // // // // // // // // // // // //             fontSize: 15,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //           floatingLabelStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //             color: enabled ? const Color(0xFF45BDA7) : Colors.grey,
// // // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.w500,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // // // // // // // // //           contentPadding: EdgeInsets.symmetric(
// // // // // // // // // // // // // // // // // // // //             vertical: 16,
// // // // // // // // // // // // // // // // // // // //             horizontal: icon == null ? 16 : 0,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //           errorStyle: const TextStyle(
// // // // // // // // // // // // // // // // // // // //             color: Colors.redAccent,
// // // // // // // // // // // // // // // // // // // //             fontSize: 12,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // // //         onSaved: onSaved,
// // // // // // // // // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // // // // // // // // //         style: TextStyle(
// // // // // // // // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // // // // // // // //           color:
// // // // // // // // // // // // // // // // // // // //               enabled ? Colors.black : Colors.grey, // visually dim if disabled
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 18),
// // // // // // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // // // // // // // //               icon,
// // // // // // // // // // // // // // // // // // // //               color: isDestructive ? Colors.redAccent : const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //               size: 22,
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.w500,
// // // // // // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.redAccent : Colors.black87,
// // // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // // // // // // // //               Icons.arrow_forward_ios,
// // // // // // // // // // // // // // // // // // // //               size: 16,
// // // // // // // // // // // // // // // // // // // //               color: Colors.grey.shade400,
// // // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // import 'dart:convert';

// // // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // ✅ Changed MyApp from StatelessWidget to StatefulWidget
// // // // // // // // // // // // // // // // // // // // class MyApp extends StatefulWidget {
// // // // // // // // // // // // // // // // // // // //   const MyApp({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   State<MyApp> createState() => _MyAppState();
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // class _MyAppState extends State<MyApp> with SingleTickerProviderStateMixin {
// // // // // // // // // // // // // // // // // // // //   String nom = '';
// // // // // // // // // // // // // // // // // // // //   String prenom = '';
// // // // // // // // // // // // // // // // // // // //   String mail = '';
// // // // // // // // // // // // // // // // // // // //   var tel = 0;
// // // // // // // // // // // // // // // // // // // //   var points = 0;
// // // // // // // // // // // // // // // // // // // //   var photo = "";

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // // // // // // // // // // // //     if (userJson != null) {
// // // // // // // // // // // // // // // // // // // //       final userMap = jsonDecode(userJson);
// // // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // // //         nom = userMap['firstName'] ?? '';
// // // // // // // // // // // // // // // // // // // //         prenom = userMap['lastName'] ?? '';
// // // // // // // // // // // // // // // // // // // //         mail = userMap['email'] ?? '';
// // // // // // // // // // // // // // // // // // // //         tel = userMap['phone'] ?? '';
// // // // // // // // // // // // // // // // // // // //         points = userMap['points'] ?? 0;
// // // // // // // // // // // // // // // // // // // //         photo = userMap['photo'] ?? '';
// // // // // // // // // // // // // // // // // // // //         print(photo);
// // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // // // // // // // //   String _firstName = "";
// // // // // // // // // // // // // // // // // // //   String _lastName = "";
// // // // // // // // // // // // // // // // // // //   String _email = "";
// // // // // // // // // // // // // // // // // // //   String _phoneNumber = "";
// // // // // // // // // // // // // // // // // // //   File? _profileImage;

// // // // // // // // // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // //         _profileImage = File(image.path);
// // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // // // // // // // // // // //     if (userJson != null) {
// // // // // // // // // // // // // // // // // // //       final userMap = jsonDecode(userJson);
// // // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // // //         _firstName = userMap['firstName'] ?? '';
// // // // // // // // // // // // // // // // // // //         _lastName = userMap['lastName'] ?? '';
// // // // // // // // // // // // // // // // // // //         _email = userMap['email'] ?? '';
// // // // // // // // // // // // // // // // // // //         _phoneNumber = userMap['phone']?.toString() ?? '';
// // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // // //         leading: IconButton(
// // // // // // // // // // // // // // // // // // //           icon: const Icon(Icons.arrow_back),
// // // // // // // // // // // // // // // // // // //           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // // // // //             onPressed: () {
// // // // // // // // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // // //                 _formKey.currentState!.save();
// // // // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // // //                   SnackBar(
// // // // // // // // // // // // // // // // // // //                     content: const Text("Profile updated successfully"),
// // // // // // // // // // // // // // // // // // //                     backgroundColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // //                     behavior: SnackBarBehavior.floating,
// // // // // // // // // // // // // // // // // // //                     shape: RoundedRectangleBorder(
// // // // // // // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(10),
// // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // //                     margin: EdgeInsets.only(
// // // // // // // // // // // // // // // // // // //                       bottom: MediaQuery.of(context).size.height - 100,
// // // // // // // // // // // // // // // // // // //                       left: 20,
// // // // // // // // // // // // // // // // // // //                       right: 20,
// // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // // // // // // // //           padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 16.0),
// // // // // // // // // // // // // // // // // // //           child: Form(
// // // // // // // // // // // // // // // // // // //             key: _formKey,
// // // // // // // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // //                 Center(
// // // // // // // // // // // // // // // // // // //                   child: Stack(
// // // // // // // // // // // // // // // // // // //                     children: [
// // // // // // // // // // // // // // // // // // //                       Container(
// // // // // // // // // // // // // // // // // // //                         width: 140,
// // // // // // // // // // // // // // // // // // //                         height: 140,
// // // // // // // // // // // // // // // // // // //                         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // //                           color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // //                           shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // //                           border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // // // // // // //                           boxShadow: [
// // // // // // // // // // // // // // // // // // //                             BoxShadow(
// // // // // // // // // // // // // // // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // // // // // // // // // // // // // // //                               spreadRadius: 2,
// // // // // // // // // // // // // // // // // // //                               blurRadius: 8,
// // // // // // // // // // // // // // // // // // //                               offset: const Offset(0, 2),
// // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // //                           ],
// // // // // // // // // // // // // // // // // // //                           image: _profileImage != null
// // // // // // // // // // // // // // // // // // //                               ? DecorationImage(
// // // // // // // // // // // // // // // // // // //                                   image: FileImage(_profileImage!),
// // // // // // // // // // // // // // // // // // //                                   fit: BoxFit.cover,
// // // // // // // // // // // // // // // // // // //                                 )
// // // // // // // // // // // // // // // // // // //                               : null,
// // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // //                         child: _profileImage == null
// // // // // // // // // // // // // // // // // // //                             ? const Icon(
// // // // // // // // // // // // // // // // // // //                                 Icons.person,
// // // // // // // // // // // // // // // // // // //                                 size: 70,
// // // // // // // // // // // // // // // // // // //                                 color: Colors.grey,
// // // // // // // // // // // // // // // // // // //                               )
// // // // // // // // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // //                       Positioned(
// // // // // // // // // // // // // // // // // // //                         bottom: 0,
// // // // // // // // // // // // // // // // // // //                         right: 0,
// // // // // // // // // // // // // // // // // // //                         child: GestureDetector(
// // // // // // // // // // // // // // // // // // //                           onTap: _pickImage,
// // // // // // // // // // // // // // // // // // //                           child: Container(
// // // // // // // // // // // // // // // // // // //                             width: 44,
// // // // // // // // // // // // // // // // // // //                             height: 44,
// // // // // // // // // // // // // // // // // // //                             decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // //                               color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // //                               shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // // //                               border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // // // // // // //                               boxShadow: [
// // // // // // // // // // // // // // // // // // //                                 BoxShadow(
// // // // // // // // // // // // // // // // // // //                                   color: Colors.grey.withOpacity(0.3),
// // // // // // // // // // // // // // // // // // //                                   spreadRadius: 1,
// // // // // // // // // // // // // // // // // // //                                   blurRadius: 3,
// // // // // // // // // // // // // // // // // // //                                   offset: const Offset(0, 1),
// // // // // // // // // // // // // // // // // // //                                 ),
// // // // // // // // // // // // // // // // // // //                               ],
// // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // //                             child: const Icon(
// // // // // // // // // // // // // // // // // // //                               Icons.camera_alt,
// // // // // // // // // // // // // // // // // // //                               color: Colors.white,
// // // // // // // // // // // // // // // // // // //                               size: 22,
// // // // // // // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // //                     ],
// // // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 50),
// // // // // // // // // // // // // // // // // // //                 _sectionLabel("Personal Information"),
// // // // // // // // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // // // // // // //                         icon: Icons.person_outline,
// // // // // // // // // // // // // // // // // // //                         label: "First Name",
// // // // // // // // // // // // // // // // // // //                         initialValue: _firstName,
// // // // // // // // // // // // // // // // // // //                         onSaved: (value) => _firstName = value!,
// // // // // // // // // // // // // // // // // // //                         validator: (value) =>
// // // // // // // // // // // // // // // // // // //                             value == null || value.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // //                     const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // // // // // // //                         icon: null,
// // // // // // // // // // // // // // // // // // //                         label: "Last Name",
// // // // // // // // // // // // // // // // // // //                         initialValue: _lastName,
// // // // // // // // // // // // // // // // // // //                         onSaved: (value) => _lastName = value!,
// // // // // // // // // // // // // // // // // // //                         validator: (value) =>
// // // // // // // // // // // // // // // // // // //                             value == null || value.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // //                 _sectionLabel("Contact Details"),
// // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // //                   icon: Icons.email_outlined,
// // // // // // // // // // // // // // // // // // //                   label: "Email Address",
// // // // // // // // // // // // // // // // // // //                   initialValue: _email,
// // // // // // // // // // // // // // // // // // //                   onSaved: (_) {},
// // // // // // // // // // // // // // // // // // //                   validator: (_) => null,
// // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // // // // // // //                   enabled: false,
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // // // // // // //                   icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // // // // //                   label: "Phone Number",
// // // // // // // // // // // // // // // // // // //                   initialValue: _phoneNumber,
// // // // // // // // // // // // // // // // // // //                   onSaved: (value) => _phoneNumber = value!,
// // // // // // // // // // // // // // // // // // //                   validator: (value) => value == null || value.isEmpty
// // // // // // // // // // // // // // // // // // //                       ? "Please enter a phone number"
// // // // // // // // // // // // // // // // // // //                       : null,
// // // // // // // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // //                 _sectionLabel("Account"),
// // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // //                   icon: Icons.lock_outline,
// // // // // // // // // // // // // // // // // // //                   label: "Change Password",
// // // // // // // // // // // // // // // // // // //                   onTap: () {},
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // // // // // // //                   icon: Icons.delete_outline,
// // // // // // // // // // // // // // // // // // //                   label: "Delete Account",
// // // // // // // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // // // // // // //                     showDialog(
// // // // // // // // // // // // // // // // // // //                       context: context,
// // // // // // // // // // // // // // // // // // //                       builder: (context) => AlertDialog(
// // // // // // // // // // // // // // // // // // //                         title: const Text("Delete Account"),
// // // // // // // // // // // // // // // // // // //                         content: const Text(
// // // // // // // // // // // // // // // // // // //                             "Are you sure you want to delete your account? This action cannot be undone."),
// // // // // // // // // // // // // // // // // // //                         shape: RoundedRectangleBorder(
// // // // // // // // // // // // // // // // // // //                           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // // //                         actions: [
// // // // // // // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // // // // // // //                             onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // //                             child: const Text("Cancel",
// // // // // // // // // // // // // // // // // // //                                 style: TextStyle(color: Colors.grey)),
// // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // // // // // // //                             onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // // //                             child: const Text("Delete",
// // // // // // // // // // // // // // // // // // //                                 style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // // //                         ],
// // // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // // //                     );
// // // // // // // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // // // // // // //                   isDestructive: true,
// // // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   Widget _sectionLabel(String text) {
// // // // // // // // // // // // // // // // // // //     return Align(
// // // // // // // // // // // // // // // // // // //       alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // // // //       child: Padding(
// // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.only(left: 8.0, bottom: 12.0),
// // // // // // // // // // // // // // // // // // //         child: Text(
// // // // // // // // // // // // // // // // // // //           text,
// // // // // // // // // // // // // // // // // // //           style: TextStyle(
// // // // // // // // // // // // // // // // // // //             color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // // // //             fontSize: 16,
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   Widget _buildProfileField({
// // // // // // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // //     required String initialValue,
// // // // // // // // // // // // // // // // // // //     required Function(String?) onSaved,
// // // // // // // // // // // // // // // // // // //     required String? Function(String?) validator,
// // // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // // // // // // // // // //         borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // // //         boxShadow: [
// // // // // // // // // // // // // // // // // // //           BoxShadow(
// // // // // // // // // // // // // // // // // // //             color: Colors.grey.withOpacity(0.05),
// // // // // // // // // // // // // // // // // // //             spreadRadius: 1,
// // // // // // // // // // // // // // // // // // //             blurRadius: 3,
// // // // // // // // // // // // // // // // // // //             offset: const Offset(0, 1),
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // // // // // // // //         initialValue: initialValue,
// // // // // // // // // // // // // // // // // // //         enabled: enabled,
// // // // // // // // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // // // // // // // //           prefixIcon: icon != null
// // // // // // // // // // // // // // // // // // //               ? Icon(icon, color: Colors.grey.shade600, size: 22)
// // // // // // // // // // // // // // // // // // //               : null,
// // // // // // // // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // // // // // // // //           labelStyle: TextStyle(color: Colors.grey.shade600, fontSize: 15),
// // // // // // // // // // // // // // // // // // //           floatingLabelStyle: TextStyle(
// // // // // // // // // // // // // // // // // // //             color: enabled ? const Color(0xFF45BDA7) : Colors.grey,
// // // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.w500,
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // // // // // // // //           contentPadding: EdgeInsets.symmetric(
// // // // // // // // // // // // // // // // // // //             vertical: 16,
// // // // // // // // // // // // // // // // // // //             horizontal: icon == null ? 16 : 0,
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //           errorStyle: const TextStyle(
// // // // // // // // // // // // // // // // // // //             color: Colors.redAccent,
// // // // // // // // // // // // // // // // // // //             fontSize: 12,
// // // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // // //         onSaved: onSaved,
// // // // // // // // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // // // // // // // //         style: TextStyle(
// // // // // // // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // // // // // // //           color: enabled ? Colors.black : Colors.grey,
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 18),
// // // // // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // // // // // // //               icon,
// // // // // // // // // // // // // // // // // // //               color: isDestructive ? Colors.redAccent : const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // // //               size: 22,
// // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.w500,
// // // // // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.redAccent : Colors.black87,
// // // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // // // // // // // //             Icon(Icons.arrow_forward_ios,
// // // // // // // // // // // // // // // // // // //                 size: 16, color: Colors.grey.shade400),
// // // // // // // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // // // // //   const MyApp({super.key});
// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // // // //             color: Colors.black, fontSize: 20, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // // // //   const EditProfilePage({super.key});
// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // // // // // // //   // Controllers for our form fields:
// // // // // // // // // // // // // // // // // //   final _firstNameController = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _lastNameController  = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _emailController     = TextEditingController();
// // // // // // // // // // // // // // // // // //   final _phoneController     = TextEditingController();

// // // // // // // // // // // // // // // // // //   File? _profileImage;
// // // // // // // // // // // // // // // // // //   final _picker = ImagePicker();

// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // // //     final jsonString = prefs.getString('user');
// // // // // // // // // // // // // // // // // //     if (jsonString != null) {
// // // // // // // // // // // // // // // // // //       final userMap = jsonDecode(jsonString);
// // // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // // // // // // // // // // // //         _lastNameController.text  = userMap['lastName']  ?? '';
// // // // // // // // // // // // // // // // // //         _emailController.text     = userMap['email']     ?? '';
// // // // // // // // // // // // // // // // // //         _phoneController.text     = userMap['phone']?.toString() ?? '';
// // // // // // // // // // // // // // // // // //         // If you also store a saved image path, you could load it here.
// // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Future<void> _saveUserData() async {
// // // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // // //     final userMap = {
// // // // // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // // // // //       'lastName' : _lastNameController.text,
// // // // // // // // // // // // // // // // // //       'email'    : _emailController.text,
// // // // // // // // // // // // // // // // // //       'phone'    : _phoneController.text,
// // // // // // // // // // // // // // // // // //       // you could save a profile‐image path as well
// // // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // // //     await prefs.setString('user', jsonEncode(userMap));
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // // //     final file = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // // //     if (file != null) {
// // // // // // // // // // // // // // // // // //       setState(() => _profileImage = File(file.path));
// // // // // // // // // // // // // // // // // //       // you might also want to save the path to SharedPreferences here
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // // //         leading: BackButton(color: Colors.black),
// // // // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // // // // // //                 await _saveUserData();
// // // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // // //                   const SnackBar(
// // // // // // // // // // // // // // // // // //                     content: Text("Profile updated successfully"),
// // // // // // // // // // // // // // // // // //                     backgroundColor: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // //               // Profile Image
// // // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // // // // // //                         boxShadow: [
// // // // // // // // // // // // // // // // // //                           BoxShadow(
// // // // // // // // // // // // // // // // // //                             color: Colors.grey.withOpacity(0.2),
// // // // // // // // // // // // // // // // // //                             spreadRadius: 2, blurRadius: 8, offset: Offset(0,2),
// // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // //                         ],
// // // // // // // // // // // // // // // // // //                         image: _profileImage != null
// // // // // // // // // // // // // // // // // //                             ? DecorationImage(
// // // // // // // // // // // // // // // // // //                                 image: FileImage(_profileImage!), fit: BoxFit.cover)
// // // // // // // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // //                       child: _profileImage == null
// // // // // // // // // // // // // // // // // //                           ? const Icon(Icons.person, size: 70, color: Colors.grey)
// // // // // // // // // // // // // // // // // //                           : null,
// // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // // // // // // //                       bottom: 0, right: 0,
// // // // // // // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // // // // // // //                           width: 44, height: 44,
// // // // // // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // // // // // //                             boxShadow: [
// // // // // // // // // // // // // // // // // //                               BoxShadow(
// // // // // // // // // // // // // // // // // //                                 color: Colors.grey.withOpacity(0.3),
// // // // // // // // // // // // // // // // // //                                 spreadRadius: 1, blurRadius: 3, offset: Offset(0,1),
// // // // // // // // // // // // // // // // // //                               ),
// // // // // // // // // // // // // // // // // //                             ],
// // // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // // //                           child: const Icon(Icons.camera_alt, color: Colors.white, size: 22),
// // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 40),

// // // // // // // // // // // // // // // // // //               _sectionLabel("Personal Information"),
// // // // // // // // // // // // // // // // // //               Row(
// // // // // // // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // //                     child: _buildField(
// // // // // // // // // // // // // // // // // //                       controller: _firstNameController,
// // // // // // // // // // // // // // // // // //                       icon: Icons.person_outline,
// // // // // // // // // // // // // // // // // //                       label: "First Name",
// // // // // // // // // // // // // // // // // //                       validator: (v) => (v == null || v.isEmpty) ? "Required" : null,
// // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // //                   const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // // // // // // //                     child: _buildField(
// // // // // // // // // // // // // // // // // //                       controller: _lastNameController,
// // // // // // // // // // // // // // // // // //                       icon: Icons.person_outline,
// // // // // // // // // // // // // // // // // //                       label: "Last Name",
// // // // // // // // // // // // // // // // // //                       validator: (v) => (v == null || v.isEmpty) ? "Required" : null,
// // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // // // // // //                 ],
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 30),

// // // // // // // // // // // // // // // // // //               _sectionLabel("Contact Details"),
// // // // // // // // // // // // // // // // // //               _buildField(
// // // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // // // // // // //                 label: "Email Address",
// // // // // // // // // // // // // // // // // //                 enabled: false,
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // //               _buildField(
// // // // // // // // // // // // // // // // // //                 controller: _phoneController,
// // // // // // // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // // // //                 label: "Phone Number",
// // // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // // //                 validator: (v) => (v == null || v.isEmpty)
// // // // // // // // // // // // // // // // // //                   ? "Please enter a phone number"
// // // // // // // // // // // // // // // // // //                   : null,
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 40),

// // // // // // // // // // // // // // // // // //               _sectionLabel("Account"),
// // // // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // // // // // // //                 label: "Change Password",
// // // // // // // // // // // // // // // // // //                 onTap: () {/* TODO: change password */},
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // // // // // // //                 label: "Delete Account",
// // // // // // // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // // // // // // //                       title: const Text("Delete Account"),
// // // // // // // // // // // // // // // // // //                       content: const Text(
// // // // // // // // // // // // // // // // // //                         "Are you sure you want to delete your account? This action cannot be undone."
// // // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // // //                           child: const Text("Cancel", style: TextStyle(color: Colors.grey)),
// // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // // // //                           onPressed: () {
// // // // // // // // // // // // // // // // // //                             // TODO: actually delete
// // // // // // // // // // // // // // // // // //                             Navigator.of(context).pop();
// // // // // // // // // // // // // // // // // //                           },
// // // // // // // // // // // // // // // // // //                           child: const Text("Delete", style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // // //                       ],
// // // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Widget _sectionLabel(String text) {
// // // // // // // // // // // // // // // // // //     return Align(
// // // // // // // // // // // // // // // // // //       alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // // //       child: Padding(
// // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.only(left: 8.0, bottom: 8.0),
// // // // // // // // // // // // // // // // // //         child: Text(
// // // // // // // // // // // // // // // // // //           text,
// // // // // // // // // // // // // // // // // //           style: TextStyle(
// // // // // // // // // // // // // // // // // //             color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // // //             fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // // //             fontSize: 16,
// // // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Widget _buildField({
// // // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // // // // // // // // //         borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // // // // // // //         controller: controller,
// // // // // // // // // // // // // // // // // //         enabled: enabled,
// // // // // // // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // // // // // // //           prefixIcon: icon != null
// // // // // // // // // // // // // // // // // //               ? Icon(icon, color: Colors.grey.shade600, size: 22)
// // // // // // // // // // // // // // // // // //               : null,
// // // // // // // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // // // // // // //           contentPadding: const EdgeInsets.symmetric(vertical: 16, horizontal: 16),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : const Color(0xFF45BDA7)),
// // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black87,
// // // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // // // // // // //             const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // // // void main() => runApp(const MyApp());

// // // // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // // // //   const MyApp({super.key});
// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // // //             color: Colors.black, fontSize: 20, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // // //   const EditProfilePage({super.key});
// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // // //   // Replace this with your actual user ID:
// // // // // // // // // // // // // // // // //   final String idUser = '';

// // // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // // //   final _firstNameController = TextEditingController();
// // // // // // // // // // // // // // // // //   final _lastNameController  = TextEditingController();
// // // // // // // // // // // // // // // // //   final _emailController     = TextEditingController();
// // // // // // // // // // // // // // // // //   final _phoneController     = TextEditingController();

// // // // // // // // // // // // // // // // //   File? _localImage;               // picked but not yet uploaded
// // // // // // // // // // // // // // // // //   String? _uploadedImageUrl;       // set after server returns filename
// // // // // // // // // // // // // // // // //   final _picker = ImagePicker();

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // //     final raw = prefs.getString('user');
// // // // // // // // // // // // // // // // //     if (raw != null) {
// // // // // // // // // // // // // // // // //       final m = jsonDecode(raw);
// // // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // // //         _firstNameController.text = m['firstName'] ?? '';
// // // // // // // // // // // // // // // // //         _lastNameController.text  = m['lastName']  ?? '';
// // // // // // // // // // // // // // // // //         _emailController.text     = m['email']     ?? '';
// // // // // // // // // // // // // // // // //         _phoneController.text     = m['phone']?.toString() ?? '';
// // // // // // // // // // // // // // // // //         _uploadedImageUrl          = m['photoUrl']; // if you saved it before
// // // // // // // // // // // // // // // // //         // _id = m['_id'];
// // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Future<void> _saveLocally() async {
// // // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // // //     final m = {
// // // // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // // // //       'lastName' : _lastNameController.text,
// // // // // // // // // // // // // // // // //       'email'    : _emailController.text,
// // // // // // // // // // // // // // // // //       'phone'    : _phoneController.text,
// // // // // // // // // // // // // // // // //       'photoUrl' : _uploadedImageUrl,
// // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // //     await prefs.setString('user', jsonEncode(m));
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // // //     final file = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // // //     if (file != null) {
// // // // // // // // // // // // // // // // //       setState(() => _localImage = File(file.path));
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Future<void> _handleFormSubmit() async {
// // // // // // // // // // // // // // // // //     // 1) JSON data patch
// // // // // // // // // // // // // // // // //     final userData = {
// // // // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // // // //       'lastName' : _lastNameController.text,
// // // // // // // // // // // // // // // // //       'phone'    : _phoneController.text,
// // // // // // // // // // // // // // // // //       // add more fields if needed
// // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // //     final resp1 = await http.patch(
// // // // // // // // // // // // // // // // //       Uri.parse('http://localhost:8000/users/$idUser'),
// // // // // // // // // // // // // // // // //       headers: {'Content-Type': 'application/json'},
// // // // // // // // // // // // // // // // //       body: jsonEncode(userData),
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //     if (resp1.statusCode != 200) {
// // // // // // // // // // // // // // // // //       throw Exception('User update failed (${resp1.statusCode})');
// // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // //     // 2) image patch if we picked one
// // // // // // // // // // // // // // // // //     if (_localImage != null) {
// // // // // // // // // // // // // // // // //       final req = http.MultipartRequest(
// // // // // // // // // // // // // // // // //         'PATCH',
// // // // // // // // // // // // // // // // //         Uri.parse('http://localhost:8000/upload/$idUser'),
// // // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // // //       req.files.add(
// // // // // // // // // // // // // // // // //         await http.MultipartFile.fromPath('file', _localImage!.path),
// // // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // // //       final streamed = await req.send();
// // // // // // // // // // // // // // // // //       final resp2 = await http.Response.fromStream(streamed);
// // // // // // // // // // // // // // // // //       if (resp2.statusCode == 200) {
// // // // // // // // // // // // // // // // //         final body = jsonDecode(resp2.body);
// // // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // // //           _uploadedImageUrl = 'http://localhost:8000/images/${body['userImage']}';
// // // // // // // // // // // // // // // // //           _localImage = null; // clear local pick
// // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // //         throw Exception('Image upload failed (${resp2.statusCode})');
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // //     // 3) persist everything to SharedPreferences
// // // // // // // // // // // // // // // // //     await _saveLocally();
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // // // // // // //               if (!_formKey.currentState!.validate()) return;

// // // // // // // // // // // // // // // // //               try {
// // // // // // // // // // // // // // // // //                 await _handleFormSubmit();
// // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully')),
// // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // // //               } catch (e) {
// // // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // // //                   SnackBar(content: Text('Error: $e')),
// // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // // //               // --- Profile Image ---
// // // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // // // // //                         image: DecorationImage(
// // // // // // // // // // // // // // // // //                           image: _localImage != null
// // // // // // // // // // // // // // // // //                               ? FileImage(_localImage!)
// // // // // // // // // // // // // // // // //                               : (_uploadedImageUrl != null
// // // // // // // // // // // // // // // // //                                   ? NetworkImage(_uploadedImageUrl!)
// // // // // // // // // // // // // // // // //                                   : const AssetImage('assets/avatar_placeholder.png'))
// // // // // // // // // // // // // // // // //                                       as ImageProvider,
// // // // // // // // // // // // // // // // //                           fit: BoxFit.cover,
// // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // // // // // //                       bottom: 0, right: 0,
// // // // // // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // // // // // //                           width: 44, height: 44,
// // // // // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // // //                           child: const Icon(Icons.camera_alt, color: Colors.white),
// // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //               const SizedBox(height: 32),

// // // // // // // // // // // // // // // // //               // --- Personal Info ---
// // // // // // // // // // // // // // // // //               _sectionLabel("Personal Information"),
// // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // //                 controller: _firstNameController,
// // // // // // // // // // // // // // // // //                 label: "First Name",
// // // // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // //                 controller: _lastNameController,
// // // // // // // // // // // // // // // // //                 label: "Last Name",
// // // // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // // //               ),

// // // // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // // // //               // --- Contact Details ---
// // // // // // // // // // // // // // // // //               _sectionLabel("Contact Details"),
// // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // // //                 label: "Email Address",
// // // // // // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // // // // // //                 enabled: false,
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // // //                 controller: _phoneController,
// // // // // // // // // // // // // // // // //                 label: "Phone Number",
// // // // // // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Please enter a phone" : null,
// // // // // // // // // // // // // // // // //               ),

// // // // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // // // //               // --- Account Actions ---
// // // // // // // // // // // // // // // // //               _sectionLabel("Account"),
// // // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // // // // // //                 label: "Change Password",
// // // // // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // // // // //                   // TODO: navigate
// // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // // // // // //                 label: "Delete Account",
// // // // // // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // // // // // //                       title: const Text("Delete Account"),
// // // // // // // // // // // // // // // // //                       content: const Text(
// // // // // // // // // // // // // // // // //                         "Are you sure? This cannot be undone."
// // // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // // //                           child: const Text("Cancel"),
// // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // // //                           onPressed: () {
// // // // // // // // // // // // // // // // //                             // TODO: delete
// // // // // // // // // // // // // // // // //                             Navigator.of(context).pop();
// // // // // // // // // // // // // // // // //                           },
// // // // // // // // // // // // // // // // //                           child: const Text("Delete", style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // // //                       ],
// // // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Widget _sectionLabel(String text) => Align(
// // // // // // // // // // // // // // // // //     alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // // //     child: Padding(
// // // // // // // // // // // // // // // // //       padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // // // // // // // // // // //       child: Text(
// // // // // // // // // // // // // // // // //         text,
// // // // // // // // // // // // // // // // //         style: TextStyle(
// // // // // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // // // // //           fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // // //           color: Colors.grey.shade800,
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //     ),
// // // // // // // // // // // // // // // // //   );

// // // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // // //       enabled: enabled,
// // // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // // //       validator: validator,
// // // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // // //         prefixIcon: icon != null ? Icon(icon) : null,
// // // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // // //         border: OutlineInputBorder(borderRadius: BorderRadius.circular(8)),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16, horizontal: 12),
// // // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // // //           color: Colors.grey.shade100,
// // // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // // // // // // //             const SizedBox(width: 12),
// // // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black87,
// // // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // // void main() => runApp(const MyApp());

// // // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // // //   const MyApp({super.key});
// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // // //             color: Colors.black, fontSize: 20, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // // //   const EditProfilePage({super.key});
// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // // //   String? _idUser;

// // // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // // //   final _firstNameController = TextEditingController();
// // // // // // // // // // // // // // // //   final _lastNameController  = TextEditingController();
// // // // // // // // // // // // // // // //   final _emailController     = TextEditingController();
// // // // // // // // // // // // // // // //   final _phoneController     = TextEditingController();

// // // // // // // // // // // // // // // //   File? _localImage;
// // // // // // // // // // // // // // // //   String? _uploadedImageUrl;
// // // // // // // // // // // // // // // //   final _picker = ImagePicker();

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // //     final raw = prefs.getString('user');
// // // // // // // // // // // // // // // //     if (raw != null) {
// // // // // // // // // // // // // // // //       final m = jsonDecode(raw);
// // // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // // //         _idUser = m['_id'] ?? m['id'] ?? '';
// // // // // // // // // // // // // // // //         _firstNameController.text = m['firstName'] ?? '';
// // // // // // // // // // // // // // // //         _lastNameController.text  = m['lastName']  ?? '';
// // // // // // // // // // // // // // // //         _emailController.text     = m['email']     ?? '';
// // // // // // // // // // // // // // // //         _phoneController.text     = m['phone']?.toString() ?? '';
// // // // // // // // // // // // // // // //         _uploadedImageUrl          = m['photoUrl'];
// // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Future<void> _saveLocally() async {
// // // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // // //     final m = {
// // // // // // // // // // // // // // // //       'idUser'    : _idUser,
// // // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // // //       'lastName' : _lastNameController.text,
// // // // // // // // // // // // // // // //       'email'    : _emailController.text,
// // // // // // // // // // // // // // // //       'phone'    : _phoneController.text,
// // // // // // // // // // // // // // // //       'photoUrl' : _uploadedImageUrl,
// // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // //     await prefs.setString('user', jsonEncode(m));
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // // //     final file = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // // //     if (file != null) {
// // // // // // // // // // // // // // // //       setState(() => _localImage = File(file.path));
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Future<void> _handleFormSubmit() async {
// // // // // // // // // // // // // // // //     if (_idUser == null || _idUser!.isEmpty) {
// // // // // // // // // // // // // // // //       throw Exception('User ID not found in preferences');
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //     // 1) JSON data patch
// // // // // // // // // // // // // // // //     final userData = {
// // // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // // //       'lastName' : _lastNameController.text,
// // // // // // // // // // // // // // // //       'phone'    : _phoneController.text,
// // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // //     final resp1 = await http.patch(
// // // // // // // // // // // // // // // //       Uri.parse('http://localhost:8000/users/${_idUser!}'),
// // // // // // // // // // // // // // // //       headers: {'Content-Type': 'application/json'},
// // // // // // // // // // // // // // // //       body: jsonEncode(userData),
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //     if (resp1.statusCode != 200) {
// // // // // // // // // // // // // // // //       throw Exception('User update failed (${resp1.statusCode})');
// // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // //     // 2) image patch if picked
// // // // // // // // // // // // // // // //     if (_localImage != null) {
// // // // // // // // // // // // // // // //       final req = http.MultipartRequest(
// // // // // // // // // // // // // // // //         'PATCH',
// // // // // // // // // // // // // // // //         Uri.parse('http://localhost:8000/upload/${_idUser!}'),
// // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // //       req.files.add(
// // // // // // // // // // // // // // // //         await http.MultipartFile.fromPath('file', _localImage!.path),
// // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // //       final streamed = await req.send();
// // // // // // // // // // // // // // // //       final resp2 = await http.Response.fromStream(streamed);
// // // // // // // // // // // // // // // //       if (resp2.statusCode == 200) {
// // // // // // // // // // // // // // // //         final body = jsonDecode(resp2.body);
// // // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // // //           _uploadedImageUrl = 'http://localhost:8000/images/${body['userImage']}';
// // // // // // // // // // // // // // // //           _localImage = null;
// // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // //         throw Exception('Image upload failed (${resp2.statusCode})');
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // //     // 3) save all
// // // // // // // // // // // // // // // //     await _saveLocally();
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // // // // // //               if (!_formKey.currentState!.validate()) return;
// // // // // // // // // // // // // // // //               try {
// // // // // // // // // // // // // // // //                 await _handleFormSubmit();
// // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully')),
// // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // // //               } catch (e) {
// // // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // // //                   SnackBar(content: Text('Error: $e')),
// // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // // // //                         image: DecorationImage(
// // // // // // // // // // // // // // // //                           image: _localImage != null
// // // // // // // // // // // // // // // //                               ? FileImage(_localImage!)
// // // // // // // // // // // // // // // //                               : (_uploadedImageUrl != null
// // // // // // // // // // // // // // // //                                   ? NetworkImage(_uploadedImageUrl!)
// // // // // // // // // // // // // // // //                                   : const AssetImage('assets/avatar_placeholder.png')) as ImageProvider,
// // // // // // // // // // // // // // // //                           fit: BoxFit.cover,
// // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // // // // //                       bottom: 0, right: 0,
// // // // // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // // // // //                           width: 44, height: 44,
// // // // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // // //                           child: const Icon(Icons.camera_alt, color: Colors.white),
// // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // // //               _sectionLabel("Personal Information"),
// // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // //                 controller: _firstNameController,
// // // // // // // // // // // // // // // //                 label: "First Name",
// // // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // //                 controller: _lastNameController,
// // // // // // // // // // // // // // // //                 label: "Last Name",
// // // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Required" : null,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // // //               _sectionLabel("Contact Details"),
// // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // // //                 label: "Email Address",
// // // // // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // // // // //                 enabled: false,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // // //                 controller: _phoneController,
// // // // // // // // // // // // // // // //                 label: "Phone Number",
// // // // // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? "Please enter a phone" : null,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // // //               _sectionLabel("Account"),
// // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // // // // //                 label: "Change Password",
// // // // // // // // // // // // // // // //                 onTap: () {/* TODO */},
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // // // // //                 label: "Delete Account",
// // // // // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // // // // //                       title: const Text("Delete Account"),
// // // // // // // // // // // // // // // //                       content: const Text("Are you sure? This cannot be undone."),
// // // // // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // // //                           child: const Text("Cancel"),
// // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // // //                           onPressed: () { Navigator.of(context).pop(); },
// // // // // // // // // // // // // // // //                           child: const Text("Delete", style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // // //                       ],
// // // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Widget _sectionLabel(String text) => Align(
// // // // // // // // // // // // // // // //     alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // // //     child: Padding(
// // // // // // // // // // // // // // // //       padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // // // // // // // // // //       child: Text(
// // // // // // // // // // // // // // // //         text,
// // // // // // // // // // // // // // // //         style: TextStyle(
// // // // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // // // //           fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // // //           color: Colors.grey.shade800,
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //     ),
// // // // // // // // // // // // // // // //   );

// // // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // // //       enabled: enabled,
// // // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // // //       validator: validator,
// // // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // // //         prefixIcon: icon != null ? Icon(icon) : null,
// // // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // // //         border: OutlineInputBorder(borderRadius: BorderRadius.circular(8)),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16, horizontal: 12),
// // // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // // //           color: Colors.grey.shade100,
// // // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // // // // // //             const SizedBox(width: 12),
// // // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black87,
// // // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // void main() => runApp(const MyApp());

// // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // //   const MyApp({super.key});

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // // //   const EditProfilePage({super.key});

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // // //   String? _idUser;

// // // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // // //   final _firstNameController = TextEditingController();
// // // // // // // // // // // // // // //   final _lastNameController = TextEditingController();
// // // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // // //   File? _localImage;
// // // // // // // // // // // // // // //   String? _uploadedImageUrl;
// // // // // // // // // // // // // // //   final _picker = ImagePicker();

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // //     final raw = prefs.getString('user');
// // // // // // // // // // // // // // //     if (raw != null) {
// // // // // // // // // // // // // // //       final m = jsonDecode(raw);
// // // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // // //         _idUser = m['idUser'] ?? m['_id'] ?? '';
// // // // // // // // // // // // // // //         _firstNameController.text = m['firstName'] ?? '';
// // // // // // // // // // // // // // //         _lastNameController.text = m['lastName'] ?? '';
// // // // // // // // // // // // // // //         _emailController.text = m['email'] ?? '';
// // // // // // // // // // // // // // //         _phoneController.text = m['phone']?.toString() ?? '';
// // // // // // // // // // // // // // //         _uploadedImageUrl = m['photoUrl'];
// // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Future<void> _saveLocally() async {
// // // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // // //     final m = {
// // // // // // // // // // // // // // //       'idUser': _idUser,
// // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // // // // // // // //       'email': _emailController.text,
// // // // // // // // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // // // // // // // //       'photoUrl': _uploadedImageUrl,
// // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // //     await prefs.setString('user', jsonEncode(m));
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // // //     final file = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // // //     if (file != null) {
// // // // // // // // // // // // // // //       setState(() => _localImage = File(file.path));
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Future<void> _handleFormSubmit() async {
// // // // // // // // // // // // // // //     if (_idUser == null || _idUser!.isEmpty) {
// // // // // // // // // // // // // // //       throw Exception('User ID not found');
// // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // //     // 1) Update user details via ELACO endpoint
// // // // // // // // // // // // // // //     final userData = {
// // // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // //     final resp1 = await http.patch(
// // // // // // // // // // // // // // //       Uri.parse('http://localhost:8000/ELACO/updateUser/${_idUser!}'),
// // // // // // // // // // // // // // //       headers: {'Content-Type': 'application/json'},
// // // // // // // // // // // // // // //       body: jsonEncode(userData),
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //     if (resp1.statusCode != 200) {
// // // // // // // // // // // // // // //       throw Exception('Failed to update user: ${resp1.statusCode}');
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //     final body1 = jsonDecode(resp1.body);
// // // // // // // // // // // // // // //     final updatedUser = body1['updatedUser'];
// // // // // // // // // // // // // // //     // reflect updatedUser in UI
// // // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // // //       _firstNameController.text = updatedUser['firstName'];
// // // // // // // // // // // // // // //       _lastNameController.text = updatedUser['lastName'];
// // // // // // // // // // // // // // //       _phoneController.text = updatedUser['phone'].toString();
// // // // // // // // // // // // // // //     });

// // // // // // // // // // // // // // //     // 2) upload image if picked
// // // // // // // // // // // // // // //     if (_localImage != null) {
// // // // // // // // // // // // // // //       final req = http.MultipartRequest(
// // // // // // // // // // // // // // //         'PATCH',
// // // // // // // // // // // // // // //         Uri.parse('http://localhost:8000/upload/${_idUser!}'),
// // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // //       req.files.add(
// // // // // // // // // // // // // // //         await http.MultipartFile.fromPath('file', _localImage!.path),
// // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // //       final streamed = await req.send();
// // // // // // // // // // // // // // //       final resp2 = await http.Response.fromStream(streamed);
// // // // // // // // // // // // // // //       if (resp2.statusCode == 200) {
// // // // // // // // // // // // // // //         final body2 = jsonDecode(resp2.body);
// // // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // // //           _uploadedImageUrl = 'http://localhost:8000/images/${body2['userImage']}';
// // // // // // // // // // // // // // //           _localImage = null;
// // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // //         throw Exception('Failed to upload image: ${resp2.statusCode}');
// // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // //     // 3) save all to prefs
// // // // // // // // // // // // // // //     await _saveLocally();
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // // // // //               if (!_formKey.currentState!.validate()) return;
// // // // // // // // // // // // // // //               try {
// // // // // // // // // // // // // // //                 await _handleFormSubmit();
// // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully')),
// // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // // //               } catch (e) {
// // // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // // //                   SnackBar(content: Text('Error: $e')),
// // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // //             },
// // // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // // //               'Save',
// // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // // //                         image: DecorationImage(
// // // // // // // // // // // // // // //                           image: _localImage != null
// // // // // // // // // // // // // // //                               ? FileImage(_localImage!)
// // // // // // // // // // // // // // //                               : (_uploadedImageUrl != null
// // // // // // // // // // // // // // //                                   ? NetworkImage(_uploadedImageUrl!)
// // // // // // // // // // // // // // //                                   : const AssetImage('assets/avatar_placeholder.png')) as ImageProvider,
// // // // // // // // // // // // // // //                           fit: BoxFit.cover,
// // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // // // //                       bottom: 0,
// // // // // // // // // // // // // // //                       right: 0,
// // // // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // // // //                           width: 44,
// // // // // // // // // // // // // // //                           height: 44,
// // // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // // //                           child: const Icon(Icons.camera_alt, color: Colors.white),
// // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // //               _sectionLabel('Personal Information'),
// // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // //                 controller: _firstNameController,
// // // // // // // // // // // // // // //                 label: 'First Name',
// // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Required' : null,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // //                 controller: _lastNameController,
// // // // // // // // // // // // // // //                 label: 'Last Name',
// // // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Required' : null,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // //               _sectionLabel('Contact Details'),
// // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // // //                 label: 'Email Address',
// // // // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // // // //                 enabled: false,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // // //                 controller: _phoneController,
// // // // // // // // // // // // // // //                 label: 'Phone Number',
// // // // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Please enter a phone' : null,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // // //               _sectionLabel('Account'),
// // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // // // //                 label: 'Change Password',
// // // // // // // // // // // // // // //                 onTap: () {},
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // // // //                 label: 'Delete Account',
// // // // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // // // //                       title: const Text('Delete Account'),
// // // // // // // // // // // // // // //                       content: const Text('Are you sure? This cannot be undone.'),
// // // // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // //                           child: const Text('Cancel'),
// // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // // //                           child: const Text('Delete', style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // // //                       ],
// // // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Widget _sectionLabel(String text) => Align(
// // // // // // // // // // // // // // //     alignment: Alignment.centerLeft,
// // // // // // // // // // // // // // //     child: Padding(
// // // // // // // // // // // // // // //       padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // // // // // // // // //       child: Text(
// // // // // // // // // // // // // // //         text,
// // // // // // // // // // // // // // //         style: TextStyle(
// // // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // // //           fontWeight: FontWeight.w600,
// // // // // // // // // // // // // // //           color: Colors.grey.shade800,
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //     ),
// // // // // // // // // // // // // // //   );

// // // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // // //       enabled: enabled,
// // // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // // //       validator: validator,
// // // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // // //         prefixIcon: icon != null ? Icon(icon) : null,
// // // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // // //         border: OutlineInputBorder(borderRadius: BorderRadius.circular(8)),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16, horizontal: 12),
// // // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // // //           color: Colors.grey.shade100,
// // // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // // // // //             const SizedBox(width: 12),
// // // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black87,
// // // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // // // import 'dart:io';

// // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // // void main() => runApp(const MyApp());

// // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // //   const MyApp({super.key});

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // //   const EditProfilePage({super.key});

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // //   String? _idUser;

// // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // // // // // // // // // //   final _firstNameController = TextEditingController();
// // // // // // // // // // // // // //   final _lastNameController = TextEditingController();
// // // // // // // // // // // // // //   final _emailController = TextEditingController();
// // // // // // // // // // // // // //   final _phoneController = TextEditingController();

// // // // // // // // // // // // // //   File? _localImage;
// // // // // // // // // // // // // //   String? _uploadedImageUrl;
// // // // // // // // // // // // // //   final _picker = ImagePicker();

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // //     final raw = prefs.getString('user');
// // // // // // // // // // // // // //     if (raw != null) {
// // // // // // // // // // // // // //       final m = jsonDecode(raw);
// // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // //         _idUser = m['idUser'] ?? m['_id'] ?? '';
// // // // // // // // // // // // // //         _firstNameController.text = m['firstName'] ?? '';
// // // // // // // // // // // // // //         _lastNameController.text = m['lastName'] ?? '';
// // // // // // // // // // // // // //         _emailController.text = m['email'] ?? '';
// // // // // // // // // // // // // //         _phoneController.text = m['phone']?.toString() ?? '';
// // // // // // // // // // // // // //         _uploadedImageUrl = m['photoUrl'];
// // // // // // // // // // // // // //       });
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Future<void> _saveLocally() async {
// // // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // // //     final m = {
// // // // // // // // // // // // // //       'idUser': _idUser,
// // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // // // // // // //       'email': _emailController.text,
// // // // // // // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // // // // // // //       'photoUrl': _uploadedImageUrl,
// // // // // // // // // // // // // //     };
// // // // // // // // // // // // // //     await prefs.setString('user', jsonEncode(m));
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // //     final file = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // //     if (file != null) {
// // // // // // // // // // // // // //       setState(() => _localImage = File(file.path));
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Future<void> _handleFormSubmit() async {
// // // // // // // // // // // // // //     if (_idUser == null || _idUser!.isEmpty) {
// // // // // // // // // // // // // //       throw Exception('User ID not found');
// // // // // // // // // // // // // //     }

// // // // // // // // // // // // // //     // 1) Update user details via ELACO endpoint
// // // // // // // // // // // // // //     final userData = {
// // // // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // // // // // // //     };
// // // // // // // // // // // // // //     final resp1 = await http.patch(
// // // // // // // // // // // // // //       Uri.parse('http://localhost:8000/ELACO/updateUser/${_idUser!}'),
// // // // // // // // // // // // // //       headers: {'Content-Type': 'application/json'},
// // // // // // // // // // // // // //       body: jsonEncode(userData),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //     if (resp1.statusCode != 200) {
// // // // // // // // // // // // // //       throw Exception('Failed to update user: ${resp1.statusCode}');
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //     final body1 = jsonDecode(resp1.body);
// // // // // // // // // // // // // //     final updatedUser = body1['updatedUser'];

// // // // // // // // // // // // // //     // reflect updatedUser in UI and save to prefs
// // // // // // // // // // // // // //     setState(() {
// // // // // // // // // // // // // //       _firstNameController.text = updatedUser['firstName'];
// // // // // // // // // // // // // //       _lastNameController.text = updatedUser['lastName'];
// // // // // // // // // // // // // //       _phoneController.text = updatedUser['phone'].toString();
// // // // // // // // // // // // // //     });
// // // // // // // // // // // // // //     await _saveLocally();

// // // // // // // // // // // // // //     // 2) upload image if picked
// // // // // // // // // // // // // //     if (_localImage != null) {
// // // // // // // // // // // // // //       final req = http.MultipartRequest(
// // // // // // // // // // // // // //         'PATCH',
// // // // // // // // // // // // // //         Uri.parse('http://localhost:8000/upload/${_idUser!}'),
// // // // // // // // // // // // // //       );
// // // // // // // // // // // // // //       req.files.add(
// // // // // // // // // // // // // //         await http.MultipartFile.fromPath('file', _localImage!.path),
// // // // // // // // // // // // // //       );
// // // // // // // // // // // // // //       final streamed = await req.send();
// // // // // // // // // // // // // //       final resp2 = await http.Response.fromStream(streamed);
// // // // // // // // // // // // // //       if (resp2.statusCode == 200) {
// // // // // // // // // // // // // //         final body2 = jsonDecode(resp2.body);
// // // // // // // // // // // // // //         setState(() {
// // // // // // // // // // // // // //           _uploadedImageUrl =
// // // // // // // // // // // // // //               'http://localhost:8000/images/${body2['userImage']}';
// // // // // // // // // // // // // //           _localImage = null;
// // // // // // // // // // // // // //         });
// // // // // // // // // // // // // //         await _saveLocally();
// // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // //         throw Exception('Failed to upload image: ${resp2.statusCode}');
// // // // // // // // // // // // // //       }
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // //           // TextButton(
// // // // // // // // // // // // // //           //   onPressed: () async {
// // // // // // // // // // // // // //           //     if (!_formKey.currentState!.validate()) return;
// // // // // // // // // // // // // //           //     try {
// // // // // // // // // // // // // //           //       await _handleFormSubmit();
// // // // // // // // // // // // // //           //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //           //         const SnackBar(content: Text('Profile updated successfully')),
// // // // // // // // // // // // // //           //       );
// // // // // // // // // // // // // //           //       // Navigator.of(context).pop();
// // // // // // // // // // // // // //           //       Navigator.of(context).pop<bool>(true);
// // // // // // // // // // // // // //           //     } catch (e) {
// // // // // // // // // // // // // //           //       ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //           //         SnackBar(content: Text('Error: $e')),
// // // // // // // // // // // // // //           //       );
// // // // // // // // // // // // // //           //     }
// // // // // // // // // // // // // //           //   },
// // // // // // // // // // // // // //           //   child: const Text(
// // // // // // // // // // // // // //           //     'Save',
// // // // // // // // // // // // // //           //     style: TextStyle(
// // // // // // // // // // // // // //           //       color: Color(0xFF45BDA7),
// // // // // // // // // // // // // //           //       fontWeight: FontWeight.bold,
// // // // // // // // // // // // // //           //       fontSize: 16,
// // // // // // // // // // // // // //           //     ),
// // // // // // // // // // // // // //           //   ),
// // // // // // // // // // // // // //           // ),

// // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // // // //               if (!_formKey.currentState!.validate()) return;
// // // // // // // // // // // // // //               try {
// // // // // // // // // // // // // //                 await _handleFormSubmit();
// // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully')),
// // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // //                 // ← Replace the pop() here with pushReplacementNamed:
// // // // // // // // // // // // // //                 Navigator.of(context).pushReplacementNamed('/profile');
// // // // // // // // // // // // // //               } catch (e) {
// // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //                   SnackBar(content: Text('Error: $e')),
// // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // //               }
// // // // // // // // // // // // // //             },
// // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // //               'Save',
// // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // // //             children: [
// // // // // // // // // // // // // //               Center(
// // // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // // //                         image: DecorationImage(
// // // // // // // // // // // // // //                           image: _localImage != null
// // // // // // // // // // // // // //                               ? FileImage(_localImage!)
// // // // // // // // // // // // // //                               : (_uploadedImageUrl != null
// // // // // // // // // // // // // //                                       ? NetworkImage(_uploadedImageUrl!)
// // // // // // // // // // // // // //                                       : const AssetImage(
// // // // // // // // // // // // // //                                           'assets/avatar_placeholder.png'))
// // // // // // // // // // // // // //                                   as ImageProvider,
// // // // // // // // // // // // // //                           fit: BoxFit.cover,
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // // //                       bottom: 0,
// // // // // // // // // // // // // //                       right: 0,
// // // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // // //                           width: 44,
// // // // // // // // // // // // // //                           height: 44,
// // // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // //                           child:
// // // // // // // // // // // // // //                               const Icon(Icons.camera_alt, color: Colors.white),
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // //               _sectionLabel('Personal Information'),
// // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // //                 controller: _firstNameController,
// // // // // // // // // // // // // //                 label: 'First Name',
// // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Required' : null,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // //                 controller: _lastNameController,
// // // // // // // // // // // // // //                 label: 'Last Name',
// // // // // // // // // // // // // //                 icon: Icons.person_outline,
// // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Required' : null,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // //               _sectionLabel('Contact Details'),
// // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // //                 controller: _emailController,
// // // // // // // // // // // // // //                 label: 'Email Address',
// // // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // // //                 enabled: false,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // //               _buildTextField(
// // // // // // // // // // // // // //                 controller: _phoneController,
// // // // // // // // // // // // // //                 label: 'Phone Number',
// // // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // // //                 validator: (v) => v!.isEmpty ? 'Please enter a phone' : null,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 32),
// // // // // // // // // // // // // //               _sectionLabel('Account'),
// // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // // //                 label: 'Change Password',
// // // // // // // // // // // // // //                 onTap: () {},
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // // //               _buildActionButton(
// // // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // // //                 label: 'Delete Account',
// // // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // // //                       title: const Text('Delete Account'),
// // // // // // // // // // // // // //                       content:
// // // // // // // // // // // // // //                           const Text('Are you sure? This cannot be undone.'),
// // // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // //                           child: const Text('Cancel'),
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // // //                           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // //                           child: const Text('Delete',
// // // // // // // // // // // // // //                               style: TextStyle(color: Colors.red)),
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                       ],
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   );
// // // // // // // // // // // // // //                 },
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //             ],
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Widget _sectionLabel(String text) => Align(
// // // // // // // // // // // // // //         alignment: Alignment.centerLeft,
// // // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // // // // // // // //           child: Text(
// // // // // // // // // // // // // //             text,
// // // // // // // // // // // // // //             style: TextStyle(
// // // // // // // // // // // // // //               fontSize: 16,
// // // // // // // // // // // // // //               fontWeight: FontWeight.w600,
// // // // // // // // // // // // // //               color: Colors.grey.shade800,
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       );

// // // // // // // // // // // // // //   Widget _buildTextField({
// // // // // // // // // // // // // //     required TextEditingController controller,
// // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // //     bool enabled = true,
// // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // //     String? Function(String?)? validator,
// // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // //     return TextFormField(
// // // // // // // // // // // // // //       controller: controller,
// // // // // // // // // // // // // //       enabled: enabled,
// // // // // // // // // // // // // //       keyboardType: keyboardType,
// // // // // // // // // // // // // //       validator: validator,
// // // // // // // // // // // // // //       decoration: InputDecoration(
// // // // // // // // // // // // // //         prefixIcon: icon != null ? Icon(icon) : null,
// // // // // // // // // // // // // //         labelText: label,
// // // // // // // // // // // // // //         border: OutlineInputBorder(borderRadius: BorderRadius.circular(8)),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16, horizontal: 12),
// // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // //           color: Colors.grey.shade100,
// // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(8),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // // // //             const SizedBox(width: 12),
// // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // //                 color: isDestructive ? Colors.red : Colors.black87,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';

// // // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // // //   const MyApp({Key? key}) : super(key: key);

// // // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7), // Teal accent color from your UI
// // // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // // //   // User data
// // // // // // // // // // // // // //   String _firstName = "Khalil";
// // // // // // // // // // // // // //   String _lastName = "Riahi";
// // // // // // // // // // // // // //   String _email = "khaliloz9003@gmail.com";
// // // // // // // // // // // // // //   String _phoneNumber = "96452097";
// // // // // // // // // // // // // //   File? _profileImage;

// // // // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // // //         _profileImage = File(image.path);
// // // // // // // // // // // // // //       });
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // // //         leading: IconButton(
// // // // // // // // // // // // // //           icon: const Icon(Icons.arrow_back),
// // // // // // // // // // // // // //           onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // // //             onPressed: () {
// // // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // // //                 _formKey.currentState!.save();
// // // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // // //                   SnackBar(
// // // // // // // // // // // // // //                     content: const Text("Profile updated successfully"),
// // // // // // // // // // // // // //                     backgroundColor: const Color(0xFF45BDA7),
// // // // // // // // // // // // // //                     behavior: SnackBarBehavior.floating,
// // // // // // // // // // // // // //                     shape: RoundedRectangleBorder(
// // // // // // // // // // // // // //                       borderRadius: BorderRadius.circular(10),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                     margin: EdgeInsets.only(
// // // // // // // // // // // // // //                       bottom: MediaQuery.of(context).size.height - 100,
// // // // // // // // // // // // // //                       left: 20,
// // // // // // // // // // // // // //                       right: 20,
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // // //               }
// // // // // // // // // // // // // //             },
// // // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // // //           padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 16.0),
// // // // // // // // // // // // // //           child: Form(
// // // // // // // // // // // // // //             key: _formKey,
// // // // // // // // // // // // // //             child: Column(
// // // // // // // // // // // // // //               crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // // // //               children: [
// // // // // // // // // // // // // //                 const SizedBox(height: 20),
// // // // // // // // // // // // // //                 // Profile Image
// // // // // // // // // // // // // //                 Center(
// // // // // // // // // // // // // //                   child: Stack(
// // // // // // // // // // // // // //                     children: [
// // // // // // // // // // // // // //                       Container(
// // // // // // // // // // // // // //                         width: 140,
// // // // // // // // // // // // // //                         height: 140,
// // // // // // // // // // // // // //                         decoration: BoxDecoration(
// // // // // // // // // // // // // //                           color: Colors.grey.shade100,
// // // // // // // // // // // // // //                           shape: BoxShape.circle,
// // // // // // // // // // // // // //                           border: Border.all(
// // // // // // // // // // // // // //                             color: Colors.white,
// // // // // // // // // // // // // //                             width: 4,
// // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // //                           boxShadow: [
// // // // // // // // // // // // // //                             BoxShadow(
// // // // // // // // // // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // // // // // // // // // //                               spreadRadius: 2,
// // // // // // // // // // // // // //                               blurRadius: 8,
// // // // // // // // // // // // // //                               offset: const Offset(0, 2),
// // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // //                           ],
// // // // // // // // // // // // // //                           image: _profileImage != null
// // // // // // // // // // // // // //                               ? DecorationImage(
// // // // // // // // // // // // // //                                   image: FileImage(_profileImage!),
// // // // // // // // // // // // // //                                   fit: BoxFit.cover,
// // // // // // // // // // // // // //                                 )
// // // // // // // // // // // // // //                               : null,
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                         child: _profileImage == null
// // // // // // // // // // // // // //                             ? const Icon(
// // // // // // // // // // // // // //                                 Icons.person,
// // // // // // // // // // // // // //                                 size: 70,
// // // // // // // // // // // // // //                                 color: Colors.grey,
// // // // // // // // // // // // // //                               )
// // // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                       Positioned(
// // // // // // // // // // // // // //                         bottom: 0,
// // // // // // // // // // // // // //                         right: 0,
// // // // // // // // // // // // // //                         child: GestureDetector(
// // // // // // // // // // // // // //                           onTap: _pickImage,
// // // // // // // // // // // // // //                           child: Container(
// // // // // // // // // // // // // //                             width: 44,
// // // // // // // // // // // // // //                             height: 44,
// // // // // // // // // // // // // //                             decoration: BoxDecoration(
// // // // // // // // // // // // // //                               color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // //                               shape: BoxShape.circle,
// // // // // // // // // // // // // //                               border: Border.all(
// // // // // // // // // // // // // //                                 color: Colors.white,
// // // // // // // // // // // // // //                                 width: 3,
// // // // // // // // // // // // // //                               ),
// // // // // // // // // // // // // //                               boxShadow: [
// // // // // // // // // // // // // //                                 BoxShadow(
// // // // // // // // // // // // // //                                   color: Colors.grey.withOpacity(0.3),
// // // // // // // // // // // // // //                                   spreadRadius: 1,
// // // // // // // // // // // // // //                                   blurRadius: 3,
// // // // // // // // // // // // // //                                   offset: const Offset(0, 1),
// // // // // // // // // // // // // //                                 ),
// // // // // // // // // // // // // //                               ],
// // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // //                             child: const Icon(
// // // // // // // // // // // // // //                               Icons.camera_alt,
// // // // // // // // // // // // // //                               color: Colors.white,
// // // // // // // // // // // // // //                               size: 22,
// // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ],
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 50),

// // // // // // // // // // // // // //                 // Name section label
// // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // //                     padding: const EdgeInsets.only(left: 8.0, bottom: 12.0),
// // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // //                       "Personal Information",
// // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // //                 // First Name & Last Name Row
// // // // // // // // // // // // // //                 Row(
// // // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // //                         icon: Icons.person_outline,
// // // // // // // // // // // // // //                         label: "First Name",
// // // // // // // // // // // // // //                         initialValue: _firstName,
// // // // // // // // // // // // // //                         onSaved: (value) => _firstName = value!,
// // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // //                           if (value == null || value.isEmpty) {
// // // // // // // // // // // // // //                             return "Required";
// // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                     const SizedBox(width: 16),
// // // // // // // // // // // // // //                     Expanded(
// // // // // // // // // // // // // //                       child: _buildProfileField(
// // // // // // // // // // // // // //                         icon: null, // No icon for better alignment
// // // // // // // // // // // // // //                         label: "Last Name",
// // // // // // // // // // // // // //                         initialValue: _lastName,
// // // // // // // // // // // // // //                         onSaved: (value) => _lastName = value!,
// // // // // // // // // // // // // //                         validator: (value) {
// // // // // // // // // // // // // //                           if (value == null || value.isEmpty) {
// // // // // // // // // // // // // //                             return "Required";
// // // // // // // // // // // // // //                           }
// // // // // // // // // // // // // //                           return null;
// // // // // // // // // // // // // //                         },
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ],
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // //                 // Contact section label
// // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // //                     padding: const EdgeInsets.only(left: 8.0, bottom: 12.0, top: 16.0),
// // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // //                       "Contact Details",
// // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // //                 // Email
// // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // //                   icon: Icons.email_outlined,
// // // // // // // // // // // // // //                   label: "Email Address",
// // // // // // // // // // // // // //                   initialValue: _email,
// // // // // // // // // // // // // //                   onSaved: (value) => _email = value!,
// // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // //                       return "Please enter an email";
// // // // // // // // // // // // // //                     } else if (!RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$').hasMatch(value)) {
// // // // // // // // // // // // // //                       return "Please enter a valid email";
// // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                   keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // //                 // Phone Number
// // // // // // // // // // // // // //                 _buildProfileField(
// // // // // // // // // // // // // //                   icon: Icons.phone_outlined,
// // // // // // // // // // // // // //                   label: "Phone Number",
// // // // // // // // // // // // // //                   initialValue: _phoneNumber,
// // // // // // // // // // // // // //                   onSaved: (value) => _phoneNumber = value!,
// // // // // // // // // // // // // //                   validator: (value) {
// // // // // // // // // // // // // //                     if (value == null || value.isEmpty) {
// // // // // // // // // // // // // //                       return "Please enter a phone number";
// // // // // // // // // // // // // //                     }
// // // // // // // // // // // // // //                     return null;
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                   keyboardType: TextInputType.phone,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 40),

// // // // // // // // // // // // // //                 // Account section label
// // // // // // // // // // // // // //                 Align(
// // // // // // // // // // // // // //                   alignment: Alignment.centerLeft,
// // // // // // // // // // // // // //                   child: Padding(
// // // // // // // // // // // // // //                     padding: const EdgeInsets.only(left: 8.0, bottom: 12.0),
// // // // // // // // // // // // // //                     child: Text(
// // // // // // // // // // // // // //                       "Account",
// // // // // // // // // // // // // //                       style: TextStyle(
// // // // // // // // // // // // // //                         color: Colors.grey.shade800,
// // // // // // // // // // // // // //                         fontWeight: FontWeight.w600,
// // // // // // // // // // // // // //                         fontSize: 16,
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     ),
// // // // // // // // // // // // // //                   ),
// // // // // // // // // // // // // //                 ),

// // // // // // // // // // // // // //                 // Change Password Button
// // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // //                   icon: Icons.lock_outline,
// // // // // // // // // // // // // //                   label: "Change Password",
// // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // //                     // Implement password change logic
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 20),

// // // // // // // // // // // // // //                 // Delete Account Button
// // // // // // // // // // // // // //                 _buildActionButton(
// // // // // // // // // // // // // //                   icon: Icons.delete_outline,
// // // // // // // // // // // // // //                   label: "Delete Account",
// // // // // // // // // // // // // //                   onTap: () {
// // // // // // // // // // // // // //                     // Show delete account confirmation
// // // // // // // // // // // // // //                     showDialog(
// // // // // // // // // // // // // //                       context: context,
// // // // // // // // // // // // // //                       builder: (context) => AlertDialog(
// // // // // // // // // // // // // //                         title: const Text("Delete Account"),
// // // // // // // // // // // // // //                         content: const Text("Are you sure you want to delete your account? This action cannot be undone."),
// // // // // // // // // // // // // //                         shape: RoundedRectangleBorder(
// // // // // // // // // // // // // //                           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // //                         ),
// // // // // // // // // // // // // //                         actions: [
// // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // //                             onPressed: () => Navigator.of(context).pop(),
// // // // // // // // // // // // // //                             child: const Text(
// // // // // // // // // // // // // //                               "Cancel",
// // // // // // // // // // // // // //                               style: TextStyle(color: Colors.grey),
// // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // //                           TextButton(
// // // // // // // // // // // // // //                             onPressed: () {
// // // // // // // // // // // // // //                               // Delete account logic
// // // // // // // // // // // // // //                               Navigator.of(context).pop();
// // // // // // // // // // // // // //                             },
// // // // // // // // // // // // // //                             child: const Text(
// // // // // // // // // // // // // //                               "Delete",
// // // // // // // // // // // // // //                               style: TextStyle(color: Colors.red),
// // // // // // // // // // // // // //                             ),
// // // // // // // // // // // // // //                           ),
// // // // // // // // // // // // // //                         ],
// // // // // // // // // // // // // //                       ),
// // // // // // // // // // // // // //                     );
// // // // // // // // // // // // // //                   },
// // // // // // // // // // // // // //                   isDestructive: true,
// // // // // // // // // // // // // //                 ),
// // // // // // // // // // // // // //                 const SizedBox(height: 40),
// // // // // // // // // // // // // //               ],
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Widget _buildProfileField({
// // // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // //     required String initialValue,
// // // // // // // // // // // // // //     required Function(String?) onSaved,
// // // // // // // // // // // // // //     required String? Function(String?) validator,
// // // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // // //         color: Colors.grey.shade50,
// // // // // // // // // // // // // //         borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // //         boxShadow: [
// // // // // // // // // // // // // //           BoxShadow(
// // // // // // // // // // // // // //             color: Colors.grey.withOpacity(0.05),
// // // // // // // // // // // // // //             spreadRadius: 1,
// // // // // // // // // // // // // //             blurRadius: 3,
// // // // // // // // // // // // // //             offset: const Offset(0, 1),
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ],
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // // //         initialValue: initialValue,
// // // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // // //           prefixIcon: icon != null
// // // // // // // // // // // // // //               ? Icon(icon, color: Colors.grey.shade600, size: 22)
// // // // // // // // // // // // // //               : null,
// // // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // // //           labelStyle: TextStyle(
// // // // // // // // // // // // // //             color: Colors.grey.shade600,
// // // // // // // // // // // // // //             fontSize: 15,
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //           floatingLabelStyle: TextStyle(
// // // // // // // // // // // // // //             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // // //             fontWeight: FontWeight.w500,
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // // //           contentPadding: EdgeInsets.symmetric(
// // // // // // // // // // // // // //             vertical: 16,
// // // // // // // // // // // // // //             horizontal: icon == null ? 16 : 0,
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //           errorStyle: const TextStyle(
// // // // // // // // // // // // // //             color: Colors.redAccent,
// // // // // // // // // // // // // //             fontSize: 12,
// // // // // // // // // // // // // //           ),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // // //         onSaved: onSaved,
// // // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // // //         style: const TextStyle(
// // // // // // // // // // // // // //           fontSize: 16,
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }

// // // // // // // // // // // // // //   Widget _buildActionButton({
// // // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // // //   }) {
// // // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // // //       borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 18),
// // // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // // // //           borderRadius: BorderRadius.circular(16),
// // // // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // // //           children: [
// // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // //               icon,
// // // // // // // // // // // // // //               color: isDestructive ? Colors.redAccent : const Color(0xFF45BDA7),
// // // // // // // // // // // // // //               size: 22,
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // // //             Text(
// // // // // // // // // // // // // //               label,
// // // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // // //                 fontWeight: FontWeight.w500,
// // // // // // // // // // // // // //                 color: isDestructive ? Colors.redAccent : Colors.black87,
// // // // // // // // // // // // // //               ),
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // // //             Icon(
// // // // // // // // // // // // // //               Icons.arrow_forward_ios,
// // // // // // // // // // // // // //               size: 16,
// // // // // // // // // // // // // //               color: Colors.grey.shade400,
// // // // // // // // // // // // // //             ),
// // // // // // // // // // // // // //             const SizedBox(width: 20),
// // // // // // // // // // // // // //           ],
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // import 'dart:convert';

// // // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // // // void main() {
// // // // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // // // //   const MyApp({super.key});
// // // // // // // // // // // // // //   @override
// // // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7), // Teal accent
// // // // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // // // //               color: Colors.black, fontSize: 20, fontWeight: FontWeight.bold),
// // // // // // // // // // // // // //         ),
// // // // // // // // // // // // // //       ),
// // // // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // // // //     );
// // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // }

// // // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);
// // // // // // // // // // // // //   @override
// // // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // // }

// // // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // // //   // String nom = '';
// // // // // // // // // // // // //   // String prenom = '';
// // // // // // // // // // // // //   // String mail = '';
// // // // // // // // // // // // //   // var tel = 0;
// // // // // // // // // // // // //   // var points = 0;
// // // // // // // // // // // // //   var photo = "";

// // // // // // // // // // // // //   // User data
// // // // // // // // // // // // //   String _firstName = "";
// // // // // // // // // // // // //   String _lastName = "";
// // // // // // // // // // // // //   String _email = "";
// // // // // // // // // // // // //   int _phone = 0;
// // // // // // // // // // // // //   File? _profileImage;
// // // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   @override
// // // // // // // // // // // // //   void initState() {
// // // // // // // // // // // // //     super.initState();
// // // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // // // // //     if (userJson != null) {
// // // // // // // // // // // // //       final userMap = jsonDecode(userJson);
// // // // // // // // // // // // //       setState(() {
// // // // // // // // // // // // //         _lastName = userMap['firstName'] ?? '';
// // // // // // // // // // // // //         _firstName = userMap['lastName'] ?? '';
// // // // // // // // // // // // //         _email = userMap['email'] ?? '';
// // // // // // // // // // // // //         _phone = userMap['phone'] ?? '';
// // // // // // // // // // // // //         // points = userMap['points'] ?? 0;
// // // // // // // // // // // // //         photo = userMap['photoUrl'] ?? '';
// // // // // // // // // // // // //       });
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   @override
// // // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // // //         title: const Text("Edit Profile"),
// // // // // // // // // // // // //         actions: [
// // // // // // // // // // // // //           TextButton(
// // // // // // // // // // // // //             onPressed: () {
// // // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // // //                 _formKey.currentState!.save();
// // // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // // //                   const SnackBar(
// // // // // // // // // // // // //                     content: Text("Profile updated successfully"),
// // // // // // // // // // // // //                     backgroundColor: Color(0xFF45BDA7),
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                 );
// // // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // // //               }
// // // // // // // // // // // // //             },
// // // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // // //               "Save",
// // // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // // //                 color: Color(0xFF45BDA7),
// // // // // // // // // // // // //                 fontWeight: FontWeight.bold,
// // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //             ),
// // // // // // // // // // // // //           ),
// // // // // // // // // // // // //         ],
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // // //         child: Form(
// // // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // // //           child: Column(
// // // // // // // // // // // // //             children: [
// // // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // // //               // Profile Image
// // // // // // // // // // // // //               Center(
// // // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // // //                   children: [
// // // // // // // // // // // // //                     Container(
// // // // // // // // // // // // //                       width: 140,
// // // // // // // // // // // // //                       height: 140,
// // // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // // //                         boxShadow: [
// // // // // // // // // // // // //                           BoxShadow(
// // // // // // // // // // // // //                             color: Colors.grey.withOpacity(0.2),
// // // // // // // // // // // // //                             spreadRadius: 2,
// // // // // // // // // // // // //                             blurRadius: 8,
// // // // // // // // // // // // //                             offset: const Offset(0, 2),
// // // // // // // // // // // // //                           ),
// // // // // // // // // // // // //                         ],
// // // // // // // // // // // // //                         image: _profileImage != null
// // // // // // // // // // // // //                             ? DecorationImage(
// // // // // // // // // // // // //                                 image: FileImage(_profileImage!),
// // // // // // // // // // // // //                                 fit: BoxFit.cover,
// // // // // // // // // // // // //                               )
// // // // // // // // // // // // //                             : null,
// // // // // // // // // // // // //                       ),
// // // // // // // // // // // // //                       child: _profileImage == null
// // // // // // // // // // // // //                           ? const Icon(Icons.person,
// // // // // // // // // // // // //                               size: 70, color: Colors.grey)
// // // // // // // // // // // // //                           : null,
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                     Positioned(
// // // // // // // // // // // // //                       bottom: 0,
// // // // // // // // // // // // //                       right: 0,
// // // // // // // // // // // // //                       child: GestureDetector(
// // // // // // // // // // // // //                         onTap: _pickImage,
// // // // // // // // // // // // //                         child: Container(
// // // // // // // // // // // // //                           width: 44,
// // // // // // // // // // // // //                           height: 44,
// // // // // // // // // // // // //                           decoration: BoxDecoration(
// // // // // // // // // // // // //                             color: const Color(0xFF45BDA7),
// // // // // // // // // // // // //                             shape: BoxShape.circle,
// // // // // // // // // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // // // // // // // // //                             boxShadow: [
// // // // // // // // // // // // //                               BoxShadow(
// // // // // // // // // // // // //                                 color: Colors.grey.withOpacity(0.3),
// // // // // // // // // // // // //                                 spreadRadius: 1,
// // // // // // // // // // // // //                                 blurRadius: 3,
// // // // // // // // // // // // //                                 offset: const Offset(0, 1),
// // // // // // // // // // // // //                               ),
// // // // // // // // // // // // //                             ],
// // // // // // // // // // // // //                           ),
// // // // // // // // // // // // //                           child: const Icon(Icons.camera_alt,
// // // // // // // // // // // // //                               color: Colors.white, size: 22),
// // // // // // // // // // // // //                         ),
// // // // // // // // // // // // //                       ),
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ],
// // // // // // // // // // // // //                 ),
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //               const SizedBox(height: 40),

// // // // // // // // // // // // //               // Personal Information
// // // // // // // // // // // // //               _sectionLabel("Personal Information"),
// // // // // // // // // // // // //               Row(
// // // // // // // // // // // // //                 children: [
// // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // //                     child: _buildField(
// // // // // // // // // // // // //                       icon: Icons.person_outline,
// // // // // // // // // // // // //                       label: "First Name",
// // // // // // // // // // // // //                       initialValue: _firstName,
// // // // // // // // // // // // //                       onSaved: (v) => _firstName = v!,
// // // // // // // // // // // // //                       validator: (v) =>
// // // // // // // // // // // // //                           (v == null || v.isEmpty) ? "Required" : null,
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                   const SizedBox(width: 16),
// // // // // // // // // // // // //                   Expanded(
// // // // // // // // // // // // //                     child: _buildField(
// // // // // // // // // // // // //                       icon: Icons.person_outline,
// // // // // // // // // // // // //                       label: "Last Name",
// // // // // // // // // // // // //                       initialValue: _lastName,
// // // // // // // // // // // // //                       onSaved: (v) => _lastName = v!,
// // // // // // // // // // // // //                       validator: (v) =>
// // // // // // // // // // // // //                           (v == null || v.isEmpty) ? "Required" : null,
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   ),
// // // // // // // // // // // // //                 ],
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //               const SizedBox(height: 30),

// // // // // // // // // // // // //               // Contact Details
// // // // // // // // // // // // //               _sectionLabel("Contact Details"),
// // // // // // // // // // // // //               _buildField(
// // // // // // // // // // // // //                 icon: Icons.email_outlined,
// // // // // // // // // // // // //                 label: "Email Address",
// // // // // // // // // // // // //                 initialValue: _email,
// // // // // // // // // // // // //                 onSaved: (_) {},
// // // // // // // // // // // // //                 validator: (_) => null,
// // // // // // // // // // // // //                 keyboardType: TextInputType.emailAddress,
// // // // // // // // // // // // //                 enabled: false, // ← read-only
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // // //               _buildField(
// // // // // // // // // // // // //                 icon: Icons.phone_outlined,
// // // // // // // // // // // // //                 label: "Phone Number",
// // // // // // // // // // // // //                 initialValue: "",
// // // // // // // // // // // // //                 onSaved: (v) => _phone = v! as int,
// // // // // // // // // // // // //                 validator: (v) => (v == null || v.isEmpty) ? "Required" : null,
// // // // // // // // // // // // //                 keyboardType: TextInputType.phone,
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //               const SizedBox(height: 40),

// // // // // // // // // // // // //               // Account Actions
// // // // // // // // // // // // //               _sectionLabel("Account"),
// // // // // // // // // // // // //               _buildAction(
// // // // // // // // // // // // //                 icon: Icons.lock_outline,
// // // // // // // // // // // // //                 label: "Change Password",
// // // // // // // // // // // // //                 onTap: () {/* TODO */},
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // // //               _buildAction(
// // // // // // // // // // // // //                 icon: Icons.delete_outline,
// // // // // // // // // // // // //                 label: "Delete Account",
// // // // // // // // // // // // //                 isDestructive: true,
// // // // // // // // // // // // //                 onTap: () {
// // // // // // // // // // // // //                   showDialog(
// // // // // // // // // // // // //                     context: context,
// // // // // // // // // // // // //                     builder: (_) => AlertDialog(
// // // // // // // // // // // // //                       title: const Text("Delete Account"),
// // // // // // // // // // // // //                       content: const Text("This action cannot be undone."),
// // // // // // // // // // // // //                       actions: [
// // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // //                             onPressed: () => Navigator.pop(context),
// // // // // // // // // // // // //                             child: const Text("Cancel")),
// // // // // // // // // // // // //                         TextButton(
// // // // // // // // // // // // //                             onPressed: () => Navigator.pop(context),
// // // // // // // // // // // // //                             child: const Text("Delete",
// // // // // // // // // // // // //                                 style: TextStyle(color: Colors.red))),
// // // // // // // // // // // // //                       ],
// // // // // // // // // // // // //                     ),
// // // // // // // // // // // // //                   );
// // // // // // // // // // // // //                 },
// // // // // // // // // // // // //               ),
// // // // // // // // // // // // //             ],
// // // // // // // // // // // // //           ),
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //     );
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   Widget _sectionLabel(String text) => Align(
// // // // // // // // // // // // //         alignment: Alignment.centerLeft,
// // // // // // // // // // // // //         child: Padding(
// // // // // // // // // // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // // // // // // //           child: Text(
// // // // // // // // // // // // //             text,
// // // // // // // // // // // // //             style: TextStyle(
// // // // // // // // // // // // //                 fontSize: 16,
// // // // // // // // // // // // //                 fontWeight: FontWeight.w600,
// // // // // // // // // // // // //                 color: Colors.grey.shade800),
// // // // // // // // // // // // //           ),
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //       );

// // // // // // // // // // // // //   Widget _buildField({
// // // // // // // // // // // // //     IconData? icon,
// // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // //     required String initialValue,
// // // // // // // // // // // // //     required Function(String?) onSaved,
// // // // // // // // // // // // //     required String? Function(String?) validator,
// // // // // // // // // // // // //     TextInputType keyboardType = TextInputType.text,
// // // // // // // // // // // // //     bool enabled = true, // ← new
// // // // // // // // // // // // //   }) {
// // // // // // // // // // // // //     return Container(
// // // // // // // // // // // // //       margin: const EdgeInsets.only(bottom: 12),
// // // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // // // //         borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // // //         initialValue: initialValue,
// // // // // // // // // // // // //         enabled: enabled, // ← wire it here
// // // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // // //           prefixIcon:
// // // // // // // // // // // // //               icon != null ? Icon(icon, color: Colors.grey.shade600) : null,
// // // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // // //           contentPadding:
// // // // // // // // // // // // //               const EdgeInsets.symmetric(vertical: 16, horizontal: 16),
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //         keyboardType: keyboardType,
// // // // // // // // // // // // //         onSaved: onSaved,
// // // // // // // // // // // // //         validator: validator,
// // // // // // // // // // // // //         style: TextStyle(color: enabled ? Colors.black : Colors.grey),
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //     );
// // // // // // // // // // // // //   }

// // // // // // // // // // // // //   Widget _buildAction({
// // // // // // // // // // // // //     required IconData icon,
// // // // // // // // // // // // //     required String label,
// // // // // // // // // // // // //     required VoidCallback onTap,
// // // // // // // // // // // // //     bool isDestructive = false,
// // // // // // // // // // // // //   }) {
// // // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // // //       child: Container(
// // // // // // // // // // // // //         width: double.infinity,
// // // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //         child: Row(
// // // // // // // // // // // // //           children: [
// // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // //             Text(label,
// // // // // // // // // // // // //                 style: TextStyle(
// // // // // // // // // // // // //                     fontSize: 16,
// // // // // // // // // // // // //                     color: isDestructive ? Colors.red : Colors.black87)),
// // // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // // //             const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // // // // // // // // //             const SizedBox(width: 16),
// // // // // // // // // // // // //           ],
// // // // // // // // // // // // //         ),
// // // // // // // // // // // // //       ),
// // // // // // // // // // // // //     );
// // // // // // // // // // // // //   }
// // // // // // // // // // // // // }

// // // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // // void main() {
// // // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // // }

// // // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // // //   const MyApp({super.key});

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // // //           elevation: 0,
// // // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // // //           ),
// // // // // // // // // // // //         ),
// // // // // // // // // // // //       ),
// // // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }
// // // // // // // // // // // // }

// // // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // // }

// // // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // // //   // Controllers for our fields:
// // // // // // // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // // // // // // //   final TextEditingController _lastNameController  = TextEditingController();
// // // // // // // // // // // //   final TextEditingController _emailController     = TextEditingController();
// // // // // // // // // // // //   final TextEditingController _phoneController     = TextEditingController();

// // // // // // // // // // // //   File? _profileImage;
// // // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   void initState() {
// // // // // // // // // // // //     super.initState();
// // // // // // // // // // // //     _loadUserData();
// // // // // // // // // // // //   }

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   void dispose() {
// // // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // // //     super.dispose();
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // // // //     if (userJson != null) {
// // // // // // // // // // // //       final Map<String, dynamic> userMap = jsonDecode(userJson);
// // // // // // // // // // // //       setState(() {
// // // // // // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // // // // // //         _lastNameController.text  = userMap['lastName']  ?? '';
// // // // // // // // // // // //         _emailController.text     = userMap['email']     ?? '';
// // // // // // // // // // // //         _phoneController.text     = userMap['phone']     ?? '';
// // // // // // // // // // // //         final photoPath = userMap['photoUrl'] as String?;
// // // // // // // // // // // //         if (photoPath != null && photoPath.isNotEmpty && File(photoPath).existsSync()) {
// // // // // // // // // // // //           _profileImage = File(photoPath);
// // // // // // // // // // // //         }
// // // // // // // // // // // //       });
// // // // // // // // // // // //     }
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Future<void> _saveUserData() async {
// // // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // // //     final userMap = {
// // // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // // //       'lastName':  _lastNameController.text,
// // // // // // // // // // // //       'email':     _emailController.text,
// // // // // // // // // // // //       'phone':     _phoneController.text,
// // // // // // // // // // // //       'photoUrl':  _profileImage?.path ?? ''
// // // // // // // // // // // //     };
// // // // // // // // // // // //     await prefs.setString('user', jsonEncode(userMap));

// // // // // // // // // // // //     print(userMap);
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // // //     if (image != null) {
// // // // // // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // // // // // //     }
// // // // // // // // // // // //   }

// // // // // // // // // // // //   void _showDeleteDialog() {
// // // // // // // // // // // //     showDialog(
// // // // // // // // // // // //       context: context,
// // // // // // // // // // // //       builder: (_) => AlertDialog(
// // // // // // // // // // // //         title: const Text('Delete Account'),
// // // // // // // // // // // //         content: const Text('Are you sure you want to delete your account? This action cannot be undone.'),
// // // // // // // // // // // //         actions: [
// // // // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Cancel')),
// // // // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // // // // // // //         ],
// // // // // // // // // // // //       ),
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }

// // // // // // // // // // // //   @override
// // // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // // //     return Scaffold(
// // // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // // // // //         actions: [
// // // // // // // // // // // //           TextButton(
// // // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // // //                 await _saveUserData();
// // // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // // //                   const SnackBar(
// // // // // // // // // // // //                     content: Text('Profile updated successfully'),
// // // // // // // // // // // //                     backgroundColor: Color(0xFF45BDA7),
// // // // // // // // // // // //                   ),
// // // // // // // // // // // //                 );
// // // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // // //               }
// // // // // // // // // // // //             },
// // // // // // // // // // // //             child: const Text(
// // // // // // // // // // // //               'Save',
// // // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // // //                 color: Color(0xFF45BDA7), fontWeight: FontWeight.bold, fontSize: 16
// // // // // // // // // // // //               ),
// // // // // // // // // // // //             ),
// // // // // // // // // // // //           ),
// // // // // // // // // // // //         ],
// // // // // // // // // // // //       ),
// // // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // // //         child: Form(
// // // // // // // // // // // //           key: _formKey,
// // // // // // // // // // // //           child: Column(
// // // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // // //             children: [
// // // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // // //               Center(
// // // // // // // // // // // //                 child: Stack(
// // // // // // // // // // // //                   children: [
// // // // // // // // // // // //                     Container(
// // // // // // // // // // // //                       width: 140, height: 140,
// // // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // // //                         boxShadow: [
// // // // // // // // // // // //                           BoxShadow(
// // // // // // // // // // // //                             color: Colors.grey.withOpacity(0.2), spreadRadius: 2, blurRadius: 8, offset: const Offset(0,2)
// // // // // // // // // // // //                           ),
// // // // // // // // // // // //                         ],
// // // // // // // // // // // //                         image: _profileImage != null ? DecorationImage(image: FileImage(_profileImage!), fit: BoxFit.cover) : null,
// // // // // // // // // // // //                       ),
// // // // // // // // // // // //                       child: _profileImage == null ? const Icon(Icons.person, size: 70, color: Colors.grey) : null,
// // // // // // // // // // // //                     ),
// // // // // // // // // // // //                     Positioned(bottom: 0, right: 0, child: GestureDetector(onTap: _pickImage, child: Container(width: 44, height: 44, decoration: BoxDecoration(color: const Color(0xFF45BDA7), shape: BoxShape.circle, border: Border.all(color: Colors.white, width: 3)), child: const Icon(Icons.camera_alt, color: Colors.white, size: 22)))),
// // // // // // // // // // // //                   ],
// // // // // // // // // // // //                 ),
// // // // // // // // // // // //               ),
// // // // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Personal Information', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // // //               _buildTextField(_firstNameController, Icons.person_outline, 'First Name', TextInputType.text),
// // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // //               _buildTextField(_lastNameController, Icons.person_outline, 'Last Name', TextInputType.text),
// // // // // // // // // // // //               const SizedBox(height: 30),
// // // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Contact Details', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // // //               _buildTextField(_emailController, Icons.email_outlined, 'Email Address', TextInputType.emailAddress, enabled: false),
// // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // //               _buildTextField(_phoneController, Icons.phone_outlined, 'Phone Number', TextInputType.phone),
// // // // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Account', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // // //               _buildActionButton(Icons.delete_outline, 'Delete Account', _showDeleteDialog, isDestructive: true),
// // // // // // // // // // // //             ],
// // // // // // // // // // // //           ),
// // // // // // // // // // // //         ),
// // // // // // // // // // // //       ),
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Widget _buildTextField(TextEditingController controller, IconData icon, String label, TextInputType type, {bool enabled = true}) {
// // // // // // // // // // // //     return Container(
// // // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // // //         borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // //       ),
// // // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // // //         controller: controller,
// // // // // // // // // // // //         enabled: enabled,
// // // // // // // // // // // //         keyboardType: type,
// // // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // // //           prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // // // // // // // //           labelText: label,
// // // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // // //           contentPadding: const EdgeInsets.symmetric(vertical:16, horizontal:16),
// // // // // // // // // // // //         ),
// // // // // // // // // // // //         validator: (value) {
// // // // // // // // // // // //           if (value == null || value.isEmpty) return 'Required';
// // // // // // // // // // // //           return null;
// // // // // // // // // // // //         },
// // // // // // // // // // // //       ),
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }

// // // // // // // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap, {bool isDestructive = false}) {
// // // // // // // // // // // //     return InkWell(
// // // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // // //       child: Container(
// // // // // // // // // // // //         width: double.infinity,
// // // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical:16),
// // // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // // //         ),
// // // // // // // // // // // //         child: Row(
// // // // // // // // // // // //           children: [
// // // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // // //             Text(label, style: TextStyle(fontSize:16, color: isDestructive ? Colors.red : Colors.black87)),
// // // // // // // // // // // //             const Spacer(),
// // // // // // // // // // // //             const Icon(Icons.arrow_forward_ios, size:16, color:Colors.grey),
// // // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // // //           ],
// // // // // // // // // // // //         ),
// // // // // // // // // // // //       ),
// // // // // // // // // // // //     );
// // // // // // // // // // // //   }
// // // // // // // // // // // // }

// // // // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // // // import 'dart:io';
// // // // // // // // // // // import 'dart:convert';
// // // // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';

// // // // // // // // // // // void main() {
// // // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // // }

// // // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // // //   const MyApp({super.key});

// // // // // // // // // // //   @override
// // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // //     return MaterialApp(
// // // // // // // // // // //       title: 'Profile Editor',
// // // // // // // // // // //       theme: ThemeData(
// // // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // // //           elevation: 0,
// // // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // // //             color: Colors.black,
// // // // // // // // // // //             fontSize: 20,
// // // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // // //           ),
// // // // // // // // // // //         ),
// // // // // // // // // // //       ),
// // // // // // // // // // //       home: const EditProfilePage(),
// // // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // // //     );
// // // // // // // // // // //   }
// // // // // // // // // // // }

// // // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // // //   @override
// // // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // // }

// // // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // // //   // Controllers for our fields:
// // // // // // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // // // // // //   final TextEditingController _lastNameController  = TextEditingController();
// // // // // // // // // // //   final TextEditingController _emailController     = TextEditingController();
// // // // // // // // // // //   final TextEditingController _phoneController     = TextEditingController();

// // // // // // // // // // //   File? _profileImage;
// // // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // // //   @override
// // // // // // // // // // //   void initState() {
// // // // // // // // // // //     super.initState();
// // // // // // // // // // //     _loadUserData();
// // // // // // // // // // //   }

// // // // // // // // // // //   @override
// // // // // // // // // // //   void dispose() {
// // // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // // //     _emailController.dispose();
// // // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // // //     super.dispose();
// // // // // // // // // // //   }

// // // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // // //     if (userJson != null) {
// // // // // // // // // // //       final Map<String, dynamic> userMap = jsonDecode(userJson);
// // // // // // // // // // //       setState(() {
// // // // // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // // // // //         _lastNameController.text  = userMap['lastName']  ?? '';
// // // // // // // // // // //         _emailController.text     = userMap['email']     ?? '';
// // // // // // // // // // //         _phoneController.text     = userMap['phone']?.toString() ?? '';
// // // // // // // // // // //         final photoPath = userMap['photoUrl'] as String?;
// // // // // // // // // // //         if (photoPath != null && photoPath.isNotEmpty && File(photoPath).existsSync()) {
// // // // // // // // // // //           _profileImage = File(photoPath);
// // // // // // // // // // //         }
// // // // // // // // // // //       });
// // // // // // // // // // //     }
// // // // // // // // // // //   }

// // // // // // // // // // //   Future<void> _saveUserData() async {
// // // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // // //     final userMap = {
// // // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // // //       'lastName':  _lastNameController.text,
// // // // // // // // // // //       'email':     _emailController.text,
// // // // // // // // // // //       'phone':     _phoneController.text,
// // // // // // // // // // //       'photoUrl':  _profileImage?.path ?? ''
// // // // // // // // // // //     };
// // // // // // // // // // //     await prefs.setString('user', jsonEncode(userMap));
// // // // // // // // // // //   }

// // // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // // //     if (image != null) {
// // // // // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // // // // //     }
// // // // // // // // // // //   }

// // // // // // // // // // //   void _showDeleteDialog() {
// // // // // // // // // // //     showDialog(
// // // // // // // // // // //       context: context,
// // // // // // // // // // //       builder: (_) => AlertDialog(
// // // // // // // // // // //         title: const Text('Delete Account'),
// // // // // // // // // // //         content: const Text('Are you sure you want to delete your account? This action cannot be undone.'),
// // // // // // // // // // //         actions: [
// // // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Cancel')),
// // // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // // // // // //         ],
// // // // // // // // // // //       ),
// // // // // // // // // // //     );
// // // // // // // // // // //   }

// // // // // // // // // // //   @override
// // // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // // //     return Scaffold(
// // // // // // // // // // //       appBar: AppBar(
// // // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // // // //         actions: [
// // // // // // // // // // //           TextButton(
// // // // // // // // // // //             onPressed: () async {
// // // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // // //                 await _saveUserData();
// // // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // // //                   const SnackBar(
// // // // // // // // // // //                     content: Text('Profile updated successfully'),
// // // // // // // // // // //                     backgroundColor: Color(0xFF45BDA7),
// // // // // // // // // // //                   ),
// // // // // // // // // // //                 );
// // // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // // //               }
// // // // // // // // // // //             },
// // // // // // // // // // //             child: const Text(
// // // // // // // // // // //               'Save',
// // // // // // // // // // //               style: TextStyle(
// // // // // // // // // // //                 color: Color(0xFF45BDA7), fontWeight: FontWeight.bold, fontSize: 16
// // // // // // // // // // //               ),
// // // // // // // // // // //             ),
// // // // // // // // // // //           ),
// // // // // // // // // // //         ],
// // // // // // // // // // //       ),
// // // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // // //         child: Form(
// // // // // // // // // // //           key: _formKey,
// // // // // // // // // // //           child: Column(
// // // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // // //             children: [
// // // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // // //               Center(
// // // // // // // // // // //                 child: Stack(
// // // // // // // // // // //                   children: [
// // // // // // // // // // //                     Container(
// // // // // // // // // // //                       width: 140, height: 140,
// // // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // // //                         boxShadow: [
// // // // // // // // // // //                           BoxShadow(
// // // // // // // // // // //                             color: Colors.grey.withOpacity(0.2), spreadRadius: 2, blurRadius: 8, offset: const Offset(0,2)
// // // // // // // // // // //                           ),
// // // // // // // // // // //                         ],
// // // // // // // // // // //                         image: _profileImage != null ? DecorationImage(image: FileImage(_profileImage!), fit: BoxFit.cover) : null,
// // // // // // // // // // //                       ),
// // // // // // // // // // //                       child: _profileImage == null ? const Icon(Icons.person, size: 70, color: Colors.grey) : null,
// // // // // // // // // // //                     ),
// // // // // // // // // // //                     Positioned(bottom: 0, right: 0, child: GestureDetector(onTap: _pickImage, child: Container(width: 44, height: 44, decoration: BoxDecoration(color: const Color(0xFF45BDA7), shape: BoxShape.circle, border: Border.all(color: Colors.white, width: 3)), child: const Icon(Icons.camera_alt, color: Colors.white, size: 22)))),
// // // // // // // // // // //                   ],
// // // // // // // // // // //                 ),
// // // // // // // // // // //               ),
// // // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Personal Information', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // //               _buildTextField(_firstNameController, Icons.person_outline, 'First Name', TextInputType.text),
// // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // //               _buildTextField(_lastNameController, Icons.person_outline, 'Last Name', TextInputType.text),
// // // // // // // // // // //               const SizedBox(height: 30),
// // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Contact Details', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // //               _buildTextField(_emailController, Icons.email_outlined, 'Email Address', TextInputType.emailAddress, enabled: false),
// // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // //               _buildTextField(_phoneController, Icons.phone_outlined, 'Phone Number', TextInputType.phone),
// // // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // // //               Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text('Account', style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)))),
// // // // // // // // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // // //               _buildActionButton(Icons.delete_outline, 'Delete Account', _showDeleteDialog, isDestructive: true),
// // // // // // // // // // //             ],
// // // // // // // // // // //           ),
// // // // // // // // // // //         ),
// // // // // // // // // // //       ),
// // // // // // // // // // //     );
// // // // // // // // // // //   }

// // // // // // // // // // //   Widget _buildTextField(TextEditingController controller, IconData icon, String label, TextInputType type, {bool enabled = true}) {
// // // // // // // // // // //     return Container(
// // // // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // // // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // // // // //         borderRadius: BorderRadius.circular(12),
// // // // // // // // // // //         border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // //       ),
// // // // // // // // // // //       child: TextFormField(
// // // // // // // // // // //         controller: controller,
// // // // // // // // // // //         enabled: enabled,
// // // // // // // // // // //         keyboardType: type,
// // // // // // // // // // //         decoration: InputDecoration(
// // // // // // // // // // //           prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // // // // // // //           labelText: label,
// // // // // // // // // // //           border: InputBorder.none,
// // // // // // // // // // //           contentPadding: const EdgeInsets.symmetric(vertical:16, horizontal:16),
// // // // // // // // // // //         ),
// // // // // // // // // // //         validator: (value) {
// // // // // // // // // // //           if (value == null || value.isEmpty) return 'Required';
// // // // // // // // // // //           return null;
// // // // // // // // // // //         },
// // // // // // // // // // //       ),
// // // // // // // // // // //     );
// // // // // // // // // // //   }

// // // // // // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap, {bool isDestructive = false}) {
// // // // // // // // // // //     return InkWell(
// // // // // // // // // // //       onTap: onTap,
// // // // // // // // // // //       child: Container(
// // // // // // // // // // //         width: double.infinity,
// // // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical:16),
// // // // // // // // // // //         decoration: BoxDecoration(
// // // // // // // // // // //           color: Colors.grey.shade50,
// // // // // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // // // // //           border: Border.all(color: Colors.grey.shade200),
// // // // // // // // // // //         ),
// // // // // // // // // // //         child: Row(
// // // // // // // // // // //           children: [
// // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // //             Text(label, style: TextStyle(fontSize:16, color: isDestructive ? Colors.red : Colors.black87)),
// // // // // // // // // // //             const Spacer(),
// // // // // // // // // // //             const Icon(Icons.arrow_forward_ios, size:16, color:Colors.grey),
// // // // // // // // // // //             const SizedBox(width:16),
// // // // // // // // // // //           ],
// // // // // // // // // // //         ),
// // // // // // // // // // //       ),
// // // // // // // // // // //     );
// // // // // // // // // // //   }
// // // // // // // // // // // }

// // // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // // //   @override
// // // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // // }

// // // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // // // // // // //   File? _profileImage;
// // // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // // //   @override
// // // // // // // // // //   void initState() {
// // // // // // // // // //     super.initState();
// // // // // // // // // //     _loadUserData();
// // // // // // // // // //   }

// // // // // // // // // //   @override
// // // // // // // // // //   void dispose() {
// // // // // // // // // //     _firstNameController.dispose();
// // // // // // // // // //     _lastNameController.dispose();
// // // // // // // // // //     _emailController.dispose();
// // // // // // // // // //     _phoneController.dispose();
// // // // // // // // // //     super.dispose();
// // // // // // // // // //   }

// // // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // // //     if (userJson != null) {
// // // // // // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // // // // // //       setState(() {
// // // // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // // // // // // //         _emailController.text = userMap['email'] ?? '';
// // // // // // // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // // // // // // //         final photoPath = userMap['photoUrl'] as String?;
// // // // // // // // // //         if (photoPath != null && photoPath.isNotEmpty && File(photoPath).existsSync()) {
// // // // // // // // // //           _profileImage = File(photoPath);
// // // // // // // // // //         }
// // // // // // // // // //       });
// // // // // // // // // //     }
// // // // // // // // // //   }

// // // // // // // // // //   Future<void> _saveUserData() async {
// // // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // // //     final userMap = {
// // // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // // //       'email': _emailController.text,
// // // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // // //       'photoUrl': _profileImage?.path ?? ''
// // // // // // // // // //     };
// // // // // // // // // //     await prefs.setString('user', jsonEncode(userMap));
// // // // // // // // // //   }

// // // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // // //     if (image != null) {
// // // // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // // // //     }
// // // // // // // // // //   }

// // // // // // // // // //   void _showDeleteDialog() {
// // // // // // // // // //     showDialog(
// // // // // // // // // //       context: context,
// // // // // // // // // //       builder: (_) => AlertDialog(
// // // // // // // // // //         title: const Text('Delete Account'),
// // // // // // // // // //         content: const Text('This action cannot be undone.'),
// // // // // // // // // //         actions: [
// // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Cancel')),
// // // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // // // // //         ],
// // // // // // // // // //       ),
// // // // // // // // // //     );
// // // // // // // // // //   }

// // // // // // // // // //   @override
// // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // //     return Scaffold(
// // // // // // // // // //       appBar: AppBar(
// // // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // // //         actions: [
// // // // // // // // // //           TextButton(
// // // // // // // // // //             onPressed: () async {
// // // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // // //                 await _saveUserData();
// // // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully'), backgroundColor: Color(0xFF45BDA7)),
// // // // // // // // // //                 );
// // // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // // //               }
// // // // // // // // // //             },
// // // // // // // // // //             child: const Text('Save', style: TextStyle(color: Color(0xFF45BDA7), fontWeight: FontWeight.bold, fontSize: 16)),
// // // // // // // // // //           )
// // // // // // // // // //         ],
// // // // // // // // // //       ),
// // // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // // //         child: Form(
// // // // // // // // // //           key: _formKey,
// // // // // // // // // //           child: Column(
// // // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // // //             children: [
// // // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // // //               Center(
// // // // // // // // // //                 child: Stack(
// // // // // // // // // //                   children: [
// // // // // // // // // //                     Container(
// // // // // // // // // //                       width: 140, height: 140,
// // // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // // //                         boxShadow: [BoxShadow(color: Colors.grey.withOpacity(0.2), spreadRadius: 2, blurRadius: 8, offset: const Offset(0,2))],
// // // // // // // // // //                         image: _profileImage != null ? DecorationImage(image: FileImage(_profileImage!), fit: BoxFit.cover) : null,
// // // // // // // // // //                       ),
// // // // // // // // // //                       child: _profileImage == null ? const Icon(Icons.person, size: 70, color: Colors.grey) : null,
// // // // // // // // // //                     ),
// // // // // // // // // //                     Positioned(bottom: 0, right: 0, child: GestureDetector(onTap: _pickImage, child: Container(width: 44, height: 44, decoration: BoxDecoration(color: const Color(0xFF45BDA7), shape: BoxShape.circle, border: Border.all(color: Colors.white, width: 3)), child: const Icon(Icons.camera_alt, color: Colors.white, size: 22))))
// // // // // // // // // //               ],),),
// // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // //               _buildSectionLabel('Personal Information'),
// // // // // // // // // //               _buildTextField(_firstNameController, Icons.person_outline, 'First Name', enabled: true),
// // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // //               _buildTextField(_lastNameController,  Icons.person_outline,'Last Name', enabled: true),
// // // // // // // // // //               const SizedBox(height: 30),
// // // // // // // // // //               _buildSectionLabel('Contact Details'),
// // // // // // // // // //               _buildTextField(_emailController,        Icons.email_outlined,'Email Address', enabled: false),
// // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // //               _buildTextField(_phoneController,        Icons.phone_outlined,'Phone Number', enabled: true),
// // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // //               _buildSectionLabel('Account'),
// // // // // // // // // //               _buildActionButton(Icons.lock_outline,'Change Password', () {}),
// // // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // // //               _buildActionButton(Icons.delete_outline,'Delete Account', _showDeleteDialog, isDestructive: true),
// // // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // // //             ],
// // // // // // // // // //           ),
// // // // // // // // // //         ),
// // // // // // // // // //       ),
// // // // // // // // // //     );
// // // // // // // // // //   }

// // // // // // // // // //   Widget _buildSectionLabel(String text) => Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text(text, style: TextStyle(fontSize:16,fontWeight: FontWeight.w600, color: Colors.grey.shade800))));

// // // // // // // // // //   Widget _buildTextField(TextEditingController controller, IconData icon, String label, {bool enabled = true}) {
// // // // // // // // // //     return Container(
// // // // // // // // // //       decoration: BoxDecoration(color: enabled ? Colors.grey.shade50 : Colors.grey.shade100, borderRadius: BorderRadius.circular(12), border: Border.all(color: Colors.grey.shade200)),
// // // // // // // // // //       child: TextFormField(
// // // // // // // // // //         controller: controller,
// // // // // // // // // //         enabled: enabled,
// // // // // // // // // //         decoration: InputDecoration(prefixIcon: Icon(icon, color: Colors.grey.shade600), labelText: label, border: InputBorder.none, contentPadding: const EdgeInsets.symmetric(vertical:16, horizontal:16)),
// // // // // // // // // //         validator: (v) => (v==null||v.isEmpty) ? 'Required' : null,
// // // // // // // // // //       ),
// // // // // // // // // //     );
// // // // // // // // // //   }

// // // // // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap, {bool isDestructive=false}) {
// // // // // // // // // //     return InkWell(
// // // // // // // // // //       onTap: onTap,
// // // // // // // // // //       child: Container(
// // // // // // // // // //         width: double.infinity,
// // // // // // // // // //         padding: const EdgeInsets.symmetric(vertical:16),
// // // // // // // // // //         decoration: BoxDecoration(color: Colors.grey.shade50, borderRadius: BorderRadius.circular(12), border: Border.all(color: Colors.grey.shade200)),
// // // // // // // // // //         child: Row(children:[const SizedBox(width:16),Icon(icon,color: isDestructive?Colors.red:Colors.black),const SizedBox(width:16),Text(label,style:TextStyle(fontSize:16,color: isDestructive?Colors.red:Colors.black87)),const Spacer(),const Icon(Icons.arrow_forward_ios,size:16,color:Colors.grey),const SizedBox(width:16)]),
// // // // // // // // // //       ),
// // // // // // // // // //     );
// // // // // // // // // //   }
// // // // // // // // // // }

// // // // // // // // // // ```dart
// // // // // // // // // import 'dart:convert';
// // // // // // // // // import 'dart:io';
// // // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // // // // // // import 'package:flutter/services.dart';

// // // // // // // // // // void main() {
// // // // // // // // // //   runApp(const MyApp());
// // // // // // // // // // }

// // // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // // //   const MyApp({super.key});

// // // // // // // // // //   @override
// // // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // // //     return MaterialApp(
// // // // // // // // // //       title: 'Profile App',
// // // // // // // // // //       theme: ThemeData(
// // // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // // //           elevation: 0,
// // // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // // //             color: Colors.black,
// // // // // // // // // //             fontSize: 20,
// // // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // // //           ),
// // // // // // // // // //         ),
// // // // // // // // // //       ),
// // // // // // // // // //       initialRoute: '/',
// // // // // // // // // //       routes: {
// // // // // // // // // //         '/': (_) => const ProfileScreen(),
// // // // // // // // // //         '/edit': (_) => const EditProfilePage(),
// // // // // // // // // //       },
// // // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // // //     );
// // // // // // // // // //   }
// // // // // // // // // // }

// // // // // // // // // /// PROFILE SCREEN
// // // // // // // // // class ProfileScreen extends StatefulWidget {
// // // // // // // // //   const ProfileScreen({Key? key}) : super(key: key);

// // // // // // // // //   @override
// // // // // // // // //   _ProfileScreenState createState() => _ProfileScreenState();
// // // // // // // // // }

// // // // // // // // // class _ProfileScreenState extends State<ProfileScreen>
// // // // // // // // //     with SingleTickerProviderStateMixin {
// // // // // // // // //   String nom = '';
// // // // // // // // //   String prenom = '';
// // // // // // // // //   String mail = '';
// // // // // // // // //   String tel = '';
// // // // // // // // //   int points = 0;
// // // // // // // // //   String photo = '';

// // // // // // // // //   late AnimationController _animationController;
// // // // // // // // //   late Animation<double> _fadeAnimation;
// // // // // // // // //   late Animation<Offset> _slideAnimation;

// // // // // // // // //   static const Color primaryBlack = Color(0xFF000000);
// // // // // // // // //   static const Color cardColor = Color(0xFFF5F5F5);
// // // // // // // // //   static const Color textDark = Color(0xFF333333);
// // // // // // // // //   static const Color textLight = Color(0xFF767676);

// // // // // // // // //   @override
// // // // // // // // //   void initState() {
// // // // // // // // //     super.initState();
// // // // // // // // //     _loadUserData();

// // // // // // // // //     _animationController = AnimationController(
// // // // // // // // //       duration: const Duration(milliseconds: 800),
// // // // // // // // //       vsync: this,
// // // // // // // // //     );
// // // // // // // // //     _fadeAnimation = Tween<double>(begin: 0.0, end: 1.0).animate(
// // // // // // // // //       CurvedAnimation(parent: _animationController, curve: Curves.easeOut),
// // // // // // // // //     );
// // // // // // // // //     _slideAnimation = Tween<Offset>(
// // // // // // // // //       begin: const Offset(0, 0.2),
// // // // // // // // //       end: Offset.zero,
// // // // // // // // //     ).animate(
// // // // // // // // //       CurvedAnimation(parent: _animationController, curve: Curves.easeOutCubic),
// // // // // // // // //     );

// // // // // // // // //     WidgetsBinding.instance.addPostFrameCallback((_) {
// // // // // // // // //       _animationController.forward();
// // // // // // // // //     });
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   void dispose() {
// // // // // // // // //     _animationController.dispose();
// // // // // // // // //     super.dispose();
// // // // // // // // //   }

// // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // //     if (userJson != null) {
// // // // // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // // // // //       setState(() {
// // // // // // // // //         nom = userMap['firstName'] ?? '';
// // // // // // // // //         prenom = userMap['lastName'] ?? '';
// // // // // // // // //         mail = userMap['email'] ?? '';
// // // // // // // // //         tel = userMap['phone']?.toString() ?? '';
// // // // // // // // //         points = userMap['points'] ?? 0;
// // // // // // // // //         photo = userMap['photoUrl'] ?? '';
// // // // // // // // //       });
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // //     SystemChrome.setSystemUIOverlayStyle(
// // // // // // // // //       SystemUiOverlayStyle.dark.copyWith(statusBarColor: Colors.transparent),
// // // // // // // // //     );

// // // // // // // // //     return Scaffold(
// // // // // // // // //       backgroundColor: Colors.white,
// // // // // // // // //       appBar: AppBar(
// // // // // // // // //         backgroundColor: Colors.transparent,
// // // // // // // // //         elevation: 0,
// // // // // // // // //         centerTitle: true,
// // // // // // // // //         title: const Text('Profile'),
// // // // // // // // //         iconTheme: const IconThemeData(color: primaryBlack),
// // // // // // // // //         actions: [
// // // // // // // // //           IconButton(
// // // // // // // // //             icon: const Icon(Icons.notifications_outlined),
// // // // // // // // //             onPressed: () {},
// // // // // // // // //           ),
// // // // // // // // //         ],
// // // // // // // // //       ),
// // // // // // // // //       body: SafeArea(
// // // // // // // // //         child: FadeTransition(
// // // // // // // // //           opacity: _fadeAnimation,
// // // // // // // // //           child: SlideTransition(
// // // // // // // // //             position: _slideAnimation,
// // // // // // // // //             child: SingleChildScrollView(
// // // // // // // // //               physics: const BouncingScrollPhysics(),
// // // // // // // // //               child: Padding(
// // // // // // // // //                 padding: const EdgeInsets.symmetric(horizontal: 24.0),
// // // // // // // // //                 child: Column(
// // // // // // // // //                   crossAxisAlignment: CrossAxisAlignment.start,
// // // // // // // // //                   children: [
// // // // // // // // //                     const SizedBox(height: 20),
// // // // // // // // //                     Center(
// // // // // // // // //                       child: Hero(
// // // // // // // // //                         tag: 'profile-avatar',
// // // // // // // // //                         child: Stack(
// // // // // // // // //                           alignment: Alignment.bottomRight,
// // // // // // // // //                           children: [
// // // // // // // // //                             CircleAvatar(
// // // // // // // // //                               radius: 60,
// // // // // // // // //                               backgroundColor: cardColor,
// // // // // // // // //                               backgroundImage: photo.isNotEmpty
// // // // // // // // //                                   ? NetworkImage('http://192.168.1.27:8000/images/$photo')
// // // // // // // // //                                   : const AssetImage('assets/image.png') as ImageProvider,
// // // // // // // // //                             ),
// // // // // // // // //                             Material(
// // // // // // // // //                               elevation: 4,
// // // // // // // // //                               shape: const CircleBorder(),
// // // // // // // // //                               clipBehavior: Clip.antiAlias,
// // // // // // // // //                               color: primaryBlack,
// // // // // // // // //                               child: InkWell(
// // // // // // // // //                                 onTap: () {},
// // // // // // // // //                                 child: const Padding(
// // // // // // // // //                                   padding: EdgeInsets.all(8.0),
// // // // // // // // //                                   child: Icon(Icons.camera_alt_outlined, color: Colors.white, size: 16),
// // // // // // // // //                                 ),
// // // // // // // // //                               ),
// // // // // // // // //                             ),
// // // // // // // // //                           ],
// // // // // // // // //                         ),
// // // // // // // // //                       ),
// // // // // // // // //                     ),
// // // // // // // // //                     const SizedBox(height: 20),
// // // // // // // // //                     Center(
// // // // // // // // //                       child: Text(
// // // // // // // // //                         '$nom $prenom',
// // // // // // // // //                         style: const TextStyle(fontSize: 28, fontWeight: FontWeight.bold, color: primaryBlack),
// // // // // // // // //                       ),
// // // // // // // // //                     ),
// // // // // // // // //                     const SizedBox(height: 40),
// // // // // // // // //                     _buildQuickStats(),
// // // // // // // // //                     const SizedBox(height: 40),
// // // // // // // // //                     _buildSectionHeader('Personal Information', onEdit: () async {
// // // // // // // // //                       await Navigator.pushNamed(context, '/edit');
// // // // // // // // //                       _loadUserData();
// // // // // // // // //                     }),
// // // // // // // // //                     const SizedBox(height: 16),
// // // // // // // // //                     _buildInfoCard(Icons.person_outline, 'Full Name', '$nom $prenom'),
// // // // // // // // //                     _buildInfoCard(Icons.phone_outlined, 'Phone Number', tel),
// // // // // // // // //                     _buildInfoCard(Icons.email_outlined, 'Email', mail),
// // // // // // // // //                     const SizedBox(height: 40),
// // // // // // // // //                     _buildLogoutButton(),
// // // // // // // // //                     const SizedBox(height: 30),
// // // // // // // // //                   ],
// // // // // // // // //                 ),
// // // // // // // // //               ),
// // // // // // // // //             ),
// // // // // // // // //           ),
// // // // // // // // //         ),
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _buildQuickStats() {
// // // // // // // // //     return Container(
// // // // // // // // //       padding: const EdgeInsets.all(16),
// // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // //         color: cardColor,
// // // // // // // // //         borderRadius: BorderRadius.circular(20),
// // // // // // // // //       ),
// // // // // // // // //       child: Row(
// // // // // // // // //         mainAxisAlignment: MainAxisAlignment.spaceEvenly,
// // // // // // // // //         children: [
// // // // // // // // //           _statItem(Icons.calendar_month_outlined, 'Member Since', '2023'),
// // // // // // // // //           _divider(),
// // // // // // // // //           _statItem(Icons.workspace_premium_outlined, 'Points', points.toString()),
// // // // // // // // //           _divider(),
// // // // // // // // //           _statItem(Icons.bookmark_border_outlined, 'Bookings', '8'),
// // // // // // // // //         ],
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _statItem(IconData icon, String label, String value) {
// // // // // // // // //     return Column(
// // // // // // // // //       children: [
// // // // // // // // //         Icon(icon, color: Colors.grey[700]),
// // // // // // // // //         const SizedBox(height: 4),
// // // // // // // // //         Text(label, style: TextStyle(fontSize: 12, color: Colors.grey[600])),
// // // // // // // // //         const SizedBox(height: 4),
// // // // // // // // //         Text(value, style: const TextStyle(fontSize: 16, fontWeight: FontWeight.bold)),
// // // // // // // // //       ],
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _divider() => Container(width: 1, height: 40, color: Colors.grey.withOpacity(0.3));

// // // // // // // // //   Widget _buildSectionHeader(String title, {required VoidCallback onEdit}) {
// // // // // // // // //     return Row(
// // // // // // // // //       mainAxisAlignment: MainAxisAlignment.spaceBetween,
// // // // // // // // //       children: [
// // // // // // // // //         Text(title, style: const TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
// // // // // // // // //         TextButton.icon(
// // // // // // // // //           onPressed: onEdit,
// // // // // // // // //           icon: const Icon(Icons.edit_outlined, size: 18),
// // // // // // // // //           label: const Text('Edit'),
// // // // // // // // //         ),
// // // // // // // // //       ],
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _buildInfoCard(IconData icon, String title, String value) {
// // // // // // // // //     return Container(
// // // // // // // // //       margin: const EdgeInsets.only(bottom: 16),
// // // // // // // // //       decoration: BoxDecoration(
// // // // // // // // //         color: cardColor,
// // // // // // // // //         borderRadius: BorderRadius.circular(16),
// // // // // // // // //       ),
// // // // // // // // //       child: ListTile(
// // // // // // // // //         leading: Container(
// // // // // // // // //           padding: const EdgeInsets.all(10),
// // // // // // // // //           decoration: BoxDecoration(
// // // // // // // // //             color: primaryBlack.withOpacity(0.1),
// // // // // // // // //             borderRadius: BorderRadius.circular(12),
// // // // // // // // //           ),
// // // // // // // // //           child: Icon(icon, color: primaryBlack),
// // // // // // // // //         ),
// // // // // // // // //         title: Text(title, style: const TextStyle(fontSize: 13, fontWeight: FontWeight.w500, color: textLight)),
// // // // // // // // //         subtitle: Text(value, style: const TextStyle(fontSize: 16, fontWeight: FontWeight.w600, color: textDark)),
// // // // // // // // //         trailing: const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // // // // //         onTap: () {},
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _buildLogoutButton() {
// // // // // // // // //     return SizedBox(
// // // // // // // // //       width: double.infinity,
// // // // // // // // //       child: ElevatedButton.icon(
// // // // // // // // //         icon: const Icon(Icons.logout_rounded),
// // // // // // // // //         label: const Text('LOGOUT'),
// // // // // // // // //         onPressed: () {},
// // // // // // // // //         style: ElevatedButton.styleFrom(
// // // // // // // // //           backgroundColor: primaryBlack,
// // // // // // // // //           padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // // //           shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)),
// // // // // // // // //         ),
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }
// // // // // // // // // }

// // // // // // // // // /// EDIT PROFILE SCREEN
// // // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // // //   @override
// // // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // // }

// // // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // // // // // //   File? _profileImage;
// // // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // // //   @override
// // // // // // // // //   void initState() {
// // // // // // // // //     super.initState();
// // // // // // // // //     _loadUserData();
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   void dispose() {
// // // // // // // // //     _firstNameController.dispose();
// // // // // // // // //     _lastNameController.dispose();
// // // // // // // // //     _emailController.dispose();
// // // // // // // // //     _phoneController.dispose();
// // // // // // // // //     super.dispose();
// // // // // // // // //   }

// // // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // // //     if (userJson != null) {
// // // // // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // // // // //       setState(() {
// // // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // // // // // //         _emailController.text = userMap['email'] ?? '';
// // // // // // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // // // // // //         final photoPath = userMap['photoUrl'] as String?;
// // // // // // // // //         if (photoPath != null && photoPath.isNotEmpty && File(photoPath).existsSync()) {
// // // // // // // // //           _profileImage = File(photoPath);
// // // // // // // // //         }
// // // // // // // // //       });
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   Future<void> _saveUserData() async {
// // // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // // //     final userMap = {
// // // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // // //       'email': _emailController.text,
// // // // // // // // //       'phone': _phoneController.text,
// // // // // // // // //       'photoUrl': _profileImage?.path ?? ''
// // // // // // // // //     };
// // // // // // // // //     await prefs.setString('user', jsonEncode(userMap));
// // // // // // // // //   }

// // // // // // // // //   Future<void> _pickImage() async {
// // // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // // //     if (image != null) {
// // // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // // //     }
// // // // // // // // //   }

// // // // // // // // //   void _showDeleteDialog() {
// // // // // // // // //     showDialog(
// // // // // // // // //       context: context,
// // // // // // // // //       builder: (_) => AlertDialog(
// // // // // // // // //         title: const Text('Delete Account'),
// // // // // // // // //         content: const Text('This action cannot be undone.'),
// // // // // // // // //         actions: [
// // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Cancel')),
// // // // // // // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // // // //         ],
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   @override
// // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // //     return Scaffold(
// // // // // // // // //       appBar: AppBar(
// // // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // // //         actions: [
// // // // // // // // //           TextButton(
// // // // // // // // //             onPressed: () async {
// // // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // // //                 await _saveUserData();
// // // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // // //                   const SnackBar(content: Text('Profile updated successfully'), backgroundColor: Color(0xFF45BDA7)),
// // // // // // // // //                 );
// // // // // // // // //                 Navigator.of(context).pop();
// // // // // // // // //               }
// // // // // // // // //             },
// // // // // // // // //             child: const Text('Save', style: TextStyle(color: Color(0xFF45BDA7), fontWeight: FontWeight.bold, fontSize: 16)),
// // // // // // // // //           )
// // // // // // // // //         ],
// // // // // // // // //       ),
// // // // // // // // //       body: SingleChildScrollView(
// // // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // // //         child: Form(
// // // // // // // // //           key: _formKey,
// // // // // // // // //           child: Column(
// // // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // // //             children: [
// // // // // // // // //               const SizedBox(height: 20),
// // // // // // // // //               Center(
// // // // // // // // //                 child: Stack(
// // // // // // // // //                   children: [
// // // // // // // // //                     Container(
// // // // // // // // //                       width: 140, height: 140,
// // // // // // // // //                       decoration: BoxDecoration(
// // // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // // //                         shape: BoxShape.circle,
// // // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // // //                         boxShadow: [BoxShadow(color: Colors.grey.withOpacity(0.2), spreadRadius: 2, blurRadius: 8, offset: const Offset(0,2))],
// // // // // // // // //                         image: _profileImage != null ? DecorationImage(image: FileImage(_profileImage!), fit: BoxFit.cover) : null,
// // // // // // // // //                       ),
// // // // // // // // //                       child: _profileImage == null ? const Icon(Icons.person, size: 70, color: Colors.grey) : null,
// // // // // // // // //                     ),
// // // // // // // // //                     Positioned(bottom: 0, right: 0, child: GestureDetector(onTap: _pickImage, child: Container(width: 44, height: 44, decoration: BoxDecoration(color: const Color(0xFF45BDA7), shape: BoxShape.circle, border: Border.all(color: Colors.white, width: 3)), child: const Icon(Icons.camera_alt, color: Colors.white, size: 22))))
// // // // // // // // //               ],),),
// // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // //               _buildSectionLabel('Personal Information'),
// // // // // // // // //               _buildTextField(_firstNameController, Icons.person_outline, 'First Name', enabled: true),
// // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // //               _buildTextField(_lastNameController,  Icons.person_outline,'Last Name', enabled: true),
// // // // // // // // //               const SizedBox(height: 30),
// // // // // // // // //               _buildSectionLabel('Contact Details'),
// // // // // // // // //               _buildTextField(_emailController,        Icons.email_outlined,'Email Address', enabled: false),
// // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // //               _buildTextField(_phoneController,        Icons.phone_outlined,'Phone Number', enabled: true),
// // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // //               _buildSectionLabel('Account'),
// // // // // // // // //               _buildActionButton(Icons.lock_outline,'Change Password', () {}),
// // // // // // // // //               const SizedBox(height: 16),
// // // // // // // // //               _buildActionButton(Icons.delete_outline,'Delete Account', _showDeleteDialog, isDestructive: true),
// // // // // // // // //               const SizedBox(height: 40),
// // // // // // // // //             ],
// // // // // // // // //           ),
// // // // // // // // //         ),
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _buildSectionLabel(String text) => Align(alignment: Alignment.centerLeft, child: Padding(padding: const EdgeInsets.symmetric(vertical: 8.0), child: Text(text, style: TextStyle(fontSize:16,fontWeight: FontWeight.w600, color: Colors.grey.shade800))));

// // // // // // // // //   Widget _buildTextField(TextEditingController controller, IconData icon, String label, {bool enabled = true}) {
// // // // // // // // //     return Container(
// // // // // // // // //       decoration: BoxDecoration(color: enabled ? Colors.grey.shade50 : Colors.grey.shade100, borderRadius: BorderRadius.circular(12), border: Border.all(color: Colors.grey.shade200)),
// // // // // // // // //       child: TextFormField(
// // // // // // // // //         controller: controller,
// // // // // // // // //         enabled: enabled,
// // // // // // // // //         decoration: InputDecoration(prefixIcon: Icon(icon, color: Colors.grey.shade600), labelText: label, border: InputBorder.none, contentPadding: const EdgeInsets.symmetric(vertical:16, horizontal:16)),
// // // // // // // // //         validator: (v) => (v==null||v.isEmpty) ? 'Required' : null,
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }

// // // // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap, {bool isDestructive=false}) {
// // // // // // // // //     return InkWell(
// // // // // // // // //       onTap: onTap,
// // // // // // // // //       child: Container(
// // // // // // // // //         width: double.infinity,
// // // // // // // // //         padding: const EdgeInsets.symmetric(vertical:16),
// // // // // // // // //         decoration: BoxDecoration(color: Colors.grey.shade50, borderRadius: BorderRadius.circular(12), border: Border.all(color: Colors.grey.shade200)),
// // // // // // // // //         child: Row(children:[const SizedBox(width:16),Icon(icon,color: isDestructive?Colors.red:Colors.black),const SizedBox(width:16),Text(label,style:TextStyle(fontSize:16,color: isDestructive?Colors.red:Colors.black87)),const Spacer(),const Icon(Icons.arrow_forward_ios,size:16,color:Colors.grey),const SizedBox(width:16)]),
// // // // // // // // //       ),
// // // // // // // // //     );
// // // // // // // // //   }
// // // // // // // // // }

// // // // // // // // import 'dart:convert';
// // // // // // // // import 'dart:io';
// // // // // // // // import 'package:flutter/material.dart';
// // // // // // // // import 'package:http/http.dart' as http;
// // // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // // // // // import 'package:flutter/services.dart';
// // // // // // // // import 'package:flutter_application_1/profile_screen.dart' hide EditProfilePage;

// // // // // // // // // void main() {
// // // // // // // // //   runApp(const MyApp());
// // // // // // // // // }

// // // // // // // // // class MyApp extends StatelessWidget {
// // // // // // // // //   const MyApp({super.key});

// // // // // // // // //   @override
// // // // // // // // //   Widget build(BuildContext context) {
// // // // // // // // //     return MaterialApp(
// // // // // // // // //       title: 'Profile App',
// // // // // // // // //       theme: ThemeData(
// // // // // // // // //         primaryColor: const Color(0xFF45BDA7),
// // // // // // // // //         scaffoldBackgroundColor: Colors.white,
// // // // // // // // //         appBarTheme: const AppBarTheme(
// // // // // // // // //           backgroundColor: Colors.white,
// // // // // // // // //           elevation: 0,
// // // // // // // // //           iconTheme: IconThemeData(color: Colors.black),
// // // // // // // // //           titleTextStyle: TextStyle(
// // // // // // // // //             color: Colors.black,
// // // // // // // // //             fontSize: 20,
// // // // // // // // //             fontWeight: FontWeight.bold,
// // // // // // // // //           ),
// // // // // // // // //         ),
// // // // // // // // //       ),
// // // // // // // // //       initialRoute: '/',
// // // // // // // // //       routes: {
// // // // // // // // //         '/': (_) => const ProfileScreen(),
// // // // // // // // //         '/edit': (_) => const EditProfilePage(),
// // // // // // // // //       },
// // // // // // // // //       debugShowCheckedModeBanner: false,
// // // // // // // // //     );
// // // // // // // // //   }
// // // // // // // // // }

// // // // // // // // /// EDIT PROFILE SCREEN
// // // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // // //   @override
// // // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // // }

// // // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // // //   String? userId;

// // // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // // // // //   File? _profileImage;
// // // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // // //   @override
// // // // // // // //   void initState() {
// // // // // // // //     super.initState();
// // // // // // // //     _loadUserData();
// // // // // // // //   }

// // // // // // // //   @override
// // // // // // // //   void dispose() {
// // // // // // // //     _firstNameController.dispose();
// // // // // // // //     _lastNameController.dispose();
// // // // // // // //     _emailController.dispose();
// // // // // // // //     _phoneController.dispose();
// // // // // // // //     super.dispose();
// // // // // // // //   }

// // // // // // // //   Future<void> _loadUserData() async {
// // // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // // //     final userJson = prefs.getString('user');
// // // // // // // //     if (userJson != null) {
// // // // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // // // //       setState(() {
// // // // // // // //         userId = userMap['_id'] ?? '';
// // // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // // // // //         _emailController.text = userMap['email'] ?? '';
// // // // // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // // // // //         final photoPath = userMap['photo'] as String?;
// // // // // // // //         if (photoPath != null &&
// // // // // // // //             photoPath.isNotEmpty &&
// // // // // // // //             File(photoPath).existsSync()) {
// // // // // // // //           _profileImage = File(photoPath);
// // // // // // // //         }
// // // // // // // //       });
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   // Future<void> _saveUserData() async {
// // // // // // // //   //   final prefs = await SharedPreferences.getInstance();
// // // // // // // //   //   final userMap = {
// // // // // // // //   //     'firstName': _firstNameController.text,
// // // // // // // //   //     'lastName': _lastNameController.text,
// // // // // // // //   //     'email': _emailController.text,
// // // // // // // //   //     'phone': _phoneController.text,
// // // // // // // //   //     'photoUrl': _profileImage?.path ?? ''
// // // // // // // //   //   };
// // // // // // // //   //   await prefs.setString('user', jsonEncode(userMap));
// // // // // // // //   // }

// // // // // // // //   Future<void> _saveUserDataToBackend() async {
// // // // // // // //     final uri = Uri.parse(
// // // // // // // //         'http://localhost:8000/ELACO/updateUser/$userId'); // Replace with real user ID

// // // // // // // //     final Map<String, String> userDetails = {
// // // // // // // //       'firstName': _firstNameController.text,
// // // // // // // //       'lastName': _lastNameController.text,
// // // // // // // //       'email': _emailController.text,
// // // // // // // //       'phone': _phoneController.text,
// // // // // // // //     };

// // // // // // // //     try {
// // // // // // // //       final response = await http.patch(uri,
// // // // // // // //           headers: {'Content-Type': 'application/json'},
// // // // // // // //           body: jsonEncode(userDetails));

// // // // // // // //       if (response.statusCode == 200) {
// // // // // // // //         final prefs = await SharedPreferences.getInstance();

// // // // // // // //         final userMap = {
// // // // // // // //           'firstName': _firstNameController.text,
// // // // // // // //           'lastName': _lastNameController.text,
// // // // // // // //           'email': _emailController.text,
// // // // // // // //           'phone': _phoneController.text,
// // // // // // // //           'photoUrl': _profileImage?.path ?? ''
// // // // // // // //         };

// // // // // // // //         await prefs.setString('user', jsonEncode(userMap));

// // // // // // // //         print('User details updated successfully');
// // // // // // // //       } else {
// // // // // // // //         print('Failed to update user details: ${response.body}');
// // // // // // // //       }
// // // // // // // //     } catch (e) {
// // // // // // // //       print('Error updating user: $e');
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   Future<void> _uploadProfileImage() async {
// // // // // // // //     if (_profileImage == null) return;

// // // // // // // //     final uri = Uri.parse(
// // // // // // // //         'http://localhost:8000/uplaod/$userId'); // Replace with real user ID
// // // // // // // //     final request = http.MultipartRequest('PATCH', uri);
// // // // // // // //     request.files
// // // // // // // //         .add(await http.MultipartFile.fromPath('file', _profileImage!.path));

// // // // // // // //     try {
// // // // // // // //       final response = await request.send();
// // // // // // // //       if (response.statusCode == 200) {
// // // // // // // //         print('Image uploaded successfully');
// // // // // // // //       } else {
// // // // // // // //         print('Failed to upload image');
// // // // // // // //       }
// // // // // // // //     } catch (e) {
// // // // // // // //       print('Image upload error: $e');
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   Future<void> _pickImage() async {
// // // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // // //     if (image != null) {
// // // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // // //     }
// // // // // // // //   }

// // // // // // // //   void _showDeleteDialog() {
// // // // // // // //     showDialog(
// // // // // // // //       context: context,
// // // // // // // //       builder: (_) => AlertDialog(
// // // // // // // //         title: const Text('Delete Account'),
// // // // // // // //         content: const Text('This action cannot be undone.'),
// // // // // // // //         actions: [
// // // // // // // //           TextButton(
// // // // // // // //               onPressed: () => Navigator.pop(context),
// // // // // // // //               child: const Text('Cancel')),
// // // // // // // //           TextButton(
// // // // // // // //               onPressed: () => Navigator.pop(context),
// // // // // // // //               child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // // //         ],
// // // // // // // //       ),
// // // // // // // //     );
// // // // // // // //   }

// // // // // // // //   @override
// // // // // // // //   Widget build(BuildContext context) {
// // // // // // // //     return Scaffold(
// // // // // // // //       appBar: AppBar(
// // // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // // //         title: const Text('Edit Profile'),
// // // // // // // //         actions: [
// // // // // // // //           TextButton(
// // // // // // // //             // onPressed: () async {
// // // // // // // //             //   if (_formKey.currentState!.validate()) {
// // // // // // // //             //     await _saveUserData();
// // // // // // // //             //     ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //             //       const SnackBar(
// // // // // // // //             //           content: Text('Profile updated successfully'),
// // // // // // // //             //           backgroundColor: Color(0xFF45BDA7)),
// // // // // // // //             //     );
// // // // // // // //             //     Navigator.of(context).pop();
// // // // // // // //             //   }
// // // // // // // //             // },
// // // // // // // //             onPressed: () async {
// // // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // // //                 await _saveUserDataToBackend();
// // // // // // // //                 await _uploadProfileImage();

// // // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // // //                   const SnackBar(
// // // // // // // //                       content: Text('Profile updated successfully'),
// // // // // // // //                       backgroundColor: Color(0xFF45BDA7)),
// // // // // // // //                 );
// // // // // // // //                 Navigator.of(context).pop();
// // // // // // // //               }
// // // // // // // //             },

// // // // // // // //             child: const Text('Save',
// // // // // // // //                 style: TextStyle(
// // // // // // // //                     color: Color(0xFF45BDA7),
// // // // // // // //                     fontWeight: FontWeight.bold,
// // // // // // // //                     fontSize: 16)),
// // // // // // // //           )
// // // // // // // //         ],
// // // // // // // //       ),
// // // // // // // //       body: SingleChildScrollView(
// // // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // // //         child: Form(
// // // // // // // //           key: _formKey,
// // // // // // // //           child: Column(
// // // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // // //             children: [
// // // // // // // //               const SizedBox(height: 20),
// // // // // // // //               Center(
// // // // // // // //                 child: Stack(
// // // // // // // //                   children: [
// // // // // // // //                     Container(
// // // // // // // //                       width: 140,
// // // // // // // //                       height: 140,
// // // // // // // //                       decoration: BoxDecoration(
// // // // // // // //                         color: Colors.grey.shade100,
// // // // // // // //                         shape: BoxShape.circle,
// // // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // // //                         boxShadow: [
// // // // // // // //                           BoxShadow(
// // // // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // // // //                               spreadRadius: 2,
// // // // // // // //                               blurRadius: 8,
// // // // // // // //                               offset: const Offset(0, 2))
// // // // // // // //                         ],
// // // // // // // //                         image: _profileImage != null
// // // // // // // //                             ? DecorationImage(
// // // // // // // //                                 image: FileImage(_profileImage!),
// // // // // // // //                                 fit: BoxFit.cover)
// // // // // // // //                             : null,
// // // // // // // //                       ),
// // // // // // // //                       child: _profileImage == null
// // // // // // // //                           ? const Icon(Icons.person,
// // // // // // // //                               size: 70, color: Colors.grey)
// // // // // // // //                           : null,
// // // // // // // //                     ),
// // // // // // // //                     Positioned(
// // // // // // // //                         bottom: 0,
// // // // // // // //                         right: 0,
// // // // // // // //                         child: GestureDetector(
// // // // // // // //                             onTap: _pickImage,
// // // // // // // //                             child: Container(
// // // // // // // //                                 width: 44,
// // // // // // // //                                 height: 44,
// // // // // // // //                                 decoration: BoxDecoration(
// // // // // // // //                                     color: const Color(0xFF45BDA7),
// // // // // // // //                                     shape: BoxShape.circle,
// // // // // // // //                                     border: Border.all(
// // // // // // // //                                         color: Colors.white, width: 3)),
// // // // // // // //                                 child: const Icon(Icons.camera_alt,
// // // // // // // //                                     color: Colors.white, size: 22))))
// // // // // // // //                   ],
// // // // // // // //                 ),
// // // // // // // //               ),
// // // // // // // //               const SizedBox(height: 40),
// // // // // // // //               _buildSectionLabel('Personal Information'),
// // // // // // // //               _buildTextField(
// // // // // // // //                   _firstNameController, Icons.person_outline, 'First Name',
// // // // // // // //                   enabled: true),
// // // // // // // //               const SizedBox(height: 16),
// // // // // // // //               _buildTextField(
// // // // // // // //                   _lastNameController, Icons.person_outline, 'Last Name',
// // // // // // // //                   enabled: true),
// // // // // // // //               const SizedBox(height: 30),
// // // // // // // //               _buildSectionLabel('Contact Details'),
// // // // // // // //               _buildTextField(
// // // // // // // //                   _emailController, Icons.email_outlined, 'Email Address',
// // // // // // // //                   enabled: false),
// // // // // // // //               const SizedBox(height: 16),
// // // // // // // //               _buildTextField(
// // // // // // // //                   _phoneController, Icons.phone_outlined, 'Phone Number',
// // // // // // // //                   enabled: true),
// // // // // // // //               const SizedBox(height: 40),
// // // // // // // //               _buildSectionLabel('Account'),
// // // // // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // // // // //               const SizedBox(height: 16),
// // // // // // // //               _buildActionButton(
// // // // // // // //                   Icons.delete_outline, 'Delete Account', _showDeleteDialog,
// // // // // // // //                   isDestructive: true),
// // // // // // // //               const SizedBox(height: 40),
// // // // // // // //             ],
// // // // // // // //           ),
// // // // // // // //         ),
// // // // // // // //       ),
// // // // // // // //     );
// // // // // // // //   }

// // // // // // // //   Widget _buildSectionLabel(String text) => Align(
// // // // // // // //       alignment: Alignment.centerLeft,
// // // // // // // //       child: Padding(
// // // // // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // // //           child: Text(text,
// // // // // // // //               style: TextStyle(
// // // // // // // //                   fontSize: 16,
// // // // // // // //                   fontWeight: FontWeight.w600,
// // // // // // // //                   color: Colors.grey.shade800))));

// // // // // // // //   Widget _buildTextField(
// // // // // // // //       TextEditingController controller, IconData icon, String label,
// // // // // // // //       {bool enabled = true}) {
// // // // // // // //     return Container(
// // // // // // // //       decoration: BoxDecoration(
// // // // // // // //           color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // // //           border: Border.all(color: Colors.grey.shade200)),
// // // // // // // //       child: TextFormField(
// // // // // // // //         controller: controller,
// // // // // // // //         enabled: enabled,
// // // // // // // //         decoration: InputDecoration(
// // // // // // // //             prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // // // //             labelText: label,
// // // // // // // //             border: InputBorder.none,
// // // // // // // //             contentPadding:
// // // // // // // //                 const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
// // // // // // // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // // // // // // //       ),
// // // // // // // //     );
// // // // // // // //   }

// // // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap,
// // // // // // // //       {bool isDestructive = false}) {
// // // // // // // //     return InkWell(
// // // // // // // //       onTap: onTap,
// // // // // // // //       child: Container(
// // // // // // // //         width: double.infinity,
// // // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // // //         decoration: BoxDecoration(
// // // // // // // //             color: Colors.grey.shade50,
// // // // // // // //             borderRadius: BorderRadius.circular(12),
// // // // // // // //             border: Border.all(color: Colors.grey.shade200)),
// // // // // // // //         child: Row(children: [
// // // // // // // //           const SizedBox(width: 16),
// // // // // // // //           Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // // //           const SizedBox(width: 16),
// // // // // // // //           Text(label,
// // // // // // // //               style: TextStyle(
// // // // // // // //                   fontSize: 16,
// // // // // // // //                   color: isDestructive ? Colors.red : Colors.black87)),
// // // // // // // //           const Spacer(),
// // // // // // // //           const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // // // //           const SizedBox(width: 16)
// // // // // // // //         ]),
// // // // // // // //       ),
// // // // // // // //     );
// // // // // // // //   }
// // // // // // // // }

// // // // // // // import 'dart:convert';
// // // // // // // import 'dart:io';
// // // // // // // import 'package:flutter/material.dart';
// // // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // // // // import 'package:http/http.dart' as http;

// // // // // // // class EditProfilePage extends StatefulWidget {
// // // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // // //   @override
// // // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // // }

// // // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // // //   final _formKey = GlobalKey<FormState>();

// // // // // // //   String? userId;

// // // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // // // //   File? _profileImage;
// // // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // // //   @override
// // // // // // //   void initState() {
// // // // // // //     super.initState();
// // // // // // //     _loadUserData();
// // // // // // //   }

// // // // // // //   @override
// // // // // // //   void dispose() {
// // // // // // //     _firstNameController.dispose();
// // // // // // //     _lastNameController.dispose();
// // // // // // //     _emailController.dispose();
// // // // // // //     _phoneController.dispose();
// // // // // // //     super.dispose();
// // // // // // //   }

// // // // // // //   Future<void> _loadUserData() async {
// // // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // // //     final userJson = prefs.getString('user');
// // // // // // //     if (userJson != null) {
// // // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // // //       setState(() {
// // // // // // //         userId = userMap['_id'] ?? '';
// // // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // // // //         _emailController.text = userMap['email'] ?? '';
// // // // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // // // //         final photoPath = userMap['photo'] as String?;
// // // // // // //         if (photoPath != null &&
// // // // // // //             photoPath.isNotEmpty &&
// // // // // // //             File(photoPath).existsSync()) {
// // // // // // //           _profileImage = File(photoPath);
// // // // // // //         }
// // // // // // //       });
// // // // // // //     }
// // // // // // //   }

// // // // // // //   Future<void> _saveUserDataToBackend() async {
// // // // // // //     if (userId == null || userId!.isEmpty) {
// // // // // // //       print('User ID not available');
// // // // // // //       return;
// // // // // // //     }

// // // // // // //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');

// // // // // // //     final Map<String, String> userDetails = {
// // // // // // //       'firstName': _firstNameController.text,
// // // // // // //       'lastName': _lastNameController.text,
// // // // // // //       'email': _emailController.text,
// // // // // // //       'phone': _phoneController.text,
// // // // // // //     };

// // // // // // //     try {
// // // // // // //       final response = await http.patch(
// // // // // // //         uri,
// // // // // // //         headers: {'Content-Type': 'application/json'},
// // // // // // //         body: jsonEncode(userDetails),
// // // // // // //       );

// // // // // // //       if (response.statusCode == 200) {
// // // // // // //         final prefs = await SharedPreferences.getInstance();
// // // // // // //         final userMap = {
// // // // // // //           '_id': userId,
// // // // // // //           'firstName': _firstNameController.text,
// // // // // // //           'lastName': _lastNameController.text,
// // // // // // //           'email': _emailController.text,
// // // // // // //           'phone': _phoneController.text,
// // // // // // //           'photoUrl': _profileImage?.path ?? ''
// // // // // // //         };
// // // // // // //         await prefs.setString('user', jsonEncode(userMap));
// // // // // // //         print('User details updated successfully');
// // // // // // //       } else {
// // // // // // //         print('Failed to update user details: ${response.body}');
// // // // // // //       }
// // // // // // //     } catch (e) {
// // // // // // //       print('Error updating user: $e');
// // // // // // //     }
// // // // // // //   }

// // // // // // //   Future<void> _uploadProfileImage() async {
// // // // // // //     if (_profileImage == null || userId == null || userId!.isEmpty) return;

// // // // // // //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
// // // // // // //     final request = http.MultipartRequest('PATCH', uri);
// // // // // // //     request.files
// // // // // // //         .add(await http.MultipartFile.fromPath('file', _profileImage!.path));

// // // // // // //     try {
// // // // // // //       final response = await request.send();
// // // // // // //       if (response.statusCode == 200) {
// // // // // // //         print('Image uploaded successfully');
// // // // // // //       } else {
// // // // // // //         print('Failed to upload image');
// // // // // // //       }
// // // // // // //     } catch (e) {
// // // // // // //       print('Image upload error: $e');
// // // // // // //     }
// // // // // // //   }

// // // // // // //   Future<void> _pickImage() async {
// // // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // // //     if (image != null) {
// // // // // // //       setState(() => _profileImage = File(image.path));
// // // // // // //     }
// // // // // // //   }

// // // // // // //   void _showDeleteDialog() {
// // // // // // //     showDialog(
// // // // // // //       context: context,
// // // // // // //       builder: (_) => AlertDialog(
// // // // // // //         title: const Text('Delete Account'),
// // // // // // //         content: const Text('This action cannot be undone.'),
// // // // // // //         actions: [
// // // // // // //           TextButton(
// // // // // // //               onPressed: () => Navigator.pop(context),
// // // // // // //               child: const Text('Cancel')),
// // // // // // //           TextButton(
// // // // // // //               onPressed: () => Navigator.pop(context),
// // // // // // //               child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // // //         ],
// // // // // // //       ),
// // // // // // //     );
// // // // // // //   }

// // // // // // //   @override
// // // // // // //   Widget build(BuildContext context) {
// // // // // // //     return Scaffold(
// // // // // // //       appBar: AppBar(
// // // // // // //         leading: const BackButton(color: Colors.black),
// // // // // // //         title: const Text('Edit Profile'),
// // // // // // //         actions: [
// // // // // // //           TextButton(
// // // // // // //             onPressed: () async {
// // // // // // //               if (_formKey.currentState!.validate()) {
// // // // // // //                 await _saveUserDataToBackend();
// // // // // // //                 await _uploadProfileImage();
// // // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // // //                   const SnackBar(
// // // // // // //                       content: Text('Profile updated successfully'),
// // // // // // //                       backgroundColor: Color(0xFF45BDA7)),
// // // // // // //                 );
// // // // // // //                 Navigator.of(context).pop();
// // // // // // //               }
// // // // // // //             },
// // // // // // //             child: const Text('Save',
// // // // // // //                 style: TextStyle(
// // // // // // //                     color: Color(0xFF45BDA7),
// // // // // // //                     fontWeight: FontWeight.bold,
// // // // // // //                     fontSize: 16)),
// // // // // // //           )
// // // // // // //         ],
// // // // // // //       ),
// // // // // // //       body: SingleChildScrollView(
// // // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // // //         child: Form(
// // // // // // //           key: _formKey,
// // // // // // //           child: Column(
// // // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // // //             children: [
// // // // // // //               const SizedBox(height: 20),
// // // // // // //               Center(
// // // // // // //                 child: Stack(
// // // // // // //                   children: [
// // // // // // //                     Container(
// // // // // // //                       width: 140,
// // // // // // //                       height: 140,
// // // // // // //                       decoration: BoxDecoration(
// // // // // // //                         color: Colors.grey.shade100,
// // // // // // //                         shape: BoxShape.circle,
// // // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // // //                         boxShadow: [
// // // // // // //                           BoxShadow(
// // // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // // //                               spreadRadius: 2,
// // // // // // //                               blurRadius: 8,
// // // // // // //                               offset: const Offset(0, 2))
// // // // // // //                         ],
// // // // // // //                         image: _profileImage != null
// // // // // // //                             ? DecorationImage(
// // // // // // //                                 image: FileImage(_profileImage!),
// // // // // // //                                 fit: BoxFit.cover)
// // // // // // //                             : null,
// // // // // // //                       ),
// // // // // // //                       child: _profileImage == null
// // // // // // //                           ? const Icon(Icons.person,
// // // // // // //                               size: 70, color: Colors.grey)
// // // // // // //                           : null,
// // // // // // //                     ),
// // // // // // //                     Positioned(
// // // // // // //                         bottom: 0,
// // // // // // //                         right: 0,
// // // // // // //                         child: GestureDetector(
// // // // // // //                             onTap: _pickImage,
// // // // // // //                             child: Container(
// // // // // // //                                 width: 44,
// // // // // // //                                 height: 44,
// // // // // // //                                 decoration: BoxDecoration(
// // // // // // //                                     color: const Color(0xFF45BDA7),
// // // // // // //                                     shape: BoxShape.circle,
// // // // // // //                                     border: Border.all(
// // // // // // //                                         color: Colors.white, width: 3)),
// // // // // // //                                 child: const Icon(Icons.camera_alt,
// // // // // // //                                     color: Colors.white, size: 22))))
// // // // // // //                   ],
// // // // // // //                 ),
// // // // // // //               ),
// // // // // // //               const SizedBox(height: 40),
// // // // // // //               _buildSectionLabel('Personal Information'),
// // // // // // //               _buildTextField(
// // // // // // //                   _firstNameController, Icons.person_outline, 'First Name'),
// // // // // // //               const SizedBox(height: 16),
// // // // // // //               _buildTextField(
// // // // // // //                   _lastNameController, Icons.person_outline, 'Last Name'),
// // // // // // //               const SizedBox(height: 30),
// // // // // // //               _buildSectionLabel('Contact Details'),
// // // // // // //               _buildTextField(
// // // // // // //                   _emailController, Icons.email_outlined, 'Email Address',
// // // // // // //                   enabled: false),
// // // // // // //               const SizedBox(height: 16),
// // // // // // //               _buildTextField(
// // // // // // //                   _phoneController, Icons.phone_outlined, 'Phone Number'),
// // // // // // //               const SizedBox(height: 40),
// // // // // // //               _buildSectionLabel('Account'),
// // // // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // // // //               const SizedBox(height: 16),
// // // // // // //               _buildActionButton(
// // // // // // //                   Icons.delete_outline, 'Delete Account', _showDeleteDialog,
// // // // // // //                   isDestructive: true),
// // // // // // //               const SizedBox(height: 40),
// // // // // // //             ],
// // // // // // //           ),
// // // // // // //         ),
// // // // // // //       ),
// // // // // // //     );
// // // // // // //   }

// // // // // // //   Widget _buildSectionLabel(String text) => Align(
// // // // // // //         alignment: Alignment.centerLeft,
// // // // // // //         child: Padding(
// // // // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // // //           child: Text(text,
// // // // // // //               style: TextStyle(
// // // // // // //                   fontSize: 16,
// // // // // // //                   fontWeight: FontWeight.w600,
// // // // // // //                   color: Colors.grey.shade800)),
// // // // // // //         ),
// // // // // // //       );

// // // // // // //   Widget _buildTextField(
// // // // // // //       TextEditingController controller, IconData icon, String label,
// // // // // // //       {bool enabled = true}) {
// // // // // // //     return Container(
// // // // // // //       decoration: BoxDecoration(
// // // // // // //           color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // // //           border: Border.all(color: Colors.grey.shade200)),
// // // // // // //       child: TextFormField(
// // // // // // //         controller: controller,
// // // // // // //         enabled: enabled,
// // // // // // //         decoration: InputDecoration(
// // // // // // //             prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // // //             labelText: label,
// // // // // // //             border: InputBorder.none,
// // // // // // //             contentPadding:
// // // // // // //                 const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
// // // // // // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // // // // // //       ),
// // // // // // //     );
// // // // // // //   }

// // // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap,
// // // // // // //       {bool isDestructive = false}) {
// // // // // // //     return InkWell(
// // // // // // //       onTap: onTap,
// // // // // // //       child: Container(
// // // // // // //         width: double.infinity,
// // // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // // //         decoration: BoxDecoration(
// // // // // // //             color: Colors.grey.shade50,
// // // // // // //             borderRadius: BorderRadius.circular(12),
// // // // // // //             border: Border.all(color: Colors.grey.shade200)),
// // // // // // //         child: Row(children: [
// // // // // // //           const SizedBox(width: 16),
// // // // // // //           Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // // //           const SizedBox(width: 16),
// // // // // // //           Text(label,
// // // // // // //               style: TextStyle(
// // // // // // //                   fontSize: 16,
// // // // // // //                   color: isDestructive ? Colors.red : Colors.black87)),
// // // // // // //           const Spacer(),
// // // // // // //           const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // // //           const SizedBox(width: 16)
// // // // // // //         ]),
// // // // // // //       ),
// // // // // // //     );
// // // // // // //   }
// // // // // // // }

// // // // // // import 'dart:convert';
// // // // // // import 'dart:io';
// // // // // // import 'package:flutter/material.dart';
// // // // // // import 'package:image_picker/image_picker.dart';
// // // // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // // // import 'package:http/http.dart' as http;
// // // // // // import 'package:cached_network_image/cached_network_image.dart';

// // // // // // class EditProfilePage extends StatefulWidget {
// // // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // // //   @override
// // // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // // }

// // // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // // //   final _formKey = GlobalKey<FormState>();
// // // // // //   String? userId;
// // // // // //   String? photo;

// // // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // // //   final TextEditingController _emailController = TextEditingController();
// // // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // // //   File? _profileImage;
// // // // // //   final ImagePicker _picker = ImagePicker();

// // // // // //   @override
// // // // // //   void initState() {
// // // // // //     super.initState();
// // // // // //     _loadUserData();
// // // // // //   }

// // // // // //   @override
// // // // // //   void dispose() {
// // // // // //     _firstNameController.dispose();
// // // // // //     _lastNameController.dispose();
// // // // // //     _emailController.dispose();
// // // // // //     _phoneController.dispose();
// // // // // //     super.dispose();
// // // // // //   }

// // // // // //   Future<void> _loadUserData() async {
// // // // // //     final prefs = await SharedPreferences.getInstance();
// // // // // //     final userJson = prefs.getString('user');
// // // // // //     if (userJson != null) {
// // // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // // //       setState(() {
// // // // // //         userId = userMap['_id'] ?? '';
// // // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // // //         _emailController.text = userMap['email'] ?? '';
// // // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // // //         photo = userMap['photo'] ?? '';
// // // // // //       });
// // // // // //     }
// // // // // //   }

// // // // // //   Future<void> _saveUserDataToBackend() async {
// // // // // //     if (userId == null || userId!.isEmpty) {
// // // // // //       print('User ID not available');
// // // // // //       return;
// // // // // //     }

// // // // // //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');

// // // // // //     final Map<String, String> userDetails = {
// // // // // //       'firstName': _firstNameController.text,
// // // // // //       'lastName': _lastNameController.text,
// // // // // //       'email': _emailController.text,
// // // // // //       'phone': _phoneController.text,
// // // // // //     };

// // // // // //     try {
// // // // // //       final response = await http.patch(
// // // // // //         uri,
// // // // // //         headers: {'Content-Type': 'application/json'},
// // // // // //         body: jsonEncode(userDetails),
// // // // // //       );

// // // // // //       if (response.statusCode == 200) {
// // // // // //         final prefs = await SharedPreferences.getInstance();
// // // // // //         final userMap = {
// // // // // //           '_id': userId,
// // // // // //           'firstName': _firstNameController.text,
// // // // // //           'lastName': _lastNameController.text,
// // // // // //           'email': _emailController.text,
// // // // // //           'phone': _phoneController.text,
// // // // // //           'photo': _profileImage != null
// // // // // //               ? _profileImage!.path.split('/').last
// // // // // //               : photo ?? ''
// // // // // //         };
// // // // // //         await prefs.setString('user', jsonEncode(userMap));
// // // // // //         print('User details updated successfully');
// // // // // //       } else {
// // // // // //         print('Failed to update user details: ${response.body}');
// // // // // //       }
// // // // // //     } catch (e) {
// // // // // //       print('Error updating user: $e');
// // // // // //     }
// // // // // //   }

// // // // // //   Future<void> _uploadProfileImage() async {
// // // // // //     if (_profileImage == null || userId == null || userId!.isEmpty) return;

// // // // // //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
// // // // // //     final request = http.MultipartRequest('PATCH', uri);
// // // // // //     request.files
// // // // // //         .add(await http.MultipartFile.fromPath('file', _profileImage!.path));

// // // // // //     try {
// // // // // //       final response = await request.send();
// // // // // //       if (response.statusCode == 200) {
// // // // // //         print('Image uploaded successfully');
// // // // // //       } else {
// // // // // //         print('Failed to upload image');
// // // // // //       }
// // // // // //     } catch (e) {
// // // // // //       print('Image upload error: $e');
// // // // // //     }
// // // // // //   }

// // // // // //   Future<void> _pickImage() async {
// // // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // // //     if (image != null) {
// // // // // //       setState(() => _profileImage = File(image.path));
// // // // // //     }
// // // // // //   }

// // // // // //   void _showDeleteDialog() {
// // // // // //     showDialog(
// // // // // //       context: context,
// // // // // //       builder: (_) => AlertDialog(
// // // // // //         title: const Text('Delete Account'),
// // // // // //         content: const Text('This action cannot be undone.'),
// // // // // //         actions: [
// // // // // //           TextButton(
// // // // // //               onPressed: () => Navigator.pop(context),
// // // // // //               child: const Text('Cancel')),
// // // // // //           TextButton(
// // // // // //               onPressed: () => Navigator.pop(context),
// // // // // //               child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // // //         ],
// // // // // //       ),
// // // // // //     );
// // // // // //   }

// // // // // //   @override
// // // // // //   Widget build(BuildContext context) {
// // // // // //     final imageProvider = _profileImage != null
// // // // // //         ? FileImage(_profileImage!)
// // // // // //         : (photo != null && photo!.isNotEmpty
// // // // // //             ? CachedNetworkImageProvider(
// // // // // //                 'http://localhost:8000/images/$photo')
// // // // // //             : const AssetImage('assets/image.png')) as ImageProvider;

// // // // // //     return Scaffold(
// // // // // //       appBar: AppBar(
// // // // // //         leading: const BackButton(color: Colors.black),
// // // // // //         title: const Text('Edit Profile'),
// // // // // //         actions: [
// // // // // //           TextButton(
// // // // // //             onPressed: () async {
// // // // // //               if (_formKey.currentState!.validate()) {
// // // // // //                 await _saveUserDataToBackend();
// // // // // //                 await _uploadProfileImage();
// // // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // // //                   const SnackBar(
// // // // // //                       content: Text('Profile updated successfully'),
// // // // // //                       backgroundColor: Color(0xFF45BDA7)),
// // // // // //                 );
// // // // // //                 Navigator.of(context).pop();
// // // // // //               }
// // // // // //             },
// // // // // //             child: const Text('Save',
// // // // // //                 style: TextStyle(
// // // // // //                     color: Color(0xFF45BDA7),
// // // // // //                     fontWeight: FontWeight.bold,
// // // // // //                     fontSize: 16)),
// // // // // //           )
// // // // // //         ],
// // // // // //       ),
// // // // // //       body: SingleChildScrollView(
// // // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // // //         child: Form(
// // // // // //           key: _formKey,
// // // // // //           child: Column(
// // // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // // //             children: [
// // // // // //               const SizedBox(height: 20),
// // // // // //               Center(
// // // // // //                 child: Stack(
// // // // // //                   children: [
// // // // // //                     Container(
// // // // // //                       width: 140,
// // // // // //                       height: 140,
// // // // // //                       decoration: BoxDecoration(
// // // // // //                         color: Colors.grey.shade100,
// // // // // //                         shape: BoxShape.circle,
// // // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // // //                         boxShadow: [
// // // // // //                           BoxShadow(
// // // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // // //                               spreadRadius: 2,
// // // // // //                               blurRadius: 8,
// // // // // //                               offset: const Offset(0, 2))
// // // // // //                         ],
// // // // // //                         image: DecorationImage(
// // // // // //                             image: imageProvider, fit: BoxFit.cover),
// // // // // //                       ),
// // // // // //                       child: (_profileImage == null &&
// // // // // //                               (photo == null || photo!.isEmpty))
// // // // // //                           ? const Icon(Icons.person,
// // // // // //                               size: 70, color: Colors.grey)
// // // // // //                           : null,
// // // // // //                     ),
// // // // // //                     Positioned(
// // // // // //                       bottom: 0,
// // // // // //                       right: 0,
// // // // // //                       child: GestureDetector(
// // // // // //                         onTap: _pickImage,
// // // // // //                         child: Container(
// // // // // //                           width: 44,
// // // // // //                           height: 44,
// // // // // //                           decoration: BoxDecoration(
// // // // // //                             color: const Color(0xFF45BDA7),
// // // // // //                             shape: BoxShape.circle,
// // // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // // //                           ),
// // // // // //                           child: const Icon(Icons.camera_alt,
// // // // // //                               color: Colors.white, size: 22),
// // // // // //                         ),
// // // // // //                       ),
// // // // // //                     )
// // // // // //                   ],
// // // // // //                 ),
// // // // // //               ),
// // // // // //               const SizedBox(height: 40),
// // // // // //               _buildSectionLabel('Personal Information'),
// // // // // //               _buildTextField(
// // // // // //                   _firstNameController, Icons.person_outline, 'First Name'),
// // // // // //               const SizedBox(height: 16),
// // // // // //               _buildTextField(
// // // // // //                   _lastNameController, Icons.person_outline, 'Last Name'),
// // // // // //               const SizedBox(height: 30),
// // // // // //               _buildSectionLabel('Contact Details'),
// // // // // //               _buildTextField(
// // // // // //                   _emailController, Icons.email_outlined, 'Email Address',
// // // // // //                   enabled: false),
// // // // // //               const SizedBox(height: 16),
// // // // // //               _buildTextField(
// // // // // //                   _phoneController, Icons.phone_outlined, 'Phone Number'),
// // // // // //               const SizedBox(height: 40),
// // // // // //               _buildSectionLabel('Account'),
// // // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // // //               const SizedBox(height: 16),
// // // // // //               _buildActionButton(
// // // // // //                   Icons.delete_outline, 'Delete Account', _showDeleteDialog,
// // // // // //                   isDestructive: true),
// // // // // //               const SizedBox(height: 40),
// // // // // //             ],
// // // // // //           ),
// // // // // //         ),
// // // // // //       ),
// // // // // //     );
// // // // // //   }

// // // // // //   Widget _buildSectionLabel(String text) => Align(
// // // // // //         alignment: Alignment.centerLeft,
// // // // // //         child: Padding(
// // // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // // //           child: Text(text,
// // // // // //               style: TextStyle(
// // // // // //                   fontSize: 16,
// // // // // //                   fontWeight: FontWeight.w600,
// // // // // //                   color: Colors.grey.shade800)),
// // // // // //         ),
// // // // // //       );

// // // // // //   Widget _buildTextField(
// // // // // //       TextEditingController controller, IconData icon, String label,
// // // // // //       {bool enabled = true}) {
// // // // // //     return Container(
// // // // // //       decoration: BoxDecoration(
// // // // // //           color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // // //           borderRadius: BorderRadius.circular(12),
// // // // // //           border: Border.all(color: Colors.grey.shade200)),
// // // // // //       child: TextFormField(
// // // // // //         controller: controller,
// // // // // //         enabled: enabled,
// // // // // //         decoration: InputDecoration(
// // // // // //             prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // // //             labelText: label,
// // // // // //             border: InputBorder.none,
// // // // // //             contentPadding:
// // // // // //                 const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
// // // // // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // // // // //       ),
// // // // // //     );
// // // // // //   }

// // // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap,
// // // // // //       {bool isDestructive = false}) {
// // // // // //     return InkWell(
// // // // // //       onTap: onTap,
// // // // // //       child: Container(
// // // // // //         width: double.infinity,
// // // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // // //         decoration: BoxDecoration(
// // // // // //             color: Colors.grey.shade50,
// // // // // //             borderRadius: BorderRadius.circular(12),
// // // // // //             border: Border.all(color: Colors.grey.shade200)),
// // // // // //         child: Row(children: [
// // // // // //           const SizedBox(width: 16),
// // // // // //           Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // // //           const SizedBox(width: 16),
// // // // // //           Text(label,
// // // // // //               style: TextStyle(
// // // // // //                   fontSize: 16,
// // // // // //                   color: isDestructive ? Colors.red : Colors.black87)),
// // // // // //           const Spacer(),
// // // // // //           const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // // //           const SizedBox(width: 16)
// // // // // //         ]),
// // // // // //       ),
// // // // // //     );
// // // // // //   }
// // // // // // }

// // // // // import 'dart:convert';
// // // // // import 'dart:io';
// // // // // import 'package:flutter/foundation.dart';
// // // // // import 'package:flutter/material.dart';
// // // // // import 'package:image_picker/image_picker.dart';
// // // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // // import 'package:http/http.dart' as http;
// // // // // import 'package:http_parser/http_parser.dart';
// // // // // import 'package:cached_network_image/cached_network_image.dart';

// // // // // class EditProfilePage extends StatefulWidget {
// // // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // // //   @override
// // // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // // }

// // // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // // //   final _formKey = GlobalKey<FormState>();
// // // // //   String? userId;
// // // // //   String? photo;

// // // // //   final TextEditingController _firstNameController = TextEditingController();
// // // // //   final TextEditingController _lastNameController = TextEditingController();
// // // // //   final TextEditingController _emailController = TextEditingController();
// // // // //   final TextEditingController _phoneController = TextEditingController();

// // // // //   File? _profileImage;
// // // // //   final ImagePicker _picker = ImagePicker();

// // // // //   @override
// // // // //   void initState() {
// // // // //     super.initState();
// // // // //     _loadUserData();
// // // // //   }

// // // // //   @override
// // // // //   void dispose() {
// // // // //     _firstNameController.dispose();
// // // // //     _lastNameController.dispose();
// // // // //     _emailController.dispose();
// // // // //     _phoneController.dispose();
// // // // //     super.dispose();
// // // // //   }

// // // // //   Future<void> _loadUserData() async {
// // // // //     final prefs = await SharedPreferences.getInstance();
// // // // //     final userJson = prefs.getString('user');
// // // // //     if (userJson != null) {
// // // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // // //       setState(() {
// // // // //         userId = userMap['_id'] ?? '';
// // // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // // //         _emailController.text = userMap['email'] ?? '';
// // // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // // //         photo = userMap['photo'] ?? '';
// // // // //       });
// // // // //     }
// // // // //   }

// // // // //   Future<void> _saveUserDataToBackend() async {
// // // // //     if (userId == null || userId!.isEmpty) return;

// // // // //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');

// // // // //     final Map<String, String> userDetails = {
// // // // //       'firstName': _firstNameController.text,
// // // // //       'lastName': _lastNameController.text,
// // // // //       'email': _emailController.text,
// // // // //       'phone': _phoneController.text,
// // // // //     };

// // // // //     try {
// // // // //       final response = await http.patch(
// // // // //         uri,
// // // // //         headers: {'Content-Type': 'application/json'},
// // // // //         body: jsonEncode(userDetails),
// // // // //       );

// // // // //       if (response.statusCode == 200) {
// // // // //         final prefs = await SharedPreferences.getInstance();
// // // // //         final userMap = {
// // // // //           '_id': userId,
// // // // //           'firstName': _firstNameController.text,
// // // // //           'lastName': _lastNameController.text,
// // // // //           'email': _emailController.text,
// // // // //           'phone': _phoneController.text,
// // // // //           'photo': _profileImage != null
// // // // //               ? _profileImage!.path.split('/').last
// // // // //               : photo ?? ''
// // // // //         };
// // // // //         await prefs.setString('user', jsonEncode(userMap));
// // // // //         print('User details updated successfully');
// // // // //       } else {
// // // // //         print('Failed to update user details: ${response.body}');
// // // // //       }
// // // // //     } catch (e) {
// // // // //       print('Error updating user: $e');
// // // // //     }
// // // // //   }

// // // // //   Future<void> _uploadProfileImage() async {
// // // // //     if (_profileImage == null || userId == null || userId!.isEmpty) return;

// // // // //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');

// // // // //     final request = http.MultipartRequest('PATCH', uri);

// // // // //     try {
// // // // //       if (kIsWeb) {
// // // // //         final bytes = await _profileImage!.readAsBytes();
// // // // //         final stream = http.ByteStream.fromBytes(bytes);
// // // // //         final length = bytes.length;
// // // // //         request.files.add(http.MultipartFile(
// // // // //           'file',
// // // // //           stream,
// // // // //           length,
// // // // //           filename: 'profile.png',
// // // // //           contentType: MediaType('image', 'png'),
// // // // //         ));
// // // // //       } else {
// // // // //         request.files
// // // // //             .add(await http.MultipartFile.fromPath('file', _profileImage!.path));
// // // // //       }

// // // // //       final response = await request.send();

// // // // //       if (response.statusCode == 200) {
// // // // //         print('Image uploaded successfully');
// // // // //       } else {
// // // // //         print('Failed to upload image: ${response.statusCode}');
// // // // //       }
// // // // //     } catch (e) {
// // // // //       print('Image upload error: $e');
// // // // //     }
// // // // //   }

// // // // //   Future<void> _pickImage() async {
// // // // //     final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
// // // // //     if (image != null) {
// // // // //       // setState(() => _profileImage = File(image.path));
// // // // //       setState(() {
// // // // //   _profileImage = File(image.path);
// // // // //   photo = null; // Remove the old cached photo reference
// // // // // });
// // // // //     }
// // // // //   }

// // // // //   void _showDeleteDialog() {
// // // // //     showDialog(
// // // // //       context: context,
// // // // //       builder: (_) => AlertDialog(
// // // // //         title: const Text('Delete Account'),
// // // // //         content: const Text('This action cannot be undone.'),
// // // // //         actions: [
// // // // //           TextButton(
// // // // //               onPressed: () => Navigator.pop(context),
// // // // //               child: const Text('Cancel')),
// // // // //           TextButton(
// // // // //               onPressed: () => Navigator.pop(context),
// // // // //               child: const Text('Delete', style: TextStyle(color: Colors.red))),
// // // // //         ],
// // // // //       ),
// // // // //     );
// // // // //   }

// // // // //   @override
// // // // //   Widget build(BuildContext context) {
// // // // //     final imageProvider = _profileImage != null
// // // // //         ? FileImage(_profileImage!)
// // // // //         : (photo != null && photo!.isNotEmpty
// // // // //             ? CachedNetworkImageProvider(
// // // // //                 'http://localhost:8000/images/$photo')
// // // // //             : const AssetImage('assets/image.png')) as ImageProvider;

// // // // //     return Scaffold(
// // // // //       appBar: AppBar(
// // // // //         leading: const BackButton(color: Colors.black),
// // // // //         title: const Text('Edit Profile'),
// // // // //         actions: [
// // // // //           TextButton(
// // // // //             onPressed: () async {
// // // // //               if (_formKey.currentState!.validate()) {
// // // // //                 await _saveUserDataToBackend();
// // // // //                 await _uploadProfileImage();
// // // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // // //                   const SnackBar(
// // // // //                       content: Text('Profile updated successfully'),
// // // // //                       backgroundColor: Color(0xFF45BDA7)),
// // // // //                 );
// // // // //                 Navigator.of(context).pop();
// // // // //               }
// // // // //             },
// // // // //             child: const Text('Save',
// // // // //                 style: TextStyle(
// // // // //                     color: Color(0xFF45BDA7),
// // // // //                     fontWeight: FontWeight.bold,
// // // // //                     fontSize: 16)),
// // // // //           )
// // // // //         ],
// // // // //       ),
// // // // //       body: SingleChildScrollView(
// // // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // // //         child: Form(
// // // // //           key: _formKey,
// // // // //           child: Column(
// // // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // // //             children: [
// // // // //               const SizedBox(height: 20),
// // // // //               Center(
// // // // //                 child: Stack(
// // // // //                   children: [
// // // // //                     Container(
// // // // //                       width: 140,
// // // // //                       height: 140,
// // // // //                       decoration: BoxDecoration(
// // // // //                         color: Colors.grey.shade100,
// // // // //                         shape: BoxShape.circle,
// // // // //                         border: Border.all(color: Colors.white, width: 4),
// // // // //                         boxShadow: [
// // // // //                           BoxShadow(
// // // // //                               color: Colors.grey.withOpacity(0.2),
// // // // //                               spreadRadius: 2,
// // // // //                               blurRadius: 8,
// // // // //                               offset: const Offset(0, 2))
// // // // //                         ],
// // // // //                         image: DecorationImage(
// // // // //                             image: imageProvider, fit: BoxFit.cover),
// // // // //                       ),
// // // // //                       child: (_profileImage == null &&
// // // // //                               (photo == null || photo!.isEmpty))
// // // // //                           ? const Icon(Icons.person,
// // // // //                               size: 70, color: Colors.grey)
// // // // //                           : null,
// // // // //                     ),
// // // // //                     Positioned(
// // // // //                       bottom: 0,
// // // // //                       right: 0,
// // // // //                       child: GestureDetector(
// // // // //                         onTap: _pickImage,
// // // // //                         child: Container(
// // // // //                           width: 44,
// // // // //                           height: 44,
// // // // //                           decoration: BoxDecoration(
// // // // //                             color: const Color(0xFF45BDA7),
// // // // //                             shape: BoxShape.circle,
// // // // //                             border: Border.all(color: Colors.white, width: 3),
// // // // //                           ),
// // // // //                           child: const Icon(Icons.camera_alt,
// // // // //                               color: Colors.white, size: 22),
// // // // //                         ),
// // // // //                       ),
// // // // //                     )
// // // // //                   ],
// // // // //                 ),
// // // // //               ),
// // // // //               const SizedBox(height: 40),
// // // // //               _buildSectionLabel('Personal Information'),
// // // // //               _buildTextField(
// // // // //                   _firstNameController, Icons.person_outline, 'First Name'),
// // // // //               const SizedBox(height: 16),
// // // // //               _buildTextField(
// // // // //                   _lastNameController, Icons.person_outline, 'Last Name'),
// // // // //               const SizedBox(height: 30),
// // // // //               _buildSectionLabel('Contact Details'),
// // // // //               _buildTextField(
// // // // //                   _emailController, Icons.email_outlined, 'Email Address',
// // // // //                   enabled: false),
// // // // //               const SizedBox(height: 16),
// // // // //               _buildTextField(
// // // // //                   _phoneController, Icons.phone_outlined, 'Phone Number'),
// // // // //               const SizedBox(height: 40),
// // // // //               _buildSectionLabel('Account'),
// // // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // // //               const SizedBox(height: 16),
// // // // //               _buildActionButton(
// // // // //                   Icons.delete_outline, 'Delete Account', _showDeleteDialog,
// // // // //                   isDestructive: true),
// // // // //               const SizedBox(height: 40),
// // // // //             ],
// // // // //           ),
// // // // //         ),
// // // // //       ),
// // // // //     );
// // // // //   }

// // // // //   Widget _buildSectionLabel(String text) => Align(
// // // // //         alignment: Alignment.centerLeft,
// // // // //         child: Padding(
// // // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // // //           child: Text(text,
// // // // //               style: TextStyle(
// // // // //                   fontSize: 16,
// // // // //                   fontWeight: FontWeight.w600,
// // // // //                   color: Colors.grey.shade800)),
// // // // //         ),
// // // // //       );

// // // // //   Widget _buildTextField(
// // // // //       TextEditingController controller, IconData icon, String label,
// // // // //       {bool enabled = true}) {
// // // // //     return Container(
// // // // //       decoration: BoxDecoration(
// // // // //           color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // // //           borderRadius: BorderRadius.circular(12),
// // // // //           border: Border.all(color: Colors.grey.shade200)),
// // // // //       child: TextFormField(
// // // // //         controller: controller,
// // // // //         enabled: enabled,
// // // // //         decoration: InputDecoration(
// // // // //             prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // // //             labelText: label,
// // // // //             border: InputBorder.none,
// // // // //             contentPadding:
// // // // //                 const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
// // // // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // // // //       ),
// // // // //     );
// // // // //   }

// // // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap,
// // // // //       {bool isDestructive = false}) {
// // // // //     return InkWell(
// // // // //       onTap: onTap,
// // // // //       child: Container(
// // // // //         width: double.infinity,
// // // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // // //         decoration: BoxDecoration(
// // // // //             color: Colors.grey.shade50,
// // // // //             borderRadius: BorderRadius.circular(12),
// // // // //             border: Border.all(color: Colors.grey.shade200)),
// // // // //         child: Row(children: [
// // // // //           const SizedBox(width: 16),
// // // // //           Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // // //           const SizedBox(width: 16),
// // // // //           Text(label,
// // // // //               style: TextStyle(
// // // // //                   fontSize: 16,
// // // // //                   color: isDestructive ? Colors.red : Colors.black87)),
// // // // //           const Spacer(),
// // // // //           const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // // //           const SizedBox(width: 16)
// // // // //         ]),
// // // // //       ),
// // // // //     );
// // // // //   }
// // // // // }

// // // // import 'dart:convert';
// // // // import 'dart:io';
// // // // import 'package:flutter/material.dart';
// // // // import 'package:image_picker/image_picker.dart';
// // // // import 'package:shared_preferences/shared_preferences.dart';
// // // // import 'package:http/http.dart' as http;
// // // // import 'package:cached_network_image/cached_network_image.dart';

// // // // class EditProfilePage extends StatefulWidget {
// // // //   const EditProfilePage({Key? key}) : super(key: key);

// // // //   @override
// // // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // // }

// // // // class _EditProfilePageState extends State<EditProfilePage> {
// // // //   final _formKey = GlobalKey<FormState>();
// // // //   String? userId;
// // // //   String? photo;

// // // //   final TextEditingController _firstNameController = TextEditingController();
// // // //   final TextEditingController _lastNameController = TextEditingController();
// // // //   final TextEditingController _emailController = TextEditingController();
// // // //   final TextEditingController _phoneController = TextEditingController();

// // // //   File? _profileImage;
// // // //   final ImagePicker _picker = ImagePicker();

// // // //   @override
// // // //   void initState() {
// // // //     super.initState();
// // // //     _loadUserData();
// // // //   }

// // // //   @override
// // // //   void dispose() {
// // // //     _firstNameController.dispose();
// // // //     _lastNameController.dispose();
// // // //     _emailController.dispose();
// // // //     _phoneController.dispose();
// // // //     super.dispose();
// // // //   }

// // // //   Future<void> _loadUserData() async {
// // // //     final prefs = await SharedPreferences.getInstance();
// // // //     final userJson = prefs.getString('user');
// // // //     if (userJson != null) {
// // // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // // //       setState(() {
// // // //         userId = userMap['_id'] ?? '';
// // // //         _firstNameController.text = userMap['firstName'] ?? '';
// // // //         _lastNameController.text = userMap['lastName'] ?? '';
// // // //         _emailController.text = userMap['email'] ?? '';
// // // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // // //         photo = userMap['photo'] ?? '';
// // // //       });
// // // //     }
// // // //   }

// // // //   Future<void> _saveUserDataToBackend() async {
// // // //     if (userId == null || userId!.isEmpty) {
// // // //       print('User ID not available');
// // // //       return;
// // // //     }

// // // //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');
// // // //     final Map<String, String> userDetails = {
// // // //       'firstName': _firstNameController.text,
// // // //       'lastName': _lastNameController.text,
// // // //       'email': _emailController.text,
// // // //       'phone': _phoneController.text,
// // // //     };

// // // //     try {
// // // //       final response = await http.patch(
// // // //         uri,
// // // //         headers: {'Content-Type': 'application/json'},
// // // //         body: jsonEncode(userDetails),
// // // //       );

// // // //       if (response.statusCode == 200) {
// // // //         final prefs = await SharedPreferences.getInstance();
// // // //         final userMap = {
// // // //           '_id': userId,
// // // //           'firstName': _firstNameController.text,
// // // //           'lastName': _lastNameController.text,
// // // //           'email': _emailController.text,
// // // //           'phone': _phoneController.text,
// // // //           'photo': _profileImage != null
// // // //               ? _profileImage!.path.split('/').last
// // // //               : photo ?? ''
// // // //         };
// // // //         await prefs.setString('user', jsonEncode(userMap));
// // // //         print('User details updated successfully');
// // // //       } else {
// // // //         print('Failed to update user details: ${response.body}');
// // // //       }
// // // //     } catch (e) {
// // // //       print('Error updating user: $e');
// // // //     }
// // // //   }

// // // //   Future<void> _uploadProfileImage() async {
// // // //     if (_profileImage == null || userId == null || userId!.isEmpty) return;

// // // //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
// // // //     final request = http.MultipartRequest('PATCH', uri);
// // // //     request.files.add(await http.MultipartFile.fromPath('file', _profileImage!.path));

// // // //     try {
// // // //       final response = await request.send();
// // // //       if (response.statusCode == 200) {
// // // //         print('Image uploaded successfully');
// // // //       } else {
// // // //         print('Failed to upload image');
// // // //       }
// // // //     } catch (e) {
// // // //       print('Image upload error: $e');
// // // //     }
// // // //   }

// // // //   Future<void> _pickImage() async {
// // // //     final XFile? pickedFile = await _picker.pickImage(source: ImageSource.gallery);
// // // //     if (pickedFile != null) {
// // // //       final file = File(pickedFile.path);
// // // //       if (await file.exists()) {
// // // //         setState(() {
// // // //           _profileImage = file;
// // // //           photo = null; // disable old image to show new one
// // // //         });
// // // //       }
// // // //     }
// // // //   }

// // // //   void _showDeleteDialog() {
// // // //     showDialog(
// // // //       context: context,
// // // //       builder: (_) => AlertDialog(
// // // //         title: const Text('Delete Account'),
// // // //         content: const Text('This action cannot be undone.'),
// // // //         actions: [
// // // //           TextButton(onPressed: () => Navigator.pop(context), child: const Text('Cancel')),
// // // //           TextButton(
// // // //             onPressed: () => Navigator.pop(context),
// // // //             child: const Text('Delete', style: TextStyle(color: Colors.red)),
// // // //           ),
// // // //         ],
// // // //       ),
// // // //     );
// // // //   }

// // // //   @override
// // // //   Widget build(BuildContext context) {
// // // //     ImageProvider imageProvider;

// // // //     if (_profileImage != null && _profileImage!.existsSync()) {
// // // //       imageProvider = FileImage(_profileImage!);
// // // //     } else if (photo != null && photo!.isNotEmpty) {
// // // //       imageProvider = CachedNetworkImageProvider('http://localhost:8000/images/$photo');
// // // //     } else {
// // // //       imageProvider = const AssetImage('assets/image.png');
// // // //     }

// // // //     return Scaffold(
// // // //       appBar: AppBar(
// // // //         leading: const BackButton(color: Colors.black),
// // // //         title: const Text('Edit Profile'),
// // // //         actions: [
// // // //           TextButton(
// // // //             onPressed: () async {
// // // //               if (_formKey.currentState!.validate()) {
// // // //                 await _saveUserDataToBackend();
// // // //                 await _uploadProfileImage();
// // // //                 ScaffoldMessenger.of(context).showSnackBar(
// // // //                   const SnackBar(
// // // //                     content: Text('Profile updated successfully'),
// // // //                     backgroundColor: Color(0xFF45BDA7),
// // // //                   ),
// // // //                 );
// // // //                 Navigator.of(context).pop();
// // // //               }
// // // //             },
// // // //             child: const Text(
// // // //               'Save',
// // // //               style: TextStyle(color: Color(0xFF45BDA7), fontWeight: FontWeight.bold, fontSize: 16),
// // // //             ),
// // // //           )
// // // //         ],
// // // //       ),
// // // //       body: SingleChildScrollView(
// // // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // // //         child: Form(
// // // //           key: _formKey,
// // // //           child: Column(
// // // //             crossAxisAlignment: CrossAxisAlignment.center,
// // // //             children: [
// // // //               const SizedBox(height: 20),
// // // //               Center(
// // // //                 child: Stack(
// // // //                   children: [
// // // //                     Container(
// // // //                       width: 140,
// // // //                       height: 140,
// // // //                       decoration: BoxDecoration(
// // // //                         color: Colors.grey.shade100,
// // // //                         shape: BoxShape.circle,
// // // //                         border: Border.all(color: Colors.white, width: 4),
// // // //                         boxShadow: [
// // // //                           BoxShadow(
// // // //                             color: Colors.grey.withOpacity(0.2),
// // // //                             spreadRadius: 2,
// // // //                             blurRadius: 8,
// // // //                             offset: const Offset(0, 2),
// // // //                           )
// // // //                         ],
// // // //                         image: DecorationImage(image: imageProvider, fit: BoxFit.cover),
// // // //                       ),
// // // //                       child: (_profileImage == null && (photo == null || photo!.isEmpty))
// // // //                           ? const Icon(Icons.person, size: 70, color: Colors.grey)
// // // //                           : null,
// // // //                     ),
// // // //                     Positioned(
// // // //                       bottom: 0,
// // // //                       right: 0,
// // // //                       child: GestureDetector(
// // // //                         onTap: _pickImage,
// // // //                         child: Container(
// // // //                           width: 44,
// // // //                           height: 44,
// // // //                           decoration: BoxDecoration(
// // // //                             color: const Color(0xFF45BDA7),
// // // //                             shape: BoxShape.circle,
// // // //                             border: Border.all(color: Colors.white, width: 3),
// // // //                           ),
// // // //                           child: const Icon(Icons.camera_alt, color: Colors.white, size: 22),
// // // //                         ),
// // // //                       ),
// // // //                     )
// // // //                   ],
// // // //                 ),
// // // //               ),
// // // //               const SizedBox(height: 40),
// // // //               _buildSectionLabel('Personal Information'),
// // // //               _buildTextField(_firstNameController, Icons.person_outline, 'First Name'),
// // // //               const SizedBox(height: 16),
// // // //               _buildTextField(_lastNameController, Icons.person_outline, 'Last Name'),
// // // //               const SizedBox(height: 30),
// // // //               _buildSectionLabel('Contact Details'),
// // // //               _buildTextField(_emailController, Icons.email_outlined, 'Email Address', enabled: false),
// // // //               const SizedBox(height: 16),
// // // //               _buildTextField(_phoneController, Icons.phone_outlined, 'Phone Number'),
// // // //               const SizedBox(height: 40),
// // // //               _buildSectionLabel('Account'),
// // // //               _buildActionButton(Icons.lock_outline, 'Change Password', () {}),
// // // //               const SizedBox(height: 16),
// // // //               _buildActionButton(Icons.delete_outline, 'Delete Account', _showDeleteDialog, isDestructive: true),
// // // //               const SizedBox(height: 40),
// // // //             ],
// // // //           ),
// // // //         ),
// // // //       ),
// // // //     );
// // // //   }

// // // //   Widget _buildSectionLabel(String text) => Align(
// // // //         alignment: Alignment.centerLeft,
// // // //         child: Padding(
// // // //           padding: const EdgeInsets.symmetric(vertical: 8.0),
// // // //           child: Text(text,
// // // //               style: TextStyle(
// // // //                   fontSize: 16, fontWeight: FontWeight.w600, color: Colors.grey.shade800)),
// // // //         ),
// // // //       );

// // // //   Widget _buildTextField(TextEditingController controller, IconData icon, String label,
// // // //       {bool enabled = true}) {
// // // //     return Container(
// // // //       decoration: BoxDecoration(
// // // //           color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // // //           borderRadius: BorderRadius.circular(12),
// // // //           border: Border.all(color: Colors.grey.shade200)),
// // // //       child: TextFormField(
// // // //         controller: controller,
// // // //         enabled: enabled,
// // // //         decoration: InputDecoration(
// // // //             prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // // //             labelText: label,
// // // //             border: InputBorder.none,
// // // //             contentPadding: const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
// // // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // // //       ),
// // // //     );
// // // //   }

// // // //   Widget _buildActionButton(IconData icon, String label, VoidCallback onTap,
// // // //       {bool isDestructive = false}) {
// // // //     return InkWell(
// // // //       onTap: onTap,
// // // //       child: Container(
// // // //         width: double.infinity,
// // // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // // //         decoration: BoxDecoration(
// // // //             color: Colors.grey.shade50,
// // // //             borderRadius: BorderRadius.circular(12),
// // // //             border: Border.all(color: Colors.grey.shade200)),
// // // //         child: Row(children: [
// // // //           const SizedBox(width: 16),
// // // //           Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // // //           const SizedBox(width: 16),
// // // //           Text(label,
// // // //               style: TextStyle(
// // // //                   fontSize: 16,
// // // //                   color: isDestructive ? Colors.red : Colors.black87)),
// // // //           const Spacer(),
// // // //           const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // // //           const SizedBox(width: 16)
// // // //         ]),
// // // //       ),
// // // //     );
// // // //   }
// // // // }

// // // import 'dart:convert';
// // // import 'dart:io';
// // // import 'package:flutter/material.dart';
// // // import 'package:image_picker/image_picker.dart';
// // // import 'package:shared_preferences/shared_preferences.dart';
// // // import 'package:http/http.dart' as http;
// // // import 'package:cached_network_image/cached_network_image.dart';

// // // class EditProfilePage extends StatefulWidget {
// // //   const EditProfilePage({Key? key}) : super(key: key);

// // //   @override
// // //   State<EditProfilePage> createState() => _EditProfilePageState();
// // // }

// // // class _EditProfilePageState extends State<EditProfilePage> {
// // //   final _formKey = GlobalKey<FormState>();
// // //   String? userId;
// // //   String? photo;

// // //   final _firstNameController = TextEditingController();
// // //   final _lastNameController = TextEditingController();
// // //   final _emailController = TextEditingController();
// // //   final _phoneController = TextEditingController();

// // //   File? _profileImage;
// // //   final _picker = ImagePicker();

// // //   @override
// // //   void initState() {
// // //     super.initState();
// // //     _loadUserData();
// // //   }

// // //   @override
// // //   void dispose() {
// // //     _firstNameController.dispose();
// // //     _lastNameController.dispose();
// // //     _emailController.dispose();
// // //     _phoneController.dispose();
// // //     super.dispose();
// // //   }

// // //   Future<void> _loadUserData() async {
// // //     final prefs = await SharedPreferences.getInstance();
// // //     final userJson = prefs.getString('user');
// // //     if (userJson != null) {
// // //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// // //       setState(() {
// // //         userId = userMap['_id'] ?? '';
// // //         photo = userMap['photo'] ?? '';
// // //         _firstNameController.text = userMap['firstName'] ?? '';
// // //         _lastNameController.text = userMap['lastName'] ?? '';
// // //         _emailController.text = userMap['email'] ?? '';
// // //         _phoneController.text = userMap['phone']?.toString() ?? '';
// // //       });
// // //     }
// // //   }

// // //   Future<void> _pickImage() async {
// // //     final picked = await _picker.pickImage(source: ImageSource.gallery);
// // //     if (picked != null) {
// // //       setState(() {
// // //         _profileImage = File(picked.path);
// // //         photo = null; // force fallback to FileImage
// // //       });
// // //     }
// // //   }

// // //   Future<void> _saveUserDataToBackend() async {
// // //     if (userId == null || userId!.isEmpty) return;
// // //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');
// // //     final details = {
// // //       'firstName': _firstNameController.text,
// // //       'lastName': _lastNameController.text,
// // //       'email': _emailController.text,
// // //       'phone': _phoneController.text,
// // //     };

// // //     final res = await http.patch(
// // //       uri,
// // //       headers: {'Content-Type': 'application/json'},
// // //       body: jsonEncode(details),
// // //     );
// // //     if (res.statusCode == 200) {
// // //       final prefs = await SharedPreferences.getInstance();
// // //       final updated = {
// // //         '_id': userId,
// // //         'firstName': _firstNameController.text,
// // //         'lastName': _lastNameController.text,
// // //         'email': _emailController.text,
// // //         'phone': _phoneController.text,
// // //         'photo': _profileImage != null
// // //             ? _profileImage!.path.split('/').last
// // //             : (photo ?? ''),
// // //       };
// // //       await prefs.setString('user', jsonEncode(updated));
// // //     } else {
// // //       debugPrint('Update failed: ${res.body}');
// // //     }
// // //   }

// // //   Future<void> _uploadProfileImage() async {
// // //     if (_profileImage == null || userId == null) return;
// // //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
// // //     final req = http.MultipartRequest('PATCH', uri)
// // //       ..files
// // //           .add(await http.MultipartFile.fromPath('file', _profileImage!.path));
// // //     final resp = await req.send();
// // //     if (resp.statusCode != 200) {
// // //       debugPrint('Image upload failed (${resp.statusCode})');
// // //     }
// // //   }

// // //   @override
// // //   Widget build(BuildContext context) {
// // //     // ALWAYS choose the FileImage if user has picked one.
// // //     final ImageProvider avatarImage = _profileImage != null
// // //         ? FileImage(_profileImage!)
// // //         : (photo != null && photo!.isNotEmpty
// // //             ? CachedNetworkImageProvider('http://localhost:8000/images/$photo')
// // //             : const AssetImage('assets/image.png'));

// // //     return Scaffold(
// // //       appBar: AppBar(
// // //         leading: const BackButton(color: Colors.black),
// // //         title:
// // //             const Text('Edit Profile', style: TextStyle(color: Colors.black)),
// // //         backgroundColor: Colors.white,
// // //         elevation: 0,
// // //         actions: [
// // //           TextButton(
// // //             onPressed: () async {
// // //               if (_formKey.currentState!.validate()) {
// // //                 await _saveUserDataToBackend();
// // //                 await _uploadProfileImage();
// // //                 ScaffoldMessenger.of(context).showSnackBar(
// // //                   const SnackBar(
// // //                     content: Text('Profile updated'),
// // //                     backgroundColor: Color(0xFF45BDA7),
// // //                   ),
// // //                 );
// // //                 Navigator.of(context).pop();
// // //               }
// // //             },
// // //             child: const Text('Save',
// // //                 style: TextStyle(
// // //                     color: Color(0xFF45BDA7), fontWeight: FontWeight.bold)),
// // //           )
// // //         ],
// // //       ),
// // //       body: SingleChildScrollView(
// // //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// // //         child: Form(
// // //           key: _formKey,
// // //           child: Column(
// // //             children: [
// // //               // --- Avatar & Camera Button ---
// // //               Center(
// // //                 child: Stack(
// // //                   children: [
// // //                     CircleAvatar(
// // //                       radius: 70,
// // //                       backgroundColor: Colors.grey.shade100,
// // //                       backgroundImage: avatarImage,
// // //                     ),
// // //                     Positioned(
// // //                       bottom: 0,
// // //                       right: 4,
// // //                       child: GestureDetector(
// // //                         onTap: _pickImage,
// // //                         child: Container(
// // //                           decoration: BoxDecoration(
// // //                             shape: BoxShape.circle,
// // //                             color: const Color(0xFF45BDA7),
// // //                             border: Border.all(color: Colors.white, width: 3),
// // //                           ),
// // //                           padding: const EdgeInsets.all(8),
// // //                           child: const Icon(Icons.camera_alt,
// // //                               color: Colors.white, size: 20),
// // //                         ),
// // //                       ),
// // //                     ),
// // //                   ],
// // //                 ),
// // //               ),
// // //               const SizedBox(height: 40),

// // //               // --- Personal Information ---
// // //               _sectionLabel('Personal Information'),
// // //               _buildField(
// // //                   _firstNameController, Icons.person_outline, 'First Name'),
// // //               const SizedBox(height: 16),
// // //               _buildField(
// // //                   _lastNameController, Icons.person_outline, 'Last Name'),
// // //               const SizedBox(height: 30),

// // //               // --- Contact Details ---
// // //               _sectionLabel('Contact Details'),
// // //               _buildField(
// // //                   _emailController, Icons.email_outlined, 'Email Address',
// // //                   enabled: false),
// // //               const SizedBox(height: 16),
// // //               _buildField(
// // //                   _phoneController, Icons.phone_outlined, 'Phone Number'),
// // //               const SizedBox(height: 40),

// // //               // --- Account Actions ---
// // //               _sectionLabel('Account'),
// // //               _actionButton(Icons.lock_outline, 'Change Password', () {}),
// // //               const SizedBox(height: 16),
// // //               _actionButton(Icons.delete_outline, 'Delete Account', () {
// // //                 showDialog(
// // //                   context: context,
// // //                   builder: (_) => AlertDialog(
// // //                     title: const Text('Delete Account'),
// // //                     content: const Text('This action cannot be undone.'),
// // //                     actions: [
// // //                       TextButton(
// // //                           onPressed: () => Navigator.pop(context),
// // //                           child: const Text('Cancel')),
// // //                       TextButton(
// // //                         onPressed: () => Navigator.pop(context),
// // //                         child: const Text('Delete',
// // //                             style: TextStyle(color: Colors.red)),
// // //                       ),
// // //                     ],
// // //                   ),
// // //                 );
// // //               }, isDestructive: true),
// // //             ],
// // //           ),
// // //         ),
// // //       ),
// // //     );
// // //   }

// // //   Widget _sectionLabel(String text) => Align(
// // //         alignment: Alignment.centerLeft,
// // //         child: Padding(
// // //           padding: const EdgeInsets.symmetric(vertical: 8),
// // //           child: Text(text,
// // //               style: TextStyle(
// // //                   fontSize: 16,
// // //                   fontWeight: FontWeight.w600,
// // //                   color: Colors.grey.shade800)),
// // //         ),
// // //       );

// // //   Widget _buildField(TextEditingController ctl, IconData icon, String label,
// // //       {bool enabled = true}) {
// // //     return Container(
// // //       decoration: BoxDecoration(
// // //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// // //         borderRadius: BorderRadius.circular(12),
// // //         border: Border.all(color: Colors.grey.shade200),
// // //       ),
// // //       child: TextFormField(
// // //         controller: ctl,
// // //         enabled: enabled,
// // //         decoration: InputDecoration(
// // //           prefixIcon: Icon(icon, color: Colors.grey.shade600),
// // //           labelText: label,
// // //           border: InputBorder.none,
// // //           contentPadding:
// // //               const EdgeInsets.symmetric(vertical: 16, horizontal: 16),
// // //         ),
// // //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// // //       ),
// // //     );
// // //   }

// // //   Widget _actionButton(IconData icon, String label, VoidCallback onTap,
// // //       {bool isDestructive = false}) {
// // //     return InkWell(
// // //       onTap: onTap,
// // //       child: Container(
// // //         width: double.infinity,
// // //         padding: const EdgeInsets.symmetric(vertical: 16),
// // //         decoration: BoxDecoration(
// // //           color: Colors.grey.shade50,
// // //           borderRadius: BorderRadius.circular(12),
// // //           border: Border.all(color: Colors.grey.shade200),
// // //         ),
// // //         child: Row(
// // //           children: [
// // //             const SizedBox(width: 16),
// // //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// // //             const SizedBox(width: 16),
// // //             Text(label,
// // //                 style: TextStyle(
// // //                     fontSize: 16,
// // //                     color: isDestructive ? Colors.red : Colors.black87)),
// // //             const Spacer(),
// // //             const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// // //             const SizedBox(width: 16),
// // //           ],
// // //         ),
// // //       ),
// // //     );
// // //   }
// // // }

// // import 'dart:convert';
// // import 'dart:io';
// // import 'package:flutter/material.dart';
// // import 'package:image_picker/image_picker.dart';
// // import 'package:shared_preferences/shared_preferences.dart';
// // import 'package:http/http.dart' as http;
// // import 'package:cached_network_image/cached_network_image.dart';

// // class EditProfilePage extends StatefulWidget {
// //   const EditProfilePage({Key? key}) : super(key: key);

// //   @override
// //   State<EditProfilePage> createState() => _EditProfilePageState();
// // }

// // class _EditProfilePageState extends State<EditProfilePage> {
// //   final _formKey = GlobalKey<FormState>();
// //   String? userId;
// //   String? photo;

// //   final _firstNameController = TextEditingController();
// //   final _lastNameController  = TextEditingController();
// //   final _emailController     = TextEditingController();
// //   final _phoneController     = TextEditingController();

// //   File? _profileImage;
// //   final _picker = ImagePicker();

// //   @override
// //   void initState() {
// //     super.initState();
// //     _loadUserData();
// //   }

// //   @override
// //   void dispose() {
// //     _firstNameController.dispose();
// //     _lastNameController.dispose();
// //     _emailController.dispose();
// //     _phoneController.dispose();
// //     super.dispose();
// //   }

// //   Future<void> _loadUserData() async {
// //     final prefs = await SharedPreferences.getInstance();
// //     final userJson = prefs.getString('user');
// //     if (userJson != null) {
// //       final userMap = jsonDecode(userJson) as Map<String, dynamic>;
// //       setState(() {
// //         userId  = userMap['_id'] ?? '';
// //         photo   = userMap['photo'] ?? '';
// //         _firstNameController.text = userMap['firstName'] ?? '';
// //         _lastNameController.text  = userMap['lastName']  ?? '';
// //         _emailController.text     = userMap['email']     ?? '';
// //         _phoneController.text     = userMap['phone']?.toString() ?? '';
// //       });
// //     }
// //   }

// //   Future<void> _pickImage() async {
// //     final picked = await _picker.pickImage(source: ImageSource.gallery);
// //     if (picked != null) {
// //       setState(() {
// //         _profileImage = File(picked.path);
// //         photo = null; // so we don’t accidentally show the old URL
// //       });
// //     }
// //   }

// //   Future<void> _saveUserDataToBackend() async {
// //     if (userId == null || userId!.isEmpty) return;
// //     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');
// //     final details = {
// //       'firstName': _firstNameController.text,
// //       'lastName' : _lastNameController.text,
// //       'email'    : _emailController.text,
// //       'phone'    : _phoneController.text,
// //     };

// //     final res = await http.patch(
// //       uri,
// //       headers: {'Content-Type': 'application/json'},
// //       body: jsonEncode(details),
// //     );

// //     if (res.statusCode == 200) {
// //       final prefs = await SharedPreferences.getInstance();
// //       final updated = {
// //         '_id'      : userId,
// //         'firstName': _firstNameController.text,
// //         'lastName' : _lastNameController.text,
// //         'email'    : _emailController.text,
// //         'phone'    : _phoneController.text,
// //         'photo'    : _profileImage != null
// //             ? _profileImage!.path.split('/').last
// //             : (photo ?? ''),
// //       };
// //       await prefs.setString('user', jsonEncode(updated));
// //     } else {
// //       debugPrint('Update failed: ${res.body}');
// //     }
// //   }

// //   Future<void> _uploadProfileImage() async {
// //     if (_profileImage == null || userId == null) return;
// //     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
// //     final req = http.MultipartRequest('PATCH', uri)
// //       ..files.add(await http.MultipartFile.fromPath('file', _profileImage!.path));
// //     final resp = await req.send();
// //     if (resp.statusCode != 200) {
// //       debugPrint('Image upload failed (${resp.statusCode})');
// //     }
// //   }

// //   @override
// //   Widget build(BuildContext context) {
// //     // Network image (if any)
// //     final ImageProvider? backgroundImage = (photo != null && photo!.isNotEmpty)
// //         ? CachedNetworkImageProvider('http://localhost:8000/images/$photo')
// //         : null;

// //     // Local file image (picked by user)
// //     final ImageProvider? foregroundImage = _profileImage != null
// //         ? FileImage(_profileImage!)
// //         : null;

// //     return Scaffold(
// //       appBar: AppBar(
// //         leading: const BackButton(color: Colors.black),
// //         title: const Text('Edit Profile', style: TextStyle(color: Colors.black)),
// //         backgroundColor: Colors.white,
// //         elevation: 0,
// //         actions: [
// //           TextButton(
// //             onPressed: () async {
// //               if (_formKey.currentState!.validate()) {
// //                 await _saveUserDataToBackend();
// //                 await _uploadProfileImage();
// //                 ScaffoldMessenger.of(context).showSnackBar(
// //                   const SnackBar(
// //                     content: Text('Profile updated'),
// //                     backgroundColor: Color(0xFF45BDA7),
// //                   ),
// //                 );
// //                 Navigator.of(context).pop();
// //               }
// //             },
// //             child: const Text('Save',
// //                 style: TextStyle(
// //                     color: Color(0xFF45BDA7),
// //                     fontWeight: FontWeight.bold,
// //                     fontSize: 16)),
// //           )
// //         ],
// //       ),
// //       body: SingleChildScrollView(
// //         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
// //         child: Form(
// //           key: _formKey,
// //           child: Column(
// //             crossAxisAlignment: CrossAxisAlignment.center,
// //             children: [
// //               // Avatar + camera button
// //               Center(
// //                 child: Stack(
// //                   children: [
// //                     CircleAvatar(
// //                       radius: 70,
// //                       backgroundColor: Colors.grey.shade100,
// //                       backgroundImage: backgroundImage,
// //                       foregroundImage: foregroundImage,
// //                       child: (backgroundImage == null && foregroundImage == null)
// //                           ? Icon(Icons.person, size: 70, color: Colors.grey)
// //                           : null,
// //                     ),
// //                     Positioned(
// //                       bottom: 0,
// //                       right: 4,
// //                       child: InkWell(
// //                         onTap: _pickImage,
// //                         child: Container(
// //                           width: 44,
// //                           height: 44,
// //                           decoration: BoxDecoration(
// //                             color: const Color(0xFF45BDA7),
// //                             shape: BoxShape.circle,
// //                             border: Border.all(color: Colors.white, width: 3),
// //                           ),
// //                           child: const Icon(Icons.camera_alt,
// //                               size: 20, color: Colors.white),
// //                         ),
// //                       ),
// //                     ),
// //                   ],
// //                 ),
// //               ),
// //               const SizedBox(height: 40),

// //               // Personal Information
// //               _sectionLabel('Personal Information'),
// //               _buildField(_firstNameController, Icons.person_outline, 'First Name'),
// //               const SizedBox(height: 16),
// //               _buildField(_lastNameController, Icons.person_outline, 'Last Name'),
// //               const SizedBox(height: 30),

// //               // Contact Details
// //               _sectionLabel('Contact Details'),
// //               _buildField(_emailController, Icons.email_outlined, 'Email Address',
// //                   enabled: false),
// //               const SizedBox(height: 16),
// //               _buildField(_phoneController, Icons.phone_outlined, 'Phone Number'),
// //               const SizedBox(height: 40),

// //               // Account Actions
// //               _sectionLabel('Account'),
// //               _actionButton(Icons.lock_outline, 'Change Password', () {}),
// //               const SizedBox(height: 16),
// //               _actionButton(Icons.delete_outline, 'Delete Account', () {
// //                 showDialog(
// //                   context: context,
// //                   builder: (_) => AlertDialog(
// //                     title: const Text('Delete Account'),
// //                     content: const Text('This action cannot be undone.'),
// //                     actions: [
// //                       TextButton(
// //                           onPressed: () => Navigator.pop(context),
// //                           child: const Text('Cancel')),
// //                       TextButton(
// //                         onPressed: () => Navigator.pop(context),
// //                         child:
// //                             const Text('Delete', style: TextStyle(color: Colors.red)),
// //                       ),
// //                     ],
// //                   ),
// //                 );
// //               }, isDestructive: true),
// //             ],
// //           ),
// //         ),
// //       ),
// //     );
// //   }

// //   Widget _sectionLabel(String text) => Align(
// //         alignment: Alignment.centerLeft,
// //         child: Padding(
// //           padding: const EdgeInsets.symmetric(vertical: 8),
// //           child: Text(text,
// //               style: TextStyle(
// //                   fontSize: 16,
// //                   fontWeight: FontWeight.w600,
// //                   color: Colors.grey.shade800)),
// //         ),
// //       );

// //   Widget _buildField(TextEditingController controller, IconData icon, String label,
// //       {bool enabled = true}) {
// //     return Container(
// //       decoration: BoxDecoration(
// //         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
// //         borderRadius: BorderRadius.circular(12),
// //         border: Border.all(color: Colors.grey.shade200),
// //       ),
// //       child: TextFormField(
// //         controller: controller,
// //         enabled: enabled,
// //         decoration: InputDecoration(
// //           prefixIcon: Icon(icon, color: Colors.grey.shade600),
// //           labelText: label,
// //           border: InputBorder.none,
// //           contentPadding: const EdgeInsets.symmetric(vertical: 16, horizontal: 16),
// //         ),
// //         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
// //       ),
// //     );
// //   }

// //   Widget _actionButton(IconData icon, String label, VoidCallback onTap,
// //       {bool isDestructive = false}) {
// //     return InkWell(
// //       onTap: onTap,
// //       child: Container(
// //         width: double.infinity,
// //         padding: const EdgeInsets.symmetric(vertical: 16),
// //         decoration: BoxDecoration(
// //           color: Colors.grey.shade50,
// //           borderRadius: BorderRadius.circular(12),
// //           border: Border.all(color: Colors.grey.shade200),
// //         ),
// //         child: Row(
// //           children: [
// //             const SizedBox(width: 16),
// //             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
// //             const SizedBox(width: 16),
// //             Text(label,
// //                 style: TextStyle(
// //                     fontSize: 16,
// //                     color: isDestructive ? Colors.red : Colors.black87)),
// //             const Spacer(),
// //             const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
// //             const SizedBox(width: 16),
// //           ],
// //         ),
// //       ),
// //     );
// //   }
// // }

// import 'dart:convert';
// import 'dart:io' show File;                       // ignore: dart_io_import
// import 'package:flutter/foundation.dart' show kIsWeb;
// import 'package:flutter/material.dart';
// import 'package:image_picker/image_picker.dart';
// import 'package:shared_preferences/shared_preferences.dart';
// import 'package:http/http.dart' as http;
// import 'package:cached_network_image/cached_network_image.dart';

// class EditProfilePage extends StatefulWidget {
//   const EditProfilePage({Key? key}) : super(key: key);

//   @override
//   State<EditProfilePage> createState() => _EditProfilePageState();
// }

// class _EditProfilePageState extends State<EditProfilePage> {
//   final _formKey = GlobalKey<FormState>();

//   String? userId;
//   String? photo;            // photo filename from server
//   String? _localImagePath;  // path / blob‑URL of picked image

//   final _first = TextEditingController();
//   final _last  = TextEditingController();
//   final _mail  = TextEditingController();
//   final _phone = TextEditingController();

//   final _picker = ImagePicker();

//   // ───────────────────────── init / dispose ──────────────────────────
//   @override
//   void initState() {
//     super.initState();
//     _loadUserData();
//   }

//   @override
//   void dispose() {
//     _first.dispose();
//     _last.dispose();
//     _mail .dispose();
//     _phone.dispose();
//     super.dispose();
//   }

//   // ───────────────────────── load user from prefs ────────────────────
//   Future<void> _loadUserData() async {
//     final prefs = await SharedPreferences.getInstance();
//     final json = prefs.getString('user');
//     if (json == null) return;

//     final m = jsonDecode(json) as Map<String, dynamic>;
//     setState(() {
//       userId = m['_id'] ?? '';
//       photo  = m['photo'] ?? '';
//       _first.text = m['firstName'] ?? '';
//       _last .text = m['lastName']  ?? '';
//       _mail .text = m['email']     ?? '';
//       _phone.text = m['phone']?.toString() ?? '';
//     });
//   }

//   // ───────────────────────── image picker ────────────────────────────
//   Future<void> _pickImage() async {
//     final XFile? picked = await _picker.pickImage(source: ImageSource.gallery);
//     if (picked == null) return;

//     setState(() {
//       _localImagePath = picked.path;  // blob URL (web) or real file path
//       photo = null;                   // hide old network photo
//     });
//   }

//   // ───────────────────────── save to backend (details only) ──────────
//   Future<void> _saveUserData() async {
//     if (userId == null || userId!.isEmpty) return;
//     final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');

//     final res = await http.patch(
//       uri,
//       headers: {'Content-Type': 'application/json'},
//       body: jsonEncode({
//         'firstName': _first.text,
//         'lastName' : _last.text,
//         'email'    : _mail.text,
//         'phone'    : _phone.text,
//       }),
//     );

//     if (res.statusCode == 200) {
//       // update local prefs
//       final prefs = await SharedPreferences.getInstance();
//       await prefs.setString('user', jsonEncode({
//         '_id'      : userId,
//         'firstName': _first.text,
//         'lastName' : _last.text,
//         'email'    : _mail.text,
//         'phone'    : _phone.text,
//         'photo'    : photo ?? '',   // will be overwritten after upload
//       }));
//     } else {
//       debugPrint('❌ details update failed: ${res.body}');
//     }
//   }

//   // ───────────────────────── upload picked image ─────────────────────
//   Future<void> _uploadProfileImage() async {
//     if (_localImagePath == null || userId == null) return;
//     if (kIsWeb) {
//       // TODO: implement a web upload (multipart with picked.bytes) if needed
//       return;
//     }
//     final uri = Uri.parse('http://localhost:8000/uplaod/$userId');
//     final req = http.MultipartRequest('PATCH', uri)
//       ..files.add(await http.MultipartFile.fromPath('file', _localImagePath!));
//     final resp = await req.send();
//     if (resp.statusCode != 200) {
//       debugPrint('❌ image upload failed (${resp.statusCode})');
//     }
//   }

//   // ───────────────────────── helper: avatar provider ─────────────────
//   ImageProvider? _avatarProvider() {
//     // 1. freshly‑picked image (highest priority)
//     if (_localImagePath != null) {
//       return kIsWeb
//           ? NetworkImage(_localImagePath!)                // blob‑URL
//           : FileImage(File(_localImagePath!));            // mobile/desktop
//     }

//     // 2. previously‑saved network photo
//     if (photo != null && photo!.isNotEmpty) {
//       return CachedNetworkImageProvider('http://localhost:8000/images/$photo');
//     }

//     // 3. nothing → null (placeholder icon will show)
//     return null;
//   }

//   // ───────────────────────── UI ──────────────────────────────────────
//   @override
//   Widget build(BuildContext context) {
//     final avatar = _avatarProvider();

//     return Scaffold(
//       appBar: AppBar(
//         leading: const BackButton(color: Colors.black),
//         title: const Text('Edit Profile', style: TextStyle(color: Colors.black)),
//         backgroundColor: Colors.white, elevation: 0,
//         actions: [
//           TextButton(
//             onPressed: () async {
//               if (!_formKey.currentState!.validate()) return;
//               await _saveUserData();
//               await _uploadProfileImage();
//               if (mounted) {
//                 ScaffoldMessenger.of(context).showSnackBar(
//                   const SnackBar(content: Text('Profile updated'),
//                                  backgroundColor: Color(0xFF45BDA7)),
//                 );
//                 Navigator.pop(context);
//               }
//             },
//             child: const Text('Save',
//                 style: TextStyle(color: Color(0xFF45BDA7),
//                                  fontWeight: FontWeight.bold)),
//           )
//         ],
//       ),

//       body: SingleChildScrollView(
//         padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
//         child: Form(
//           key: _formKey,
//           child: Column(
//             children: [
//               // ── Avatar + camera button ──
//               Center(
//                 child: Stack(
//                   children: [
//                     CircleAvatar(
//                       radius: 70,
//                       backgroundColor: Colors.grey.shade100,
//                       backgroundImage: avatar,          // may be null
//                       child: avatar == null
//                           ? const Icon(Icons.person, size: 70, color: Colors.grey)
//                           : null,
//                     ),
//                     Positioned(
//                       bottom: 0, right: 4,
//                       child: InkWell(
//                         onTap: _pickImage,
//                         child: Container(
//                           width: 44, height: 44,
//                           decoration: BoxDecoration(
//                             color: const Color(0xFF45BDA7),
//                             shape: BoxShape.circle,
//                             border: Border.all(color: Colors.white, width: 3),
//                           ),
//                           child: const Icon(Icons.camera_alt,
//                               size: 20, color: Colors.white),
//                         ),
//                       ),
//                     ),
//                   ],
//                 ),
//               ),
//               const SizedBox(height: 40),

//               _section('Personal Information'),
//               _field(_first, Icons.person_outline, 'First Name'),
//               const SizedBox(height: 16),
//               _field(_last , Icons.person_outline, 'Last Name'),
//               const SizedBox(height: 30),

//               _section('Contact Details'),
//               _field(_mail , Icons.email_outlined, 'Email Address', enabled: false),
//               const SizedBox(height: 16),
//               _field(_phone, Icons.phone_outlined, 'Phone Number'),
//               const SizedBox(height: 40),

//               _section('Account'),
//               _action(Icons.lock_outline   , 'Change Password', (){}),
//               const SizedBox(height: 16),
//               _action(Icons.delete_outline , 'Delete Account', (){},
//                       isDestructive: true),
//             ],
//           ),
//         ),
//       ),
//     );
//   }

//   // ───────── widgets helpers ─────────
//   Widget _section(String text) => Align(
//     alignment: Alignment.centerLeft,
//     child: Padding(
//       padding: const EdgeInsets.symmetric(vertical: 8),
//       child: Text(text,
//           style: TextStyle(fontSize: 16,
//                            fontWeight: FontWeight.w600,
//                            color: Colors.grey.shade800)),
//     ),
//   );

//   Widget _field(TextEditingController c, IconData icon, String label,
//       {bool enabled = true}) {
//     return Container(
//       decoration: BoxDecoration(
//         color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
//         borderRadius: BorderRadius.circular(12),
//         border: Border.all(color: Colors.grey.shade200),
//       ),
//       child: TextFormField(
//         controller: c, enabled: enabled,
//         decoration: InputDecoration(
//           prefixIcon: Icon(icon, color: Colors.grey.shade600),
//           labelText: label,
//           border: InputBorder.none,
//           contentPadding: const EdgeInsets.symmetric(vertical: 16, horizontal: 16),
//         ),
//         validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
//       ),
//     );
//   }

//   Widget _action(IconData icon, String text, VoidCallback onTap,
//       {bool isDestructive = false}) {
//     return InkWell(
//       onTap: onTap,
//       child: Container(
//         width: double.infinity,
//         padding: const EdgeInsets.symmetric(vertical: 16),
//         decoration: BoxDecoration(
//           color: Colors.grey.shade50,
//           borderRadius: BorderRadius.circular(12),
//           border: Border.all(color: Colors.grey.shade200),
//         ),
//         child: Row(
//           children: [
//             const SizedBox(width: 16),
//             Icon(icon, color: isDestructive ? Colors.red : Colors.black),
//             const SizedBox(width: 16),
//             Text(text,
//                 style: TextStyle(fontSize: 16,
//                                  color: isDestructive ? Colors.red : Colors.black87)),
//             const Spacer(),
//             const Icon(Icons.arrow_forward_ios, size: 16, color: Colors.grey),
//             const SizedBox(width: 16),
//           ],
//         ),
//       ),
//     );
//   }
// }

// EditProfilePage.dart
import 'dart:convert';
import 'dart:io' show File; // <-- mobile / desktop
import 'dart:typed_data';

import 'package:flutter/foundation.dart' show kIsWeb;
import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:http/http.dart' as http;
import 'package:cached_network_image/cached_network_image.dart';
import 'package:http_parser/http_parser.dart'; // for MediaType on web

class EditProfilePage extends StatefulWidget {
  const EditProfilePage({Key? key}) : super(key: key);

  @override
  State<EditProfilePage> createState() => _EditProfilePageState();
}

class _EditProfilePageState extends State<EditProfilePage> {
  // ────────── state ──────────
  String? userId;
  String? photo; // filename stored on server
  String? _localImagePath; // picked path / blob‑URL
  Uint8List? _localImageBytes; // picked bytes (web only)

  final _first = TextEditingController();
  final _last = TextEditingController();
  final _mail = TextEditingController();
  final _phone = TextEditingController();

  final _picker = ImagePicker();
  final _formKey = GlobalKey<FormState>();

  // ────────── init / dispose ──────────
  @override
  void initState() {
    super.initState();
    _loadUserData();
  }

  @override
  void dispose() {
    _first.dispose();
    _last.dispose();
    _mail.dispose();
    _phone.dispose();
    super.dispose();
  }

  // ────────── load user from prefs ──────────
  Future<void> _loadUserData() async {
    final prefs = await SharedPreferences.getInstance();
    final raw = prefs.getString('user');
    if (raw == null) return;
    final m = jsonDecode(raw) as Map<String, dynamic>;
    setState(() {
      userId = m['_id'] ?? '';
      photo = m['photo'] ?? '';
      _first.text = m['firstName'] ?? '';
      _last.text = m['lastName'] ?? '';
      _mail.text = m['email'] ?? '';
      _phone.text = m['phone']?.toString() ?? '';
    });
  }

  // ────────── pick image ──────────
  Future<void> _pickImage() async {
    final XFile? picked = await _picker.pickImage(source: ImageSource.gallery);
    if (picked == null) return;

    setState(() {
      _localImagePath = picked.path; // path on mobile / blob url on web
      photo = null; // hide old photo
    });
    if (kIsWeb) _localImageBytes = await picked.readAsBytes();
  }

  // ────────── upload picked image, return filename ──────────
  Future<String?> _uploadProfileImage() async {
    if (userId == null || (_localImagePath == null && _localImageBytes == null))
      return null;

    final uri = Uri.parse('http://localhost:8000/uplaod/$userId'); // adjust!
    final req = http.MultipartRequest('PATCH', uri);

    if (kIsWeb) {
      req.files.add(http.MultipartFile.fromBytes(
        'file',
        _localImageBytes!,
        filename: 'avatar.png',
        contentType: MediaType('image', 'png'),
      ));
    } else {
      req.files
          .add(await http.MultipartFile.fromPath('file', _localImagePath!));
    }

    final resp = await req.send();
    if (resp.statusCode != 200) {
      debugPrint('❌ image upload failed (${resp.statusCode})');
      return null;
    }
    final body = await resp.stream.bytesToString();
    // server should return { userImage: "<filename>" }
    return (jsonDecode(body)['userImage'] as String?);
  }

  // ────────── save text fields ──────────
  Future<void> _saveUserDetails() async {
    if (userId == null || userId!.isEmpty) return;
    final uri = Uri.parse('http://localhost:8000/ELACO/updateUser/$userId');

    final res = await http.patch(
      uri,
      headers: {'Content-Type': 'application/json'},
      body: jsonEncode({
        'firstName': _first.text,
        'lastName': _last.text,
        'email': _mail.text,
        'phone': _phone.text,
      }),
    );
    if (res.statusCode != 200) {
      debugPrint('❌ details update failed: ${res.body}');
    }
  }

  // ────────── avatar provider ──────────
  ImageProvider? get _avatar {
    if (_localImagePath != null) {
      // freshly picked
      return kIsWeb
          ? NetworkImage(_localImagePath!)
          : FileImage(File(_localImagePath!));
    }
    if (photo != null && photo!.isNotEmpty) {
      // from server
      return CachedNetworkImageProvider('http://localhost:8000/images/$photo');
    }
    return null; // placeholder -> icon
  }

  // ────────── build ──────────
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        leading: const BackButton(color: Colors.black),
        title:
            const Text('Edit Profile', style: TextStyle(color: Colors.black)),
        backgroundColor: Colors.white,
        elevation: 0,
        actions: [
          TextButton(
            child: const Text('Save',
                style: TextStyle(
                    color: Color(0xFF45BDA7), fontWeight: FontWeight.bold)),
            onPressed: () async {
              if (!_formKey.currentState!.validate()) return;

              // 1) upload image first (may return new filename)
              final fname = await _uploadProfileImage();
              if (fname != null) {
                setState(() {
                  photo = fname;
                  _localImagePath = null;
                  _localImageBytes = null;
                });
              }

              // 2) upload text fields
              await _saveUserDetails();

              // 3) persist to prefs
              final prefs = await SharedPreferences.getInstance();
              await prefs.setString(
                  'user',
                  jsonEncode({
                    '_id': userId,
                    'firstName': _first.text,
                    'lastName': _last.text,
                    'email': _mail.text,
                    'phone': _phone.text,
                    'photo': photo ?? '',
                  }));

              if (!mounted) return;
              ScaffoldMessenger.of(context).showSnackBar(const SnackBar(
                  content: Text('Profile updated'),
                  backgroundColor: Color(0xFF45BDA7)));
              Navigator.pop(context);
            },
          )
        ],
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 16),
        child: Form(
          key: _formKey,
          child: Column(children: [
            // Avatar
            Center(
              child: Stack(children: [
                CircleAvatar(
                  radius: 70,
                  backgroundColor: Colors.grey.shade100,
                  backgroundImage: _avatar,
                  child: _avatar == null
                      ? const Icon(Icons.person, size: 70, color: Colors.grey)
                      : null,
                ),
                Positioned(
                  bottom: 0,
                  right: 4,
                  child: InkWell(
                    onTap: _pickImage,
                    child: Container(
                      width: 44,
                      height: 44,
                      decoration: BoxDecoration(
                        color: const Color(0xFF45BDA7),
                        shape: BoxShape.circle,
                        border: Border.all(color: Colors.white, width: 3),
                      ),
                      child: const Icon(Icons.camera_alt,
                          size: 20, color: Colors.white),
                    ),
                  ),
                )
              ]),
            ),
            const SizedBox(height: 40),

            _section('Personal Information'),
            _field(_first, Icons.person_outline, 'First Name'),
            const SizedBox(height: 16),
            _field(_last, Icons.person_outline, 'Last Name'),
            const SizedBox(height: 30),

            _section('Contact Details'),
            _field(_mail, Icons.email_outlined, 'Email Address',
                enabled: false),
            const SizedBox(height: 16),
            _field(_phone, Icons.phone_outlined, 'Phone Number'),
            const SizedBox(height: 40),

            _section('Account'),
            _action(Icons.lock_outline, 'Change Password', () {}),
            const SizedBox(height: 16),
            _action(Icons.delete_outline, 'Delete Account', () {},
                isDestructive: true),
          ]),
        ),
      ),
    );
  }

  // ────────── helpers ──────────
  Widget _section(String t) => Align(
        alignment: Alignment.centerLeft,
        child: Padding(
          padding: const EdgeInsets.symmetric(vertical: 8),
          child: Text(t,
              style: TextStyle(
                  fontSize: 16,
                  fontWeight: FontWeight.w600,
                  color: Colors.grey.shade800)),
        ),
      );

  Widget _field(TextEditingController c, IconData icn, String label,
          {bool enabled = true}) =>
      Container(
        decoration: BoxDecoration(
            color: enabled ? Colors.grey.shade50 : Colors.grey.shade100,
            borderRadius: BorderRadius.circular(12),
            border: Border.all(color: Colors.grey.shade200)),
        child: TextFormField(
          controller: c,
          enabled: enabled,
          decoration: InputDecoration(
              prefixIcon: Icon(icn, color: Colors.grey.shade600),
              labelText: label,
              border: InputBorder.none,
              contentPadding:
                  const EdgeInsets.symmetric(vertical: 16, horizontal: 16)),
          validator: (v) => (v == null || v.isEmpty) ? 'Required' : null,
        ),
      );

  Widget _action(IconData icn, String txt, VoidCallback cb,
          {bool isDestructive = false}) =>
      InkWell(
          onTap: cb,
          child: Container(
              width: double.infinity,
              padding: const EdgeInsets.symmetric(vertical: 16),
              decoration: BoxDecoration(
                  color: Colors.grey.shade50,
                  borderRadius: BorderRadius.circular(12),
                  border: Border.all(color: Colors.grey.shade200)),
              child: Row(children: [
                const SizedBox(width: 16),
                Icon(icn, color: isDestructive ? Colors.red : Colors.black),
                const SizedBox(width: 16),
                Text(txt,
                    style: TextStyle(
                        fontSize: 16,
                        color: isDestructive ? Colors.red : Colors.black87)),
                const Spacer(),
                const Icon(Icons.arrow_forward_ios,
                    size: 16, color: Colors.grey),
                const SizedBox(width: 16),
              ])));
}
